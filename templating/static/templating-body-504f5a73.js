$rload(function(e){"use strict";var t="",n=function(e){return e?e.replace(/^\s*|\s*$/g,""):t},r=/\$\{([A-Za-z0-9_\.]+)\}/g;e.defineCore("strings",{compare:function(e,t){return e<t?-1:e>t?1:0},isEmpty:function(e){return e==null||n(e).length===0},length:function(e){return e==null?0:e.length},isString:function(e){return e!=null&&e.constructor===String},equals:function(e,t,r){return r!==!1&&(e=n(e),t=n(t)),e==t},notEquals:function(e,t,n){return this.equals(e,t,n)===!1},trim:n,ltrim:function(e){return e?e.replace(/^\s*/g,""):t},rtrim:function(e){return e?e.replace(/\s*$/g,""):t},startsWith:function(e,t){return!e||e.length<t.length?!1:e.substring(0,t.length)===t},endsWith:function(e,t){return!e||e.length<t.length?!1:e.substring(e.length-t.length)===t},unicodeEncode:function(e){return"\\u"+("0000"+(+e.charCodeAt(0)).toString(16)).slice(-4)},merge:function(e,t){var n,i=[],s=0;r.lastIndex=0;while(n=r.exec(e))i.push(e.substring(s,n.index)),i.push(t[n[1]]||n[0]),s=r.lastIndex;return i.push(e.substring(s)),i.join("")}})})
$rload(function(e){"use strict";var t=function(){this.array=[],this.length=0,this.memberProp=!0};t.prototype={append:function(e){var t=e==null?"null":e.toString();return this.length+=t.length,this.array.push(t),this},write:function(e){return this.append(e)},toString:function(){return this.array.join("")},clear:function(){return this.array=[],this.length=0,this}},e.extendCore("strings",{StringBuilder:t,createStringBuilder:function(){return new t}})})
$rload(function(e){"use strict";var t=e.forEach,n=e.forEachEntry,r=e.arrayFromArguments,i=e.isArray,s=e.extend,o=0,u="__lstnrs",a=function(){},f,l=function(e,t){return e?t?function(){e.apply(t,arguments)}:e:a},c=function(e,n){var r=[],i;n.removed=!0,t(e._listeners,function(e){e!==n&&!e.removed&&r.push(e)}),e._listeners=r,(i=n.thisObj)&&delete i[u][n.id],e._listeners.length||e._onEmpty()},h=function(e,t){return function(){c(e,t)}},p=function(t){return function(r){if(!arguments.length)n(t,function(e,t){t.remove()});else{var i=t[r];i||e.errors.throwError(new Error("Invalid message name: "+r)),i.unsubscribe()}}},d=function(e,t){this.name=e,this.data=t};d.prototype={getName:function(){return this.name},getData:function(){return this.data}};var v=function(){this._listeners=[],this._onEmpty=a};v.prototype={add:function(e,t,n){var r={callback:e,thisObj:t,removed:!1,autoRemove:n,id:o++},i,s=this;s._listeners.push(r);var a={remove:h(s,r)};return a.unsubscribe=a.remove,t&&((i=t[u])||(i=t[u]={}),i[r.id]=a),a},publish:function(){var e=arguments,n=this;t(n._listeners,function(t){if(t.removed)return;t.callback.apply(t.thisObj,e),t.autoRemove&&c(n,t)})},onEmpty:function(e,t){this._onEmpty=l(e,t)}};var m=function(t,n){var r=n._allowed;if(r&&!r[t])throw new Error('Invalid message name of "'+t+'". Allowed messages: '+e.keys(r).join(", "))},g=function(e){return function(t){var n=[e].concat(r(arguments));this[typeof t=="function"?"subscribe":"publish"].apply(this,n)}},y=function(){this._byName={}};return y.prototype={__observable:!0,registerMessages:function(e,t){this._allowed||(this._allowed={});for(var n=0,r=e.length;n<r;n++){var i=e[n];this._allowed[i]=!0,t&&(this[i]=g(i))}},subscribe:function(e,t,r,i){var s=this,o,u;if(typeof e=="object")return i=r,r=t,o={},n(e,function(e,t){o[e]=s.subscribe(e,t,r,i)}),u={unsubscribe:p(o)},u.remove=u.removeAll=u.unsubscribe,u;m(e,s);var a=s._byName[e];return a||(s._byName[e]=a=new v,a.onEmpty(function(){delete s._byName[e]})),a.add(t,r,i)},publish:function(e,t){var n;i(t)?n=t:(f.isMessage(e)?(t=e,e=t.getName()):t=f.createMessage(e,t),n=[t.data,t]),m(e,this);var r=this,s=function(e){var t=r._byName[e];if(!t)return;t.publish.apply(t,n)};s(e),s("*");var o=e.lastIndexOf(".");return o>=0&&s(e.substring(0,o+1)+"*"),t}},e.listeners=f={Message:d,createListeners:function(){return new v},createObservable:function(e,t){var n=new y;return e&&n.registerMessages(e,t),n},makeObservable:function(e,t,n,r){t||(t=e),t._observable||(t._observable=!0,s(t,y.prototype)),y.call(e),n&&e.registerMessages(n,r)},isObervable:function(e){return e&&e.__observable},createMessage:function(e,t){return new d(e,t)},isMessage:function(e){return e instanceof d},bind:l,unsubscribeFromAll:function(e){var t=e[u];if(t)for(var n in t)t[n].unsubscribe()}}})
raptor.define("xml.utils",function(e){"use strict";var t=e.extend,n=/(\n|\"|[&<>]|[^\u0020-\}])/g,r={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","\n":"&#"+"\n".charCodeAt(0)+";"},i=t(t({},r),{"\n":"\n"}),s=function(e,t){return e==null?null:typeof e!="string"?e:e.replace(n,function(e){var n=t[e];return n||"&#"+e.charCodeAt(0)+";"})};return{escapeXml:function(e){return s(e,i)},escapeXmlAttr:function(e){return e?s(""+e,r):e}}})
raptor.defineClass("templating.Context",function(e){"use strict";var t=e.forEachEntry,n=e.require("xml.utils").escapeXmlAttr,r=e.require("strings"),i=e.require("listeners"),s=0,o,u=function(e,t){return function(){return e.apply(t,arguments)}},a=function(e){this.writer=e;var n=this;this.attributes={},i.makeObservable(this,a.prototype);var r={};t(o,function(e,t){r[e]=u(t,n)}),this._helpers=r};return a.prototype={uniqueId:function(){return s++},write:function(e){if(e==null)return;this.writer.write(e)},captureString:function(e,t){var n=r.createStringBuilder();return this.swapWriter(n,e,t),n.toString()},swapWriter:function(e,t,n){var r=this.writer;try{this.writer=e,t.call(n)}finally{this.writer=r}},invokeHandler:function(e,t){e.process(t,this)},getFunction:function(t,n){var r=t+":"+n,i=this._helpers[r];if(!i){var s=e.require("templating").getFunction(t,n);i=this._helpers[r]=u(s,this)}return i},isTagInput:function(e){return e&&e.hasOwnProperty("_tag")},renderTemplate:function(t,n){e.require("templating").render(t,n,this)}},a.namespacedHelpers=o={w:function(e){return this.write(e),this._helpers.w},h:function(e,t){return this.getFunction(e,t)},t:function(t,n,r,i){n||(n={}),n._tag=!0,n.invokeBody=r,i&&e.extend(n,i),this.invokeHandler(t,n)},a:function(e){if(!e)return;t(e,function(e,t){if(t===undefined)return;this.write(" "+e+(t===null?"":'="'+n(t)+'"'))},this)},i:function(e,t){this.renderTemplate(e,t)}},a})
raptor.define("templating",function(e){"use strict";var t=function(e){return $rget("rhtml",e)},n={},r=e.forEachEntry,i=e.isArray,s=e.require("strings"),o=e.require("xml.utils").escapeXml,u=e.require("xml.utils").escapeXmlAttr,a=e.require("templating.Context"),f,l,c=function(t,n){var r=t?l[t+":"+n]:l[n];return r||e.throwError(new Error('Helper function not found with name "'+n+'" and uri "'+t+'"')),r},h=function(e){return e?typeof e=="string"?!s.trim(e).length:i(e)?!e.length:!0:!0};return f={render:function(r,i,s){s||e.throwError(new Error("Context is required"));var o=n[r];o||(o=t(r),!o&&this.findTemplate&&(this.findTemplate(r),o=t(r)),o&&(o=o(f.helpers)),o||e.throwError(new Error('Template not found with name "'+r+'"')),n[r]=o);try{o(i||{},s,s._helpers)}catch(u){e.throwError(new Error('Unable to render template with name "'+r+'". Exception: '+u),u)}},renderToString:function(e,t,n){var r=s.createStringBuilder(),i=this,o=function(){i.render(e,t,n)};return n?n.swapWriter(r,o):(n=this.createContext(r),o()),r.toString()},unload:function(e){delete n[e]},getFunction:c,createContext:function(e){var t=new a(e);return t},registerFunctions:function(e,t,n,i){r(n,function(n,r){var s;i?s=function(){return r.apply(i,arguments)}:s=r,l[e+":"+n]=s,t&&(l[t+":"+n]=s)},this)},helpers:{h:c,t:function(t){var n=e.require(t),r;return(r=n.instance)||(r=n.instance=new n),r},f:function(e,t){if(!e)return;i(e)||(e=[e]);var n=0,r=e.length,s={getLength:function(){return r},isLast:function(){return n===r-1},isFirst:function(){return n===0},getIndex:function(){return n}};for(;n<r;n++){var o=e[n];t(o||"",s)}},e:h,ne:function(e){return!h(e)},x:o,xa:u,nx:function(e){return{toString:function(){return e}}}}},l=f.helpers,f})
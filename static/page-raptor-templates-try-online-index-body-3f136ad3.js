$rload(function(e){"use strict";var t="",n=function(e){return e?e.trim():t},r=/\$\{([A-Za-z0-9_\.]+)\}/g;e.strings={compare:function(e,t){return e<t?-1:e>t?1:0},isEmpty:function(e){return e==null||n(e).length===0},length:function(e){return e==null?0:e.length},isString:e.isString,equals:function(e,t,r){return r!==!1&&(e=n(e),t=n(t)),e==t},notEquals:function(e,t,n){return this.equals(e,t,n)===!1},trim:n,ltrim:function(e){return e?e.replace(/^\s\s*/,""):t},rtrim:function(e){return e?e.replace(/\s\s*$/,""):t},startsWith:function(e,t){return!e||e.length<t.length?!1:e.substring(0,t.length)===t},endsWith:function(e,t){return!e||e.length<t.length?!1:e.substring(e.length-t.length)===t},unicodeEncode:function(e){return"\\u"+("0000"+(+e.charCodeAt(0)).toString(16)).slice(-4)},merge:function(e,t){var n,i=[],s=0;r.lastIndex=0;while(n=r.exec(e))i.push(e.substring(s,n.index)),i.push(t[n[1]]||n[0]),s=r.lastIndex;return i.push(e.substring(s)),i.join("")}}});
$rload(function(e){"use strict";var t=function(){this.array=[],this.length=0,this.memberProp=!0};t.prototype={append:function(e){var t=e==null?"null":e.toString();return this.length+=t.length,this.array.push(t),this},write:function(e){return this.append(e)},toString:function(){return this.array.join("")},clear:function(){return this.array=[],this.length=0,this}},e.extendCore("strings",{StringBuilder:t,createStringBuilder:function(){return new t}})});
raptor.define("xml.utils",function(e){"use strict";var t=e.extend,n=/(\n|[\"\'&<>]|[^\u0020-\}])/g,r={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;","\n":"&#10;"},i=t(t({},r),{"\n":"\n"}),s=function(e,t){return e==null?null:typeof e!="string"?e:e.replace(n,function(e){var n=t[e];return n||"&#"+e.charCodeAt(0)+";"})};return{escapeXml:function(e){return s(e,i)},escapeXmlAttr:function(e){return e?s(""+e,r):e}}});
raptor.defineClass("templating.Context",function(e){"use strict";var t=e.forEachEntry,n=e.require("xml.utils").escapeXmlAttr,r=e.require("strings"),i=e.require("listeners"),s=0,o,u=function(e,t){return function(){return e.apply(t,arguments)}},a=function(e){this.writer=e;var n=this;this.attributes={},i.makeObservable(this,a.prototype);var r={};t(o,function(e,t){r[e]=u(t,n)}),this._helpers=r};return a.prototype={uniqueId:function(){return s++},write:function(e){if(e==null)return;this.writer.write(e)},getOutput:function(){return this.writer.toString()},captureString:function(e,t){var n=r.createStringBuilder();return this.swapWriter(n,e,t),n.toString()},swapWriter:function(e,t,n){var r=this.writer;try{this.writer=e,t.call(n)}finally{this.writer=r}},invokeHandler:function(e,t){e.process(t,this)},getFunction:function(t,n){var r=t+":"+n,i=this._helpers[r],s;return i||(arguments.length===1?s=o[t]:s=e.require("templating").getFunction(t,n),i=this._helpers[r]=u(s,this)),i},isTagInput:function(e){return e&&e.hasOwnProperty("_tag")},renderTemplate:function(t,n){e.require("templating").render(t,n,this)}},a.namespacedHelpers=o={w:function(e){return this.write(e),this._helpers.w},h:function(e,t){return this.getFunction(e,t)},t:function(t,n,r,i){n||(n={}),n._tag=!0,n.invokeBody=r,i&&e.extend(n,i),this.invokeHandler(t,n)},a:function(e){if(!e)return;t(e,function(e,t){if(t===undefined)return;this.write(" "+e+(t===null?"":'="'+n(t)+'"'))},this)},i:function(e,t){this.renderTemplate(e,t)},c:function(e){var t=this.captureString(e);return{toString:function(){return t}}}},a});
raptor.define("templating",function(e){"use strict";var t=function(e){return $rget("rhtml",e)},n={},r=e.forEachEntry,i=e.isArray,s=e.require("strings"),o=e.require("xml.utils").escapeXml,u=e.require("xml.utils").escapeXmlAttr,a=e.require("templating.Context"),f,l,c=function(t,n,r){var i=e.require(t),s=i[n]||i.prototype&&i.prototype[n];return s||e.throwError(new Error('Helper function not found with name "'+n+'" in class "'+t+'"')),s},h=function(e){return e?typeof e=="string"?!s.trim(e).length:i(e)?!e.length:!0:!0};return f={render:function(r,i,s){s||e.throwError(new Error("Context is required"));var o=n[r];o||(o=t(r),!o&&this.findTemplate&&(this.findTemplate(r),o=t(r)),o&&(o=o(f.helpers)),o||e.throwError(new Error('Template not found with name "'+r+'"')),n[r]=o);try{o(i||{},s,s._helpers)}catch(u){e.throwError(new Error('Unable to render template with name "'+r+'". Exception: '+u),u)}},renderToString:function(e,t,n){var r=s.createStringBuilder(),i=this,o=function(){i.render(e,t,n)};return n?n.swapWriter(r,o):(n=this.createContext(r),o()),r.toString()},unload:function(e){delete n[e]},getFunction:function(e,t){return arguments.length===1?l[e]:c(e,t)},createContext:function(e){var t=new a(e);return t},registerFunctions:function(e,t,n,i){r(n,function(n,r){var s;i?s=function(){return r.apply(i,arguments)}:s=r,l[e+":"+n]=s,t&&(l[t+":"+n]=s)},this)},helpers:{h:c,t:function(t){var n=e.require(t),r;return(r=n.instance)||(r=n.instance=new n),r},f:function(e,t){if(!e)return;i(e)||(e=[e]);var n=0,r=e.length,s={getLength:function(){return r},isLast:function(){return n===r-1},isFirst:function(){return n===0},getIndex:function(){return n}};for(;n<r;n++){var o=e[n];t(o||"",s)}},e:h,ne:function(e){return!h(e)},x:o,xa:u,nx:function(e){return{toString:function(){return e}}}}},l=f.helpers,f});
$rload(function(e){"use strict";e.resources={}});
$rload(function(e){"use strict";e.defineClass("resources.Resource",function(e){return{init:function(e,t){this.setSearchPathEntry(e),this.setPath(t)},setPath:function(e){this.path=e},getPath:function(){return this.path},isFileResource:function(){return!1},getName:function(){return this._name==null&&(this._name=this.path.substring(this.path.lastIndexOf("/")+1)),this._name},getSystemPath:function(){e.errors.throwError(new Error("getSystemPath() Not Implemented"))},readFully:function(){e.errors.throwError(new Error("Not Implemented"))},toString:function(){return"["+this.getClass().getName()+": path="+this.getPath()+", systemPath="+this.getSystemPath()+"]"},exists:function(){return!0},findChild:function(t){var n=e.resources;return n.findResource(n.joinPaths(this.getPath(),t))},setSearchPathEntry:function(e){this.searchPathEntry=e},getSearchPathEntry:function(){return this.searchPathEntry}}})});
$rload(function(e){"use strict";e.defineClass("resources.MissingResource",{superclass:"resources.Resource"},function(){var e=function(t){e.superclass.constructor.call(this,null,t)};return e.prototype={exists:function(){return!1}},e})});
raptor.define("resources.BrowserResource","resources.Resource",function(){"use strict";var e=function(t,n,r){e.superclass.constructor.call(this,t,n),this.path=n,this.contents=r};return e.prototype={readFully:function(){return this.contents},getSystemPath:function(){return this.path}},e});
$rload(function(e){"use strict";var t=e.logging.logger("resources"),n=e.require("resources.Resource"),r=e.require("resources.MissingResource"),i=e.require("resources.BrowserResource");e.extend(e.resources,{findResource:function(e){if(e instanceof n)return e;var t=$rget("resource",e);return t?new i(null,e,t):new r(e)}})});
$rload(function(e){"use strict";var t={"*":".*?","?":".?"};e.regexp={escape:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},simple:function(e){var n=this;return new RegExp("^"+e.replace(/[\*\?]|[^\*\?]*/g,function(e){return t[e]||n.escape(e)})+"$")}}});
$rload(function(e){"use strict";e.objects={extend:e.extend,forEachEntry:e.forEachEntry,keys:e.keys,values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},entries:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({key:n,value:e[n]});return t},isEmpty:function(e){if(!e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}});
raptor.define("json.stringify",function(){"use strict";var e=raptor.require("strings"),t=e.unicodeEncode,n=",",r="null",i=Array,s=/([^ -~]|(["'\\]))/g,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"},u=function(e){return e<10?"0"+e:e},a=function(e){return e.getUTCFullYear()+"-"+u(e.getUTCMonth()+1)+"-"+u(e.getUTCDate())+"T"+u(e.getUTCHours())+":"+u(e.getUTCMinutes())+":"+u(e.getUTCSeconds())+"Z"};return{stringify:function(u,f){f||(f={});var l=f.special||s,c=e.createStringBuilder(),h=function(e){c.append(e)},p=f.useSingleQuote===!0,d=p===!0?"'":'"',v=function(e){return d+e.replace(l,function(e){if(e==='"')return p?'"':'\\"';if(e==="'")return p?"\\'":"'";var n=o[e];return n||t(e)})+d},m=function(e){if(e==null){h(r);return}var t=e.constructor,s,o;if(e===!0||e===!1||t===Boolean)h(e.toString());else if(t===i){h("["),o=e.length;for(s=0;s<o;s++)s!==0&&h(n),m(e[s]);h("]")}else if(t===Date)h(a(e));else{var u=typeof e;switch(u){case"string":h(v(e));break;case"number":h(isFinite(e)?e+"":r);break;case"object":h("{");var f=!0,l;for(var c in e)if(e.hasOwnProperty(c)){l=e[c];if(l==null)continue;f===!1?h(n):f=!1,h(v(c)),h(":"),m(l)}h("}");break;default:h(r)}}};return m(u),c.toString()}}});
raptor.define("xml.dom",function(){"use strict";return{createParser:function(e){var t=raptor.require("xml.dom.DomParser");return new t(e)}}});
raptor.defineClass("xml.dom.DomParser",function(e){"use strict";var t=function(e){};return t.prototype={parse:function(e){try{var t=$.parseXML(e);return t}catch(n){throw new Error("Invalid XML")}}},t});
raptor.define("xml.sax",function(){"use strict";return{createParser:function(e){e=e||{};if(e.dom)return this.createParserForDom(e);var t=raptor.find("xml.sax.SaxParser")||raptor.find("xml.sax.SaxParserDom");return new t(e)},createParserForDom:function(e){var t=raptor.require("xml.sax.SaxParserDom");return new t(e)}}});
raptor.defineClass("xml.sax.BaseSaxParser",function(){"use strict";var e=raptor.require("listeners"),t=raptor.arrayFromArguments,n=function(){this.observable=e.createObservable(["startElement","endElement","characters","comment","error"])};return n.prototype={on:function(e,t){this.observable.subscribe.apply(this.observable,arguments)},_startElement:function(e){this.observable.publish("startElement",e)},_endElement:function(e){this.observable.publish("endElement",e)},_characters:function(e){e=e.replace(/\r\n|\r/g,"\n"),this.observable.publish("characters",e)},_comment:function(e){this.observable.publish("comment",e)},_error:function(){var e=t(arguments);this.observable.publish("error",e)},getPos:function(){return"(unknown)"}},n});
raptor.define("xml.dom-to-sax",function(){"use strict";var e=function(e){this.node=e};e.prototype={getNamespaceURI:function(){return this.node.namespaceURI||""},getLocalName:function(){return this.node.localName},getQName:function(){return this.node.prefix?this.node.prefix+":"+this.node.localName:this.node.localName},getValue:function(){return this.node.nodeValue},getPrefix:function(){return this.node.prefix},toString:function(){return"[Attribute: uri="+this.getNamespaceURI()+", qName="+this.getQName()+", value="+this.getValue()+"]"}};var t=function(e){this.node=e};return t.prototype={getNamespaceURI:function(){return this.node.namespaceURI||""},getLocalName:function(){return this.node.localName},getQName:function(){return this.node.prefix?this.node.prefix+":"+this.node.localName:this.node.localName},getPrefix:function(){return this.node.prefix||""},getAttributes:function(){var t=this.attributes;if(!t){t=this.attributes=[];var n=this.node.attributes;for(var r=0,i=n.length;r<i;r++)t.push(new e(n.item(r)))}return t},getNamespaceMappings:function(){var e=this._namespaceMappings;return e||(e=this._namespaceMappings={},raptor.forEach(this.getAttributes(),function(t){t.getPrefix()==="xmlns"&&(e[t.getLocalName()]=t.getValue())},this)),e},toString:function(){var e=[];return raptor.forEach(this.getAttributes(),function(t){e.push(t.toString())},this),e=e.join(", "),"[Element: uri="+this.getNamespaceURI()+", localName="+this.getLocalName()+", qName="+this.getQName()+", prefix="+this.getPrefix()+", attributes=["+e+"], ns="+JSON.stringify(this.getNamespaceMappings())+"]"}},{domToSax:function(e,n,r){var i=raptor.require("listeners").createObservable(["startElement","endElement","comment","characters"],!0);i.subscribe(n,r);var s=function(e){i.characters(e.nodeValue)},o=function(e){i.comment(e.nodeValue)},u=function(e){var n=new t(e);i.startElement(n);var r=e.childNodes,s=r.length;for(var o=0;o<s;o++){var u=r[o];a(u)}i.endElement(n)},a=function(e){switch(e.nodeType){case 1:u(e);break;case 2:break;case 3:s(e);break;case 4:s(e);break;case 5:s(e);break;case 6:s(e);break;case 7:break;case 8:o(e);break;case 9:u(e.documentElement)}};a(e)}}});
raptor.defineClass("xml.sax.SaxParserDom","xml.sax.BaseSaxParser",function(e){"use strict";var t=function(e){t.superclass.constructor.call(this)};return t.prototype={parse:function(t,n){var r;if(t.documentElement)r=t;else{var i=e.require("xml.dom").createParser();r=i.parse(t,n)}e.require("xml.dom-to-sax").domToSax(r.documentElement,{startElement:this._startElement,endElement:this._endElement,comment:this._comment,characters:this._characters},this)}},t});
$rload(function(e){"use strict";e.arrays={forEach:e.forEach,isArray:e.isArray,fromArguments:e.arrayFromArguments,concatArrays:function(e){var t=[],n=0,r=arguments.length,i;for(;n<r;n++)i=arguments[n],i!=null&&(t=t.concat.apply(t,i));return t},pop:function(e){var t=this.peek(e);return e.splice(e.length-1,1),t},peek:function(e){return e&&e.length?e[e.length-1]:undefined}}});
raptor.define("xml.sax.object-mapper",function(e){"use strict";var t=e.forEach,n=e.require("xml.sax"),r=e.forEachEntry,i=e.require("arrays"),s=e.require("strings"),o="string",u="boolean",a="object",f=function(e,t,n){var r=function(e){var r;return t==="attribute"?r=n["@"+e]:t==="element"&&(r=n["<"+e+">"]),r||(r=n[e]),r},i=e.getNamespaceURI(),s;return i?(s=r(i+":"+e.getLocalName()),s||(s=r(i+":*"))):s=r(e.getLocalName()),s||(s=r("*")),typeof s=="function"&&(s=s(e,t)),s},l=function(e,t){var n=[];return r(e,function(e,r){if(s.startsWith(e,"_"))return;if(t&&r._type===a)return;n.push(t?e:e.charAt(0)==="<"?e:"<"+e+">")},this),"["+n.join(", ")+"]"},c=function(e,t){t||(t={}),this.skipping=!1,this.options=t,this.trimText=t.trimText!==!1,this.contextStack=[],this.schema=e};return c.prototype={_parseProp:function(e,t){var n=this.options.parseProp;return n&&(e=n(e,t)),e},_setProperty:function(e,t,n,r,i){typeof r=="string"&&(this.trimText&&(r=s.trim(r)),r=this._parseProp(r,i),t._type===u&&(r=r.toLowerCase(),r=r==="true"||r==="yes"));var o=t._targetProp||(typeof e=="string"?e:e.getNamespaceURI()?e.getNamespaceURI()+":"+e.getLocalName():e.getLocalName());t._set?t._set(n,o,r,i):n[o]=r},skipCurrentElement:function(){if(this.skipping)return;var e=this.getCurrentContext();e.skip=!0,this.skipping=!0},error:function(t){e.throwError(new Error(t+" ("+this.saxParser.getPos()+")"))},getCurrentContext:function(){return i.peek(this.contextStack)},read:function(t,r){this.saxParser=n.createParser({trim:!0,normalize:!0}),this.contextStack=[],this.skipping=!1;var c=this,h,p=this.saxParser;return p.on({error:function(e){c.error(e)},startElement:function(t){var n=c.getCurrentContext(),r=n?n.schema:c.schema,i,s={el:t,tagName:t.getLocalName(),uri:t.getNamespaceURI(),parentContext:n};c.contextStack.push(s);if(c.skipping)return;s.schema=i=f(t,"element",r),i||(console.error("EL: ",t),console.error("parentSchema: ",r),c.error("Unexpected element: <"+t.getQName()+">. Expected one of: "+l(r)));if(i._type===o||i._type===u)i._begin&&i._begin(n?n.object:null,s);else if(i._type===a){s.object=i._begin?i._begin(n?n.object:null,s)||{}:{};if(!s.object)throw new Error('_begin() for "'+t.getLocalName()+'" did not return an object.')}if(!c.skipping){var h=t.getAttributes();for(var p=0,d=h.length,v;p<d;p++){v=h[p];if(c.skipping)break;var m=f(v,"attribute",i);m||c.error("Unexpected attribute: "+v.getQName()+". Expected one of: "+l(i,!0));var g=e.extend({},s);g.attr=v,c._setProperty(v,m,s.object,v.getValue(),g)}}},characters:function(e){if(c.skipping===!0)return;var t=c.getCurrentContext();t.text=t.text?t.text+e:e},endElement:function(){var e=c.getCurrentContext(),t=e.parentContext,n=e.schema;if(c.skipping!==!0)if(n._type===o||n._type===u)c._setProperty(e.el,n,t?t.object:null,e.text,e),n._end&&n._end(e.object,t?t.object:null,e);else if(n._type===a)e.text!=null&&s.trim(e.text)&&(n._text?c._setProperty("text",n._text,e.object,e.text,e):n._setText?n._setText(e.object,c._parseProp(e.text,e)):c.error("Unexpected text: "+e.text)),n._end&&n._end(e.object,t?t.object:null,e),n._targetProp&&c._setProperty(e.el,n,t?t.object:null,e.object);else if(n._type)throw new Error("Invalid type: "+n._type);c.contextStack.length===1&&(h=e.object),i.pop(c.contextStack),e.skip===!0&&(c.skipping=!1)}}),p.parse(t,r),h}},{createReader:function(e,t){return new c(e,t)},read:function(e,t,n,r){return this.createReader(n,r).read(e,t)}}});
raptor.defineClass("templating.compiler.Expression",function(){"use strict";var e=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|\s+(?:and|or|lt|gt|eq|ne|lt|gt|ge|le)\s+/g,t=raptor.require("strings"),n={and:" && ",or:" || ",eq:" === ",ne:" !== ",lt:" < ",gt:" > ",ge:" >= ",le:" <= "},r=function(r){return r.replace(e,function(e){return n[t.trim(e)]||e})},i=function(e,t){t!==!1&&typeof e=="string"&&(e=r(e)),this.expression=e};return i.prototype={getExpression:function(){return this.expression},toString:function(){return this.expression}},i});
raptor.defineClass("templating.compiler.ExpressionParser",function(e){"use strict";var t=e.require("templating.compiler.Expression"),n=e.require("strings"),r=e.require("regexp"),i={"${":"}","{%":"%}",$:null},s=function(t){var n=[];return e.forEach(t,function(e){n.push(r.escape("\\\\"+e)),n.push(r.escape("\\"+e)),n.push(r.escape(e))}),n.join("|")},o=s(["{%","${","$"]),u=function(){return new RegExp(o,"g")},a=/^([_a-zA-Z]\w*)/g,f=function(e,t){var n=e.split("\n"),r=0,i;while(r<n.length){i=n[r];if(t-i.length+1<0)break;t-=i.length+1,r++}return{str:i,pos:t}},l=function(e,t,n){var r=f(e,t);t=r.pos,e=r.str;var i=t-n,s=t+n,o;i<0&&(i=0),s>e.length&&(s=e.length);var u="...",a="...",l="\n"+u+e.substring(i,s)+a+"\n";for(o=0;o<u.length;o++)l+=" ";for(o=i;o<s;o++)l+=o===t?"^":" ";for(o=0;o<a.length;o++)l+=" ";return l},c=e.defineClass(function(){return{init:function(e,t){this.callback=e,this.callbackThisObj=t,this.text=""},_invokeCallback:function(t,n){this.callback[t]||e.throwError(new Error(t+" not allowed: "+n)),this.callback[t].call(this.callbackThisObj,n)},_endText:function(){this.text&&(this._invokeCallback("text",this.text),this.text="")},add:function(e,t){e==="text"?this.addText(t):(this._endText(),this._invokeCallback(e,t))},addText:function(e){this.text+=e},addExpression:function(e){this._endText(),e instanceof t||(e=new t(e)),this._invokeCallback("expression",e)},addScriptlet:function(e){this._endText(),this._invokeCallback("scriptlet",e)}}}),h=function(){};return h.getConditionalExpression=function(){},h.parse=function(t,r,s,o){o||(o={});var f=0,p,d,v,m,g,y,b,w,E=o.custom||{},S=function(t){if(r.error){r.error.call(s,t);return}e.throwError(new Error(t))},x=u(),T=new c(r,s);x.lastIndex=0;e:while(d=x.exec(t)){if(n.startsWith(d[0],"\\\\"))p=d.index+1,w=d[0].substring(2),m=d.index+d[0].length;else{if(n.startsWith(d[0],"\\")){T.addText(t.substring(f,d.index)),T.addText(d[0].substring(1)),f=x.lastIndex;continue}i.hasOwnProperty(d[0])?(w=d[0],p=d.index):e.throwError(new Error("Illegal state. Unexpected start token: "+d[0]))}m=x.lastIndex,f!==p&&T.addText(t.substring(f,p));var N=i[w];if(!N){a.lastIndex=0;var C=a.exec(t.substring(m));if(!C){T.addText(d[0]),x.lastIndex=f=m;continue e}var k=C[1];T.addExpression(k),x.lastIndex=f=m+=k.length;continue e}y=w==="{%",b=w==="{?";var L=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|\%\}|[\{\}]/g;L.lastIndex=m;var A=0;while(v=L.exec(t)){if(v[0]==="{"){A++;continue}if(v[0]==="}"){if(y)continue;if(A!==0){A--;continue}}else{if(v[0]!=="%}")continue;y||S('Ending "'+v[0]+'" token was found but matched with starting "'+w+'" token. Location: '+l(t,v.index,10))}g=t.substring(m,v.index);var O;if(w==="${"){var M=g.indexOf(":"),_;M!=-1&&(_=g.substring(0,M),O=E[_]||h.custom[_],O&&O.call(h,g.substring(M+1),T))}O||(y?T.addScriptlet(n.trim(g)):b?T.addExpression(this.getConditionalExpression(g)):T.addExpression(g)),x.lastIndex=L.lastIndex,f=L.lastIndex;continue e}S('Ending "'+i[w]+'" token not found for "'+w+'" token. Location: '+l(t,d.index,10)+"\n")}f!==t.length&&T.addText(t.substring(f,t.length)),T._endText()},h.custom={xml:function(e,n){e=new t(e),e.escapeXml=!1,n.addExpression(e)},entity:function(e,t){t.addText("&"+e+";")},quote:function(e,t){t.addText('"'+e+'"')},startTag:function(e,t){t.addText("<"+e+">")},endTag:function(e,t){t.addText("</"+e+">")},newline:function(e,t){t.addText("\n")}},h});
raptor.defineClass("templating.compiler.TypeConverter",function(e){"use strict";var t=e.require("templating.compiler.ExpressionParser"),n=e.require("json.stringify").stringify,r=e.require("templating.compiler.Expression"),i=function(){};return i.convert=function(i,s,o){var u=!1,a=[];if(i==null)return i;if(s==="custom"||s==="identifier")return i;if(s==="expression")return new r(i);var f="";if(o){t.parse(i,{text:function(e){f+=e,a.push(n(e))},expression:function(e){a.push(e),u=!0}});if(u)return new r(a.join("+"));i=f}if(s==="string")return o?new r(i?n(i):"null"):i;if(s==="boolean")return i=i.toLowerCase(),i=i==="true"||i==="yes",o?new r(i):i;if(s==="float"||s==="double"||s==="number"||s==="integer")return s==="integer"?i=parseInt(i,10):i=parseFloat(i),o?new r(i):i;e.throwError(new Error("Unsupported attribute targetType: "+s))},i});
raptor.defineClass("templating.compiler.AttributeSplitter",function(e){"use strict";var t=e.require("listeners"),n=e.require("strings"),r=["text","expression"],i=e.require("templating.compiler.Expression"),s=e.require("templating.compiler.TypeConverter"),o=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|==|===|[;=]/g,u=function(){};return u.parse=function(t,r,i){i||(i={});var u=0,a=i.ordered===!0,f=i.defaultName,l,c=-1,h=a?[]:{},p=function(t){if(i.errorHandler){i.errorHandler(t);return}e.throwError(new Error(t))},d=function(e){if(u===e)return;var i,o;if(c!=-1)i=n.trim(t.substring(u,c)),o=t.substring(c+1,e);else if(f){i=f,o=t.substring(u,e);if(!n.trim(o).length)return}else i=t.substring(u,e);i&&(i=n.trim(i));if(!n.trim(i).length&&!n.trim(o).length){c=-1;return}if(r){var l=r[i]||r["*"];l?(o!=null&&(o=s.convert(o,l.type,l.allowExpressions!==!1)),l.name&&(i=l.name)):p('Invalid sub-attribute name of "'+i+'"')}a?h.push({name:i,value:o}):h[i]=o,c=-1};while(l=o.exec(t))l[0]==";"?(d(l.index),u=l.index+1,c=-1):l[0]=="="&&c==-1&&(c=l.index);return d(t.length),h},u});
raptor.defineClass("templating.compiler.TemplateBuilder",function(e){"use strict";var t=e.require("json.stringify").stringify,n=e.require("strings"),r=e.require("templating.compiler.Expression"),i=e.forEach,s=function(e,t){this.filePath=t,this.compiler=e,this.options=e.options,this.templateName=null,this.curText=null,this.attributes={},this.staticVars=[],this.staticVarsLookup={},this.helperFunctionsAdded={},this.vars=[],this.varsLookup={},this.javaScriptCode=n.createStringBuilder(),this.getStaticHelperFunction("empty","e"),this.getStaticHelperFunction("notEmpty","ne"),this.getContextHelperFunction("write","w"),this.preserveWhitespace=0};return s.prototype={getTemplateName:function(){var e=this.options||{};return e.templateName||this.templateName||e.defaultTemplateName},beginPreserveWhitespace:function(){this.preserveWhitespace++},endPreserveWhitespace:function(){this.preserveWhitespace--},isPreserveWhitespace:function(){var e=this.options.preserveWhitespace;return this.preserveWhitespace>0||e===!0||e&&e["*"]},_getHelperFunction:function(e,t,n){var r=t+":"+(n?"static":"context"),i=this.helperFunctionsAdded[r];return i?i:(n?this.addStaticVar(e,"helpers."+t):this.addVar(e,"contextHelpers."+t),this.helperFunctionsAdded[r]=e,e)},getContextHelperFunction:function(e,t){return this._getHelperFunction(e,t,!1)},getStaticHelperFunction:function(e,t){return this._getHelperFunction(e,t,!0)},hasStaticVar:function(e){return this.staticVarsLookup[e]===!0},addStaticVar:function(e,t){this.staticVarsLookup[e]=!0,this.staticVars.push({name:e,expression:t})},hasVar:function(e){return this.vars[e]===!0},addVar:function(e,t){this.vars[e]=!0,this.vars.push({name:e,expression:t})},_writeVars:function(e,t){if(!e.length)return;t.append("var ");var n=[];i(e,function(e){n.push(e.name+"="+e.expression)}),t.append(n.join(",")+";")},_endText:function(){if(this.hasErrors())return;var e=this.curText;e&&(this.curText=null,this.addWrite(t(e,{useSingleQuote:!0})))},addText:function(e){if(this.hasErrors())return;this.curText===null?this.curText=e:this.curText+=e},_endWrites:function(){var e=this.curWrites;e&&(this.curWrites=null,this.curWrites=null,i(e,function(e,t){t===0?this.javaScriptCode.append("write("):this.javaScriptCode.append("("),this.javaScriptCode.append(e),this.javaScriptCode.append(")")},this),this.javaScriptCode.append(";"))},addWrite:function(e,t){if(this.hasErrors())return;this._endText(),this.curWrites||(this.curWrites=[]),t&&(t.escapeXml&&(e=this.getStaticHelperFunction("escapeXml","x")+"("+e+")"),t.escapeXmlAttr&&(e=this.getStaticHelperFunction("escapeXmlAttr","xa")+"("+e+")")),this.curWrites.push(e)},addJavaScriptCode:function(e){if(this.hasErrors())return;this._endText(),this._endWrites(),this.javaScriptCode.append(e)},getOutput:function(){if(this.hasErrors())return"";var e=n.createStringBuilder(),r=this.getTemplateName();r||this.addError('Template name not defined in template at path "'+this.filePath+'"');var i=this.params;return i?i=["context"].concat(i):i=["context"],e.append('$rset("rhtml",'),e.append(t(r)),e.append(","),e.append("function(helpers){"),this._writeVars(this.staticVars,e),e.append("return function(data, context, contextHelpers){\n"),this._writeVars(this.vars,e),this._endText(),this._endWrites(),e.append(this.javaScriptCode.toString()),e.append("}});"),e.toString()},setTemplateName:function(e){this.templateName=e},makeExpression:function(t){if(t instanceof r)return t;if(typeof t=="string")return new r(t);e.throwError(new Error("Unsupported expression object: "+t))},isExpression:function(e){return e instanceof r},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,t},hasErrors:function(){return this.compiler.hasErrors()},addError:function(e,t){this.compiler.addError(e,t)},getErrors:function(){return this.compiler.getErrors()}},s});
raptor.defineClass("templating.compiler.TemplateCompiler",function(raptor){"use strict";var TemplateBuilder=raptor.require("templating.compiler.TemplateBuilder"),ParseTreeBuilder=raptor.require("templating.compiler.ParseTreeBuilder"),Expression=raptor.require("templating.compiler.Expression"),errors=raptor.require("errors"),minifier=raptor.find("js-minifier"),TypeConverter=raptor.require("templating.compiler.TypeConverter"),TemplateCompiler=function(e,t){this.taglibs=e,this.options=t||{},this.errors=[]};return TemplateCompiler.prototype={transformTree:function(e,t){try{this.taglibs.forEachNodeTransformer(e,function(n){e.isTransformerApplied(n)||(e.setTransformerApplied(n),this._transformerApplied=!0,e.compiler=this,n.getInstance().process(e,this,t))},this)}catch(n){errors.throwError(new Error('Unable to compile template at path "'+t.filePath+". Error: "+n.message),n)}for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];i.parentNode||raptor.throwError(new Error("Invalid node found in tree. parentNode property of child node is not set. Node: "+e)),this.transformTree(i,t)}},compile:function(e,t,n,r){var i=this,s,o,u=function(){var e="Errors in template:\n",t=i.getErrors();for(var n=0,r=t.length;n<r;n++)e+=n+1+") "+(t[n].pos?"["+t[n].pos+"] ":"")+t[n].message+"\n";var s=new Error(e);throw s.errors=i.getErrors(),s};try{s=ParseTreeBuilder.parse(e,t,this.taglibs),o=new TemplateBuilder(this,t);do this._transformerApplied=!1,this.transformTree(s,o);while(this._transformerApplied)}catch(a){errors.throwError(new Error('An error occurred while trying to compile template at path "'+t+'". Exception: '+a),a)}try{s.generateCode(o)}catch(a){errors.throwError(new Error('An error occurred while trying to compile template at path "'+t+'". Exception: '+a),a)}this.hasErrors()&&u();var f=o.getOutput();minifier&&this.options.minify===!0&&(f=minifier.minify(f)),n&&n.call(r,{source:f,templateName:o.getTemplateName()});var l=this.options;return l&&l.nameCallback&&l.nameCallback(o.getTemplateName()),f},compileAndLoad:function(xmlSrc,filePath){var compiledSrc=this.compile(xmlSrc,filePath,function(e){raptor.require("templating").unload(e.templateName)});try{eval(compiledSrc)}catch(e){this.logger().error("Unable to load compiled template: "+compiledSrc,e),errors.throwError(new Error('Unable to load template at path "'+filePath+'". Exception: '+e.message),e)}},isExpression:function(e){return e instanceof Expression},createTagHandlerNode:function(e,t){var n=raptor.require("templating.taglibs.core.TagHandlerNode"),r=this.taglibs.getTagDef(e,t),i=new n(r);return i},convertType:function(e,t,n){return TypeConverter.convert(e,t,n)},addError:function(e,t){this.errors.push({message:e,pos:t})},hasErrors:function(){return this.errors.length!==0},getErrors:function(){return this.errors}},TemplateCompiler});
raptor.defineClass("templating.compiler.Taglib",function(e){"use strict";var t=function(){};return t.prototype={},t.Tag=e.defineClass(function(){var t=function(){};return t.prototype={getAttributeDef:function(e,t){return e==null&&(e=""),this.attributeMap?this.attributeMap[e+":"+t]||this.attributeMap[e+":*"]||this.attributeMap["*:"+t]||this.attributeMap["*:*"]:null},toString:function(){return"[Tag: <"+this.uri+":"+this.name+">]"},forEachAttribute:function(t,n){e.forEachEntry(this.attributeMap,function(e,r){t.call(n,r)})}},t}),t.Transformer=e.defineClass(function(){var t=0,n=function(){this.id=t++,this.tag=null,this.className=null,this.instance=null};return n.prototype={getInstance:function(){this.className||e.throwError(new Error("Transformer class not defined for tag transformer (tag="+this.tag+")"));if(!this.instance){var t=e.require(this.className);this.instance=new t,this.instance.id=this.id}return this.instance},toString:function(){return"[Taglib.Transformer: "+this.className+"]"}},n}),t});
raptor.defineClass("templating.compiler.TaglibCollection",function(e){"use strict";var t=e.forEach,n=e.extend,r=e.strings,i=e.require("templating.compiler.Taglib"),s=e.require("templating.compiler.ElementNode"),o=e.require("templating.compiler.TextNode"),u=i.Tag,a=i.Transformer,f=/^(?:(\*|(?:(?:@?[A-Za-z0-9_\-]+\s*,\s*)*@?[A-Za-z0-9_\-]+))\s+from\s+)?([^ ]*)(?:\s+as\s+([A-Za-z0-9_\-]+))?$/,l=function(e,t,n){if(e[t]!=null)return e[t];var r=t.indexOf("-"),i,s,o;if(r!=-1){i=t.substring(0,r),o=t.substring(r+1),s=n._prefixes[i];if(s)return{uri:s,name:o,prefix:i}}return null},c=function(n,i){this._tagImports={},this._attrImports={},this._prefixes={};var s=r.trim(i).split(/\s*;\s*/);t(s,function(r){if(!r)return;var i=r.match(f),s,o={},u,a;i?(s=i[1],u=n.resolveURI(i[2]),a=i[3],a||(a=n.resolvePrefix(u)||n.resolveShortName(u),a||e.throwError(new Error('Unable to handle imports from "'+u+'". The taglib does not have a prefix or short name defined.')))):e.throwError(new Error('Invalid import: "'+r+'"')),this._prefixes[a]=u,s&&t(s.split(/\s*,\s*/),function(e){o[e]=!0}),n.forEachTag(u,function(e,t){e.uri===u&&(o["*"]||o[e.name])&&(this._tagImports[e.name]={uri:u,name:e.name,prefix:a}),e.forEachAttribute(function(t){e.uri!==u&&(o["*"]||o["@"+t.name])&&(this._attrImports[t.name]={uri:u,name:t.name,prefix:a})},this)},this)},this)};c.prototype={getImportedTag:function(e){return l(this._tagImports,e,this)},getImportedAttribute:function(e){return l(this._attrImports,e,this)}};var h=function(){this.tagTransformersLookup={},this.tagDefs={},this.textTransformers={},this.taglibsByURI={},this.shortNameToUriMapping={},this.uriToShortNameMapping={},this.uriToPrefixMapping={},this.functionsLookup={}};return h.prototype={forEachTag:function(t,n,r){t=this.resolveURI(t);var i=this.taglibsByURI[t];if(!i)return;e.forEachEntry(i.tags,function(e,t){n.call(r,t,i)})},isTaglib:function(e){return this.taglibsByURI[e]!=null},add:function(e){e=n(new i,e);var r=this.taglibsByURI[e.uri]||e;this.taglibsByURI[e.uri]=r,e.shortName&&(this.taglibsByURI[e.shortName]=e,e.shortName&&(r.shortName=e.shortName,this.shortNameToUriMapping[e.shortName]=e.uri,this.uriToShortNameMapping[e.uri]=e.shortName),e.prefix&&(r.prefix=e.prefix,this.uriToPrefixMapping[e.uri]=e.prefix));var s=e.tags;delete e.tags,e.tags={},t(s,function(i,s){var o=i.uri==null?e.uri:i.uri,f=i.name,l=o+":"+f;i=n(new u,i),i.taglib=r,i.uri=o,r.tags[l]=i,this.tagDefs[l]=i;if(i.transformers){var c;(c=this.tagTransformersLookup[l])||(this.tagTransformersLookup[l]=c={transformers:[],before:{},after:{},_addRelativeTransformer:function(e,t,n){var r=this[e][n];r||(r=this[e][n]=[]),r.push(t)}}),t(i.transformers,function(e){e=n(new a,e),e.after?c._addRelativeTransformer("after",e,e.after):e.before?c._addRelativeTransformer("before",e,e.before):c.transformers.push(e)},this)}},this),t(e.textTransformers,function(e){this.textTransformers[e.className]=n(new a,e)},this),t(e.functions,function(t){if(!t.name)return;this.functionsLookup[e.uri+":"+t.name]=t,r.shortName&&(this.functionsLookup[e.shortName+":"+t.name]=t)},this)},forEachNodeTransformer:function(e,t,n){e instanceof s?this.forEachTagTransformer(e.uri,e.localName,t,n):e instanceof o&&this.forEachTextTransformer(t,n)},resolveURI:function(e){return e?this.shortNameToUriMapping[e]||e:e},resolveShortName:function(e){return e?this.shortNameToUriMapping[e]?e:this.uriToShortNameMapping[e]:e},resolvePrefix:function(e){return e?(e=this.resolveURI(e),this.uriToPrefixMapping[e]):e},forEachTagTransformer:function(e,t,n,r){e==null&&(e="");var i=function(e,t){if(!e)return;t||(t=e.transformers);if(!t)return;for(var s=0,o=t.length;s<o;s++){var u=t[s];e.before[u.className]&&i(e,e.before[u.className]);if(n.call(r,u)===!1)return;e.after[u.className]&&i(e,e.after[u.className])}};i(this.tagTransformersLookup[e+":"+t]),i(this.tagTransformersLookup[e+":*"]),i(this.tagTransformersLookup["*:*"])},forEachTextTransformer:function(t,n){e.forEachEntry(this.textTransformers,function(e,r){var i=t.call(n,r);return i===!1?!1:!0})},getTagDef:function(e,t){var n=this.tagDefs[e+":"+t];return n||(n=this.tagDefs[e+":*"]),n},getFunction:function(e,t){return this.functionsLookup[e+":"+t]},getImports:function(e){return new c(this,e)}},h});
raptor.define("templating.compiler",function(e){"use strict";var t=e.require("templating.compiler.TaglibCollection"),n=new t,r=e.extend,i=e.require("templating.compiler.ExpressionParser"),s={minify:!1,preserveWhitespace:{pre:!0,textarea:!0},allowSelfClosing:{script:!1,div:!1,textarea:!1,li:!1,b:!1,a:!1,i:!1},startTagOnly:{img:!0,br:!0,input:!0}};return{createCompiler:function(t){this.discoverTaglibs&&this.discoverTaglibs();var i=e.require("templating.compiler.TemplateCompiler");return t?t=r(r({},s),t):t=s,new i(n,t)},compile:function(e,t,n){return this.createCompiler(n).compile(e,t)},compileAndLoad:function(e,t,n){this.createCompiler(n).compileAndLoad(e,t)},loadTaglibXml:function(t,n){var r=e.require("templating.compiler.TaglibXmlLoader"),i=r.load(t,n);return this.addTaglib(i),i},addTaglib:function(e){n.add(e)},hasTaglib:function(e){return n.isTaglib(e)},registerCustomExpressionHandler:function(e,t){i.custom[e]=t},defaultOptions:s,taglibs:n}}),raptor.global.$rtld=function(e){"use strict";raptor.require("templating.compiler").addTaglib(e)}
raptor.defineClass("templating.compiler.Node",function(e){"use strict";var t=e.forEachEntry,n=e.forEach,r=e.isArray,i=e.require("objects").isEmpty,s=Array.prototype.splice,o=e.errors,u=function(e,t){n(e,function(e){if(e.parentNode){var n=e.parentNode.removeChild(e);n||o.throwError(new Error("Unexpected state. Child not found in parent. (node="+e+", parentNode="+t+")"))}e.parentNode=t},this)},a=function(e){this.nodeType||(this._isRoot=!1,this.nodeType=e,this.parentNode=null,this.childNodes=[],this.namespaceMappings={},this.prefixMappings={},this.transformersApplied={},this.properties={})};return a.prototype={getPosition:function(){var e=this.pos||this.getProperty("pos")||{toString:function(){return"(unknown position)"}};return e},addError:function(t){this.compiler||e.throwError(new Error("Template compiler not set for node "+this));var n=this.getPosition();this.compiler.addError(t+" ("+this.toString()+")",n)},setProperty:function(e,t){this.setPropertyNS(null,e,t)},setPropertyNS:function(e,t,n){e||(e="");var r=this.properties[e];r||(r=this.properties[e]={}),r[t]=n},setProperties:function(e){this.setPropertiesNS(null,e)},setPropertiesNS:function(e,n){e||(e=""),t(n,function(t,n){this.setPropertyNS(e,t,n)},this)},getPropertyNamespaces:function(){return e.keys(this.properties)},getProperties:function(e){return this.getPropertiesNS(null)},getPropertiesNS:function(e){return e||(e=""),this.properties[e]},forEachProperty:function(e,n){t(this.properties,function(r,i){t(i,function(t,i){e.call(n,r,t,i)},this)},this)},getProperty:function(e){return this.getPropertyNS(null,e)},getPropertyNS:function(e,t){e||(e="");var n=this.properties[e];return n?n[t]:undefined},removeProperty:function(e){this.removePropertyNS("",e)},removePropertyNS:function(e,t){e||(e="");var n=this.properties[e];n&&delete n[t],i(n)&&delete this.properties[e]},forEachPropertyNS:function(e,n,r){e==null&&(e="");var i=this.properties[e];i&&t(i,function(e,t){n.call(r,e,t)},this)},forEachChild:function(e,t){n(this.childNodes,e,t)},isTransformerApplied:function(e){return this.transformersApplied[e.id]===!0},setTransformerApplied:function(e){this.transformersApplied[e.id]=!0},hasChildren:function(){return this.childNodes.length>0},appendChild:function(e){this.appendChildren([e])},appendChildren:function(e){if(!e)return;r(e)||(e=[e]),this.childNodes=this.childNodes.concat(e),u(e,this)},isRoot:function(){return this._isRoot===!0},removeChild:function(e){for(var t=0,n=this.childNodes.length,r;t<n;t++)if((r=this.childNodes[t])===e)return e.parentNode=null,this.childNodes.splice(t,1),r;return null},removeChildren:function(){u(this.childNodes,null);var e=this.childNodes;return this.childNodes=[],e},replaceChild:function(e,t){if(e===t)return!1;for(var n=0,r=this.childNodes.length;n<r;n++)if(this.childNodes[n]==t)return u(e,this),this.childNodes[n]=e,t.parentNode=null,!0;return!1},insertAfter:function(e,t){if(!e)return;r(e)||(e=[e]);var n=this.childNodes;if(t)for(var i=0,o=n.length;i<o;i++)if(n[i]===t){if(i===o-1)break;u(e,this);var a=[i+1,0].concat(e);s.apply(n,a);return}this.appendChildren(e)},isTextNode:function(){return!1},isElementNode:function(){return!1},setStripExpression:function(e){this.stripExpression=e},generateCode:function(t){this.compiler=t.compiler;var n=this.preserveSpace||this.isPreserveSpace&&this.isPreserveSpace();n&&t.beginPreserveWhitespace();try{if(!this.stripExpression||this.stripExpression.toString()==="false")this.doGenerateCode(t);else if(this.stripExpression.toString()==="true")this.generateCodeForChildren(t);else{(!this.generateBeforeCode||!this.generateAfterCode)&&this.addError("The c:strip directive is not supported for node "+this);var r=t.getAttribute("nextStripVarId");r==null&&(r=t.setAttribute("nextStripVarId",0));var i="__strip"+r++;t.addJavaScriptCode("var "+i+"=!("+this.stripExpression+");"),t.addJavaScriptCode("if ("+i+"){"),this.generateBeforeCode(t),t.addJavaScriptCode("}"),this.generateCodeForChildren(t),t.addJavaScriptCode("if ("+i+"){"),this.generateAfterCode(t),t.addJavaScriptCode("}")}}catch(s){e.throwError(new Error("Unable to generate code for node "+this+" at position ["+this.getPosition()+"]. Exception: "+s),s)}n&&t.endPreserveWhitespace()},doGenerateCode:function(e){this.generateCodeForChildren(e)},generateCodeForChildren:function(e){e||o.throwError(new Error('The "template" argument is required')),n(this.childNodes,function(t){t.generateCode(e)},this)},addNamespaceMappings:function(e){if(!e)return;var n=this.namespaceMappings,r=this.prefixMappings;t(e,function(e,t){n[e]=t,r[t]=e})},resolveNamespacePrefix:function(e){var t=this.prefixMappings[e];return!t&&this.parentNode?this.parentNode.resolveNamespacePrefix():t},getNodeClass:function(){return this.nodeClass||this.getClass()},setNodeClass:function(e){this.nodeClass=e}},a});
raptor.defineClass("templating.compiler.ElementNode","templating.compiler.Node",function(){"use strict";var e=raptor.forEachEntry,t=raptor.require("xml.utils").escapeXmlAttr,n="http://www.w3.org/XML/1998/namespace",r="http://www.w3.org/XML/1998/namespace",i=raptor.require("templating.compiler.ExpressionParser"),s=function(){s.superclass.constructor.call(this,"element"),this.prefix=null,this.localName=null,this.uri=null,this.qName=null,this.dynamicAttributesExpression=null,this.attributes={},this.allowSelfClosing=!0,this.startTagOnly=!1};return s.prototype={setStartTagOnly:function(e){this.startTagOnly=!0},setAllowSelfClosing:function(e){this.allowSelfClosing=e},isElementNode:function(){return!0},isTextNode:function(){return!1},getAttributes:function(){var t=[];return e(this.attributes,function(e,n){t.push(n)},this),t},getAttribute:function(e){return this.getAttributeNS(null,e)},getAttributeNS:function(e,t){var n=this.attributes[(e||"")+":"+t];return n?n.value:null},setAttribute:function(e,t){this.setAttributeNS(null,e,t)},setAttributeNS:function(e,t,n,r){this.attributes[(e||"")+":"+t]={localName:t,value:n,prefix:r,uri:e,qName:r?r+":"+t:t,name:e?e+":"+t:t,toString:function(){return this.name}}},setEmptyAttribute:function(e){this.setAttribute(e,null)},removeAttribute:function(e){this.removeAttributeNS(null,e)},removeAttributeNS:function(e,t){delete this.attributes[(e||"")+":"+t]},isPreserveSpace:function(){return this.preserveSpace===!0||this.getAttributeNS(n,"space")==="preserve"||this.getAttributeNS(r,"space")==="preserve"||this.getAttribute("xml:space")==="preserve"},removePreserveSpaceAttr:function(){this.removeAttributeNS(n,"space"),this.removeAttributeNS(r,"space"),this.removeAttribute("space")},setPreserveSpace:function(e){this.preserveSpace=e},setStripExpression:function(e){this.stripExpression=e},doGenerateCode:function(e){this.generateBeforeCode(e),this.generateCodeForChildren(e),this.generateAfterCode(e)},generateBeforeCode:function(n){var r=this.preserveSpace=this.isPreserveSpace(),s=this.prefix?this.prefix+":"+this.localName:this.localName;r&&this.removePreserveSpaceAttr(),n.addText("<"+s),this.attributes&&e(this.attributes,function(e,r){n.addText(" ");var o=r.prefix;!o&&r.uri&&(o=this.resolveNamespacePrefix(r.uri)),o?s=o+(r.localName?":"+r.localName:""):s=r.localName,r.value===null||r.value===undefined?n.addText(s):(n.addText(s+'="'),i.parse(r.value,{text:function(e){n.addText(t(e))},xml:function(e){n.addText(e)},expression:function(e){n.addWrite(e,{escapeXmlAttr:!0})},error:function(e){this.addError('Invalid expression found in attribute "'+s+'". '+e)}},this,{custom:{entity:function(e,t){t.add("xml","&"+e+";")}}}),n.addText('"'))},this),this.dynamicAttributesExpression&&n.addJavaScriptCode(n.getContextHelperFunction("attrs","a")+"("+this.dynamicAttributesExpression+");"),this.childNodes.length?n.addText(">"):this.startTagOnly?n.addText(">"):this.allowSelfClosing&&n.addText("/>")},generateAfterCode:function(e){var t=this.prefix?this.prefix+":"+this.localName:this.localName;this.childNodes.length?e.addText("</"+t+">"):!this.startTagOnly&&!this.allowSelfClosing&&e.addText("></"+t+">")},toString:function(){return"<"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">"}},s});
raptor.defineClass("templating.compiler.TextNode","templating.compiler.Node",function(){"use strict";var e=function(t){e.superclass.constructor.call(this,"text"),this.text=t};return e.prototype={doGenerateCode:function(e){var t=this.text;if(t){var n=e.isPreserveWhitespace();n||(t=this.text.replace(/(^\n\s*|\n\s*$)/g,"").replace(/\s+/g," ")),e.addText(t)}},getText:function(){return this.text},isTextNode:function(){return!0},isElementNode:function(){return!1},toString:function(){return"[text]"}},e});
raptor.defineClass("templating.compiler.ParseTreeBuilder",function(){"use strict";var e=raptor.require("xml.sax"),t=raptor.forEach,n=raptor.require("templating.compiler.TextNode"),r=raptor.require("templating.compiler.ElementNode"),i=function(){};return i.parse=function(e,t,n){var r=new i;return r.parse(e,t,n)},i.prototype={parse:function(i,s,o){var u=this.logger(),a=null,f=null,l=null,c,h=e.createParser({trim:!1,normalize:!1,dom:i.documentElement!=null});return h.on({error:function(e){raptor.throwError(e)},characters:function(e){if(!a)return;l?l.text+=e:(l=new n(e),l.pos=h.getPos(),a.appendChild(l))},startElement:function(e){l=null;var n,i,s,u=new r;u.prefix=e.getPrefix(),u.localName=e.getLocalName(),u.qName=e.getQName(),u.uri=o.resolveURI(e.getNamespaceURI()),u.addNamespaceMappings(e.getNamespaceMappings()),u.pos=h.getPos(),t(e.getAttributes(),function(e){e.getLocalName()==="imports"&&!e.getNamespaceURI()&&(n=e.getValue())},this),a?a.appendChild(u):(f=u,n&&(c=o.getImports(n))),t(e.getAttributes(),function(e){var t=o.resolveURI(e.getNamespaceURI()),n=e.getLocalName(),r=e.getPrefix();!t&&c&&(i=c.getImportedAttribute(n))&&(t=i.uri,n=i.name,r=i.prefix),u.setAttributeNS(t,n,e.getValue(),r)},this),!u.uri&&c&&(s=c.getImportedTag(u.localName))&&(u.uri=s.uri,u.localName=s.name,u.prefix=s.prefix),a=u},endElement:function(){l=null,a=a.parentNode}},this),h.parse(i,s),f._isRoot=!0,f},getRootNode:function(){return this.rootNode}},i});
raptor.defineClass("templating.compiler.TaglibXmlLoader",function(e){"use strict";var t=e.require("xml.sax.object-mapper"),n="string",r="boolean",i="object",s=0,o=function(e,t){this.src=e,this.filePath=t};return o.load=function(e,t){var n=new o(e,t);return n.load()},o.prototype={load:function(){var o=this.src,u=this.filePath,a=this.logger(),f={},l=function(t){var n=t["extends"];delete t["extends"];var r=f[n];r||e.throwError(new Error('Parent tag with ID "'+n+'" not found in taglib at path "'+u+'"')),r["extends"]&&l(r),e.forEachEntry(r,function(e,n){t[e]===undefined&&(t[e]=n)}),t.attributeMap&&r.attributeMap&&t.attributeMap!==r.attributeMap?e.forEachEntry(r.attributeMap,function(e,n){t.attributeMap[e]||(t.attributeMap[e]=n)}):r.attributeMap&&(t.attributemap=r.attributeMap)},c=function(e){if(!e)return;for(var t=0,n=e.length;t<n;t++){var r=e[t];r["extends"]&&l(r)}},h,p={"raptor-taglib":{_type:i,_begin:function(){var e={uri:null,shortName:null};return h||(h=e),e},"tlib-version":{_type:n,_targetProp:"version"},"short-name":{_type:n,_targetProp:"shortName"},uri:{_type:n},prefix:{_type:n},tag:{_type:i,_begin:function(){return{}},_end:function(e){e.uri==null&&(e.uri=h.uri),h.tags||(h.tags=[]),e.id&&(f[e.id]=e),h.tags.push(e)},name:{_type:n,_targetProp:"name"},uri:{_type:n,_set:function(e,t,n,r){e.uri=n||""}},id:{_type:n},preserveSpace:{_type:r},"extends":{_type:n,_targetProp:"extends"},"handler-class":{_type:n,_targetProp:"handlerClass"},"compiler-class":{_type:n,_targetProp:"compilerClass"},"dynamic-attributes":{_type:r,_targetProp:"dynamicAttributes"},attribute:{_type:i,_begin:function(){return{type:"string"}},_end:function(e,t){t.attributeMap||(t.attributeMap={});var n=e.uri||"";t.attributeMap[n+":"+e.name]=e},name:{_type:n},uri:{_type:n},required:{_type:r},type:{_type:n},"allow-expressions":{_type:r,_targetProp:"allowExpressions"}},"nested-variable":{_type:i,_begin:function(){return{name:null}},_end:function(t,n){t.name||e.throwError(new Error('The "name" attribute is required for an imported variable')),n.nestedVariables||(n.nestedVariables=[]),n.nestedVariables.push(t)},name:{_type:n,_targetProp:"name"}},"imported-variable":{_type:i,_begin:function(){return{propertyName:null,expression:null}},_end:function(t,n){t.propertyName||e.throwError(new Error('The "property-name" attribute is required for an imported variable')),t.expression||e.throwError(new Error('The "expression" attribute is required for an imported variable')),n.importedVariables||(n.importedVariables=[]),n.importedVariables.push(t)},"property-name":{_type:n,_targetProp:"propertyName"},expression:{_type:n}},transformer:{_type:i,_begin:function(){return{id:s++,className:null,path:null}},_end:function(e,t){t.transformers||(t.transformers=[]),t.transformers.push(e)},"class-name":{_type:n,_targetProp:"className"},after:{_type:n,_targetProp:"after"},before:{_type:n,_targetProp:"before"}}},"text-transformer":{_type:i,_begin:function(){return{id:s++,className:null,path:null}},_end:function(e){h.textTransformers||(h.textTransformers=[]),h.textTransformers.push(e)},"class-name":{_type:n,_targetProp:"className"}},"import-taglib":{_type:i,_begin:function(){return{}},_end:function(n){var r=n.path,i=e.require("resources").findResource(r),s;i.exists()||e.throwError(new Error('Imported taglib with path "'+r+'" not found in taglib at path "'+u+'"')),s=i.readFully(),t.read(s,i.getSystemPath(),p)},path:{_type:n}},"function":{_type:i,_begin:function(){return{}},_end:function(e){h.functions||(h.functions=[]),h.functions.push(e)},name:{_type:n},"class":{_type:n,_targetProp:"functionClass"},"bind-to-context":{_type:r,_targetProp:"bindToContext"}}}};return t.read(o,u,p),c(h.tags),h}},o});
raptor.extend("templating.compiler",function(e,t){"use strict";var n=!1;return{discoverTaglibs:function(){if(n)return;n=!0;var t=$rget("rtld");e.forEach(t,function(t){var n=e.require("resources").findResource(t);n&&n.exists()&&this.loadTaglibXml(n.readFully(),n.getPath())},this)}}});
raptor.defineClass("templating.taglibs.core.CoreTagTransformer",function(e){"use strict";var t=e.extend,n=e.forEach,r="http://raptorjs.org/templates/core",i=e.errors,s=e.require("templating.compiler.Node"),o=e.require("templating.taglibs.core.WriteNode"),u=e.require("templating.taglibs.core.ForNode"),a=e.require("templating.taglibs.core.IfNode"),f=e.require("templating.taglibs.core.WhenNode"),l=e.require("templating.taglibs.core.OtherwiseNode"),c=e.require("templating.taglibs.core.TagHandlerNode"),h=e.require("templating.compiler.Expression"),p=e.require("templating.compiler.AttributeSplitter"),d=e.require("templating.compiler.TypeConverter"),v=function(e,t,n){return d.convert(e,t,n)};return{process:function(i,s){var d=this,m,g,y,b,w,E,S,x,T,N=function(e,t){n(i.getAttributes(),function(n){if(n.uri==="http://www.w3.org/2000/xmlns/"||n.uri==="http://www.w3.org/XML/1998/namespace"||n.prefix=="xmlns")return;var r=n.prefix,o=n.prefix&&n.uri!=P.taglib.uri?n.uri:null,u=P.getAttributeDef(o,n.localName);!u&&o&&(o=s.taglibs.resolveShortName(o),u=P.getAttributeDef(o,n.localName));var a=u?u.type||"string":"string",f,l=n.uri;try{f=v(n.value,a,u?u.allowExpressions!==!1:!0)}catch(c){i.addError('Invalid attribute value of "'+n.value+'" for attribute "'+n.name+'": '+c.message),f=n.value}l===P.taglib.uri&&(l="",r=""),!u&&!P.dynamicAttributes&&i.addError('The tag "'+P.name+'" in taglib "'+P.taglib.uri+'" does not support attribute "'+n+'"'),e.call(t,l,n.localName,f,r,u)},this)};(w=i.getAttributeNS(r,"parseBodyText"))!=null&&(i.removeAttributeNS(r,"parseBodyText"),i.parseBodyText=w!=="false");if((b=i.getAttributeNS(r,"when"))!=null){i.removeAttributeNS(r,"when");var C=new f({test:new h(b),pos:i.getPosition()});i.parentNode.replaceChild(C,i),C.appendChild(i)}if(i.getAttributeNS(r,"otherwise")!=null){i.removeAttributeNS(r,"otherwise");var k=new l({pos:i.getPosition()});i.parentNode.replaceChild(k,i),k.appendChild(i)}(y=i.getAttributeNS(r,"attrs"))!=null&&(i.removeAttributeNS(r,"attrs"),i.dynamicAttributesExpression=y);if((m=i.getAttributeNS(r,"for"))!=null){i.removeAttributeNS(r,"for");var L=p.parse(m,{each:{type:"custom"},separator:{type:"expression"},varStatus:{type:"identifier"}},{defaultName:"each",errorHandler:function(e){i.addError('Invalid c:for attribute of "'+m+'". Error: '+e)}});L.pos=i.getPosition();var A=new u(L);i.parentNode.replaceChild(A,i),A.appendChild(i)}if((g=i.getAttributeNS(r,"if"))!=null){i.removeAttributeNS(r,"if");var O=new a({test:new h(g),pos:i.getPosition()});i.parentNode.replaceChild(O,i),O.appendChild(i)}if((S=i.getAttributeNS(r,"bodyContent"))!=null){i.removeAttributeNS(r,"bodyContent");var M=new o({expression:S,pos:i.getPosition()});i.removeChildren(),i.appendChild(M)}i.getAttributeNS&&(E=i.getAttributeNS(r,"strip"))!=null&&(i.removeAttributeNS(r,"strip"),i.setStripExpression||i.addError("The c:strip directive is not allowed for target node"),i.setStripExpression(E));if(i.getAttributeNS&&(x=i.getAttributeNS(r,"replace"))!=null){i.removeAttributeNS(r,"replace");var _=new o({expression:x,pos:i.getPosition()});i.parentNode.replaceChild(_,i),i=_}var D=i.uri,P=s.taglibs.getTagDef(D,i.localName);if(P){P.preserveSpace&&(i.preserveSpace=!0);if(P.handlerClass)c.convertNode(i,P),N(function(e,t,n,r,s){s?i.setPropertyNS(e,t,n):i.addDynamicAttribute(r?r+":"+t:t,n)});else if(P.compilerClass){var H=e.require(P.compilerClass);t(i,H.prototype),H.call(i),i.setNodeClass(H),N(function(e,t,n){i.setPropertyNS(e,t,n)})}}else D&&s.taglibs.isTaglib(D)&&i.addError("Tag "+i.toString()+' is not allowed in taglib "'+D+'"')}}});
raptor.defineClass("templating.taglibs.core.CoreTextTransformer",function(){"use strict";var e=raptor.require("templating.compiler.ExpressionParser"),t=raptor.require("templating.compiler.TextNode"),n=raptor.require("templating.taglibs.core.WriteNode"),r=raptor.require("templating.taglibs.core.ScriptletNode");return{process:function(i,s){if(i.parentNode&&i.parentNode.parseBodyText===!1)return;var o=[];e.parse(i.text,{text:function(e){o.push({text:e})},expression:function(e){o.push({expression:e})},scriptlet:function(e){o.push({scriptlet:e})},error:function(e){i.addError(e)}},this);if(o.length>0){var u=0;o[0].text?(i.text=o[0].text,u=1):(i.text="",u=0);var a=[];for(var f=u;f<o.length;f++){var l=o[f],c=null;l.hasOwnProperty("text")?(c=new t(l.text),c.setTransformerApplied(this)):l.hasOwnProperty("expression")?c=new n({expression:l.expression,escapeXml:l.expression.escapeXml!==!1}):l.hasOwnProperty("scriptlet")&&(c=new r(l.scriptlet)),c&&a.push(c)}i.parentNode.insertAfter(a,i)}}}});
raptor.defineClass("templating.taglibs.core.ForNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=/^(.+)\s+in\s+(.+)$/,n=raptor.require("json.stringify").stringify,r=function(e){var n=e.match(t);if(!n)throw new Error('Invalid each attribute of "'+e+'"');return{"var":n[1],"in":n[2]}},i=function(e){i.superclass.constructor.call(this),e&&this.setProperties(e)};return i.prototype={doGenerateCode:function(e){var t=this.getProperty("each"),i=this.getProperty("separator"),s=this.getProperty("varStatus");if(!t){this.addError('"each" attribute is required'),this.generateCodeForChildren(e);return}var o;try{o=r(t)}catch(u){this.addError(u.message),this.generateCodeForChildren(e);return}var a=e.makeExpression(o["in"]),f=o["var"];i&&!s&&(s="__loop");var l=[f];s&&l.push(s),e.addJavaScriptCode(e.getStaticHelperFunction("forEach","f")+"("+a+",function("+l.join(",")+"){"),this.generateCodeForChildren(e),i&&(e.addJavaScriptCode("if (!"+s+".isLast()){"),e.addWrite(e.isExpression(i)?i.getExpression():n(i)),e.addJavaScriptCode("}")),e.addJavaScriptCode("});")}},i});
raptor.defineClass("templating.taglibs.core.IfNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(e){var t=this.getProperty("test");t||this.addError('"test" attribute is required'),e.addJavaScriptCode("if ("+t+"){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")}},t});
raptor.defineClass("templating.taglibs.core.TagHandlerNode","templating.compiler.Node",function(e){"use strict";var t=e.extend,n=e.forEach,r=e.require("json.stringify").stringify,i=e.forEachEntry,s=e.require("templating.compiler.Expression"),o=function(e,t){var n=e._handlerVars;n||(e._handlerVars=n={});var i=n[t];return i||(n[t]=i=t.replace(/[.\-]/g,"_"),e.addStaticVar(i,e.getStaticHelperFunction("getTagHandler","t")+"("+r(t)+")")),i},u=function(e){var t,n=[];return e?(i(e,function(e,t){t instanceof s?n.push(r(e)+":"+t.expression):typeof t=="string"?n.push(r(e)+":"+r(t)):n.push(r(e)+":"+t)}),n.length?"{"+n.join(",")+"}":"{}"):"{}"},a=function(e){this.nodeType||a.superclass.constructor.call(this),this.tagDef=e,this.dynamicAttributes=null};return a.convertNode=function(e,n){t(e,a.prototype),a.call(e,n)},a.prototype={addDynamicAttribute:function(e,t){this.dynamicAttributes||(this.dynamicAttributes={}),this.dynamicAttributes[e]=t},doGenerateCode:function(e){var t=o(e,this.tagDef.handlerClass);e.addJavaScriptCode(e.getContextHelperFunction("invokeHandler","t")+"("+t+","),n(this.tagDef.importedVariables,function(e){this.setProperty(e.propertyName,new s(e.expression))},this),e.addJavaScriptCode(u(this.getProperties())+",");if(this.hasChildren()){var r=[];n(this.tagDef.nestedVariables,function(e){r.push(e.name)}),e.addJavaScriptCode("function("+r.join(",")+"){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")}else e.addJavaScriptCode("null");var i=this.getPropertyNamespaces(),a=[];n(i,function(e){if(e!==""){var t=this.getPropertiesNS(e);a.push('"'+e+'":'+u(t))}},this),this.dynamicAttributes&&a.push('"*":'+u(this.dynamicAttributes)),a.length&&(e.addJavaScriptCode(",{"),e.addJavaScriptCode(a.join(",")),e.addJavaScriptCode("}")),e.addJavaScriptCode(");")}},a});
raptor.defineClass("templating.taglibs.core.TemplateNode","templating.compiler.Node",function(){"use strict";var e=raptor.forEach,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(t){var n=this.getProperty("name"),r=this.getProperty("params"),i=function(e){var n=e.replace(/[^a-zA-Z0-9]+/g,"_");return t.hasStaticVar(n)||t.addStaticVar(n,JSON.stringify(e)),n},s;r?(r=r.split(/\s*,\s*/g),e(r,function(e){t.addVar(e,"data."+e)},this)):r=null,this.forEachProperty(function(n,r,o){n||(n=this.uri),r==="functions"&&e(o.split(/\s*[,;]\s*/g),function(e){var r=t.compiler.taglibs.getFunction(n,e);r?(s=i(r.functionClass),r.bindToContext===!0?t.addVar(e,t.getContextHelperFunction("getContextHelper","h")+"("+s+","+JSON.stringify(e)+")"):t.addStaticVar(e,t.getStaticHelperFunction("getHelper","h")+"("+s+","+JSON.stringify(e)+")")):this.addError('Function with name "'+e+'" not found in taglib "'+n+'"')},this)},this),n?t.setTemplateName(n):t.getTemplateName()||this.addError('The "name" attribute is required for the '+this.toString()+" tag or it must be passed in as a compiler option."),this.generateCodeForChildren(t)}},t});
raptor.defineClass("templating.taglibs.core.WriteNode","templating.compiler.Node",function(){"use strict";var e=function(t){e.superclass.constructor.call(this,"write"),t&&this.setProperties(t)};return e.prototype={doGenerateCode:function(e){var t=this.getExpression(),n=this.getProperty("escapeXml")!==!1;t&&e.addWrite(t,{escapeXml:n})},getExpression:function(){return this.getProperty("expression")||this.getProperty("value")||this.getAttribute("expression")||this.getAttribute("value")},toString:function(){return'<c:write expression="'+this.getExpression()+'">'}},e});
raptor.defineClass("templating.taglibs.core.InvokeNode","templating.compiler.Node",function(){"use strict";var e=raptor.forEach,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(t){var n=this.getProperty("function"),r,i=t.getAttribute("core:definedFunctions");n||this.addError('"function" attribute is required');if(n.indexOf("(")===-1){r=i?i[n]:null;var s=[],o={},u=[];r&&(u=r.params||[],e(u,function(e){o[e]=!0},this)),this.forEachPropertyNS("",function(e,t){if(e==="function")return;o[e]||this.addError('Parameter with name "'+e+'" not supported for function with name "'+n+'". Allowed parameters: '+u.join(", "))},this),e(u,function(e){o[e]=!0;var t=this.getAttribute(e);t==null?s.push("undefined"):s.push(this.getProperty(e))},this),t.addWrite(n+"("+s.join(",")+")")}else{var a=n.substring(0,n.indexOf("("));r=i?i[a]:null,r?t.addWrite(n):t.addJavaScriptCode(n+";")}}},t});
raptor.defineClass("templating.taglibs.core.ScriptletNode","templating.compiler.Node",function(){"use strict";var e=function(t){e.superclass.constructor.call(this,"scriptlet"),this.code=t};return e.prototype={doGenerateCode:function(e){this.code&&e.addJavaScriptCode(this.code)},toString:function(){return"{%"+this.code+"%}"}},e});
raptor.defineClass("templating.taglibs.core.ChooseNode","templating.compiler.Node",function(e){"use strict";var t=e.require("strings"),n=e.require("templating.taglibs.core.WhenNode"),r=e.require("templating.taglibs.core.OtherwiseNode"),i=function(e){i.superclass.constructor.call(this)};return i.prototype={doGenerateCode:function(e){var i=null,s=!1;this.forEachChild(function(o){o.isTextNode()?t.isEmpty(o.getText())||this.addError('Static text "'+t.trim(o.getText())+'" is not allowed in '+this.toString()+" tag."):o.getNodeClass()===n?(i&&this.addError(i+" tag must be last child of tag "+this+"."),s||(s=!0,o.firstWhen=!0),o.generateCode(e)):o.getNodeClass()===r?(i&&this.addError("More than one "+i+" tag is not allowed as child of tag "+this+"."),i=o,o.generateCode(e)):this.addError(o+" tag is not allowed as child of tag "+this+".")},this),s||this.addError(""+i+" tag is required to have at least one sibling <c:when> tag.")}},i});
raptor.defineClass("templating.taglibs.core.DefNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=raptor.require("strings"),n=/^([A-Za-z_][A-Za-z0-9_]*)\(((?:[A-Za-z_][A-Za-z0-9_]*,\s*)*[A-Za-z_][A-Za-z0-9_]*)?\)$/,r=function(e){r.superclass.constructor.call(this),e&&this.setProperties(e)};return r.prototype={doGenerateCode:function(e){var r=this.getProperty("function");if(!r){this.addError('"function" attribute is required'),this.generateCodeForChildren(e);return}r=t.trim(r);var i=n.exec(r);if(!i){this.addError('Invalid function name of "'+r+'"'),this.generateCodeForChildren(e);return}var s=i[1],o=i[2]?i[2].split(/\s*,\s*/):[],u=e.getAttribute("core:definedFunctions");u||(u=e.setAttribute("core:definedFunctions",{})),u[s]={params:o},e.addJavaScriptCode("function "+r+"{return "+e.getContextHelperFunction("captureXml","c")+"(function(){"),this.generateCodeForChildren(e),e.addJavaScriptCode("});}")}},r});
raptor.defineClass("templating.taglibs.core.IncludeNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=raptor.require("json.stringify").stringify,n=function(e){n.superclass.constructor.call(this),e&&this.setProperties(e)};return n.prototype={doGenerateCode:function(e){var n=this.getProperty("template"),r;if(n){this.removeProperty("template");var i=[];this.forEachPropertyNS("",function(e,n){i.push(t(e)+": "+n)},this);var s=e.getContextHelperFunction("include","i")+"("+n+",{"+i.join(",")+"});";e.addJavaScriptCode(s)}else if(r=this.getAttribute("resource")){var o=this.getProperty("static")!==!1;if(o){var u=raptor.require("resources").findResource(r);if(!u.exists()){this.addError('"each" attribute is required');return}e.addWrite(raptor.require("json.stringify").stringify(u.readFully()))}}else this.addError('"template" or "resource" attribute is required')}},n});
raptor.defineClass("templating.taglibs.core.OtherwiseNode","templating.compiler.Node",function(e){"use strict";var t=e.require("strings"),n=function(e){n.superclass.constructor.call(this),e&&this.setProperties(e)};return n.prototype={doGenerateCode:function(e){e.addJavaScriptCode(" else {"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")},toString:function(){return"<c:otherwise>"}},n});
raptor.defineClass("templating.taglibs.core.WhenNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(e){var t=this.getProperty("test");t||(console.error("WHEN NODE: ",this.properties),this.addError('"test" attribute is required for '+this.toString()+" tag.")),this.firstWhen||e.addJavaScriptCode(" else "),e.addJavaScriptCode("if ("+t+"){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")}},t});
raptor.defineClass("templating.taglibs.core.WithNode","templating.compiler.Node",function(e){"use strict";var t=e.errors,n=e.require("templating.compiler.AttributeSplitter"),r=/^[A-Za-z_][A-Za-z0-9_]*$/,i=function(e){i.superclass.constructor.call(this),e&&this.setProperties(e)};return i.prototype={doGenerateCode:function(t){var i=this.getProperty("vars"),s=this;i||this.addError('"vars" attribute is required');var o=n.parse(i,{"*":{type:"expression"}},{ordered:!0,errorHandler:function(e){s.addError('Invalid variable declarations of "'+i+'". Error: '+e)}}),u=[];e.forEach(o,function(e){r.test(e.name)||this.addError('Invalid variable name of "'+e.name+'" in "'+i+'"'),u.push(e.name+(e.value?"="+e.value:""))},this),t.addJavaScriptCode("(function() {"),t.addJavaScriptCode("var "+u.join(",")+";"),this.generateCodeForChildren(t),t.addJavaScriptCode("}());")}},i});
$rset("resource","/templating/taglibs/core/core.rtld",'<raptor-taglib>\n    \n    \n    <tlib-version>1.0</tlib-version>\n    \n    <uri>http://raptorjs.org/templates/core</uri>\n    <short-name>core</short-name>\n    <prefix>c</prefix>\n    \n    <tag id="template">\n        \n        <name>template</name> \n        \n        <attribute>\n            <name>name</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>params</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>imports</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <uri>*</uri>\n            <name>functions</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n\n        <compiler-class>templating.taglibs.core.TemplateNode</compiler-class>\n    </tag>\n    \n    <tag extends="template">\n    \n        <uri></uri>\n        <name>template</name>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>*</name> \n        <uri>*</uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <attribute>\n            <name>for</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n\n        <attribute>\n            <name>if</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>attrs</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>when</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>otherwise</name>\n            <type>empty</type>\n        </attribute>\n        \n        <attribute>\n            <name>parseBodyText</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>strip</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>bodyContent</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>replace</name>\n            <type>expression</type>\n        </attribute>\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.core.CoreTagTransformer</class-name>\n        </transformer>\n    </tag>\n    \n    \n    \n    <tag>\n        \n        <name>for</name> \n\n        <compiler-class>templating.taglibs.core.ForNode</compiler-class>\n        \n        <attribute>\n            <name>each</name>\n            <required>true</required>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>separator</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>varStatus</name>\n            <type>identifier</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n    </tag>\n    \n    <tag>\n        \n        <name>write</name> \n\n        <compiler-class>templating.taglibs.core.WriteNode</compiler-class>\n        \n        <attribute>\n            <name>value</name>\n            <required>true</required>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>escapeXml</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>if</name> \n\n        <compiler-class>templating.taglibs.core.IfNode</compiler-class>\n\n        <attribute>\n            <name>test</name>\n            <type>expression</type>\n        </attribute>\n\n    </tag>\n    \n    <tag>\n        \n        <name>invoke</name> \n\n        <compiler-class>templating.taglibs.core.InvokeNode</compiler-class>\n\n        <attribute>\n            <name>function</name>\n            <type>custom</type>\n            <allow-expressions>false</allow-expressions>\n            <required>true</required>\n        </attribute>\n\n        <attribute>\n            <name>*</name>\n            <uri></uri>\n            <type>string</type>\n            <allow-expressions>true</allow-expressions>\n        </attribute>\n    </tag>\n    \n    <tag>\n        \n        <name>choose</name> \n\n        <compiler-class>templating.taglibs.core.ChooseNode</compiler-class>\n\n    </tag>\n\n    <tag>\n        \n        <name>when</name> \n\n        <compiler-class>templating.taglibs.core.WhenNode</compiler-class>\n\n        <attribute>\n            <name>test</name>\n            <type>expression</type>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>otherwise</name> \n\n        <compiler-class>templating.taglibs.core.OtherwiseNode</compiler-class>\n\n    </tag>\n        \n    <tag>\n        \n        <name>def</name> \n\n        <compiler-class>templating.taglibs.core.DefNode</compiler-class>\n\n        <attribute>\n            <name>function</name>\n            <type>custom</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>with</name> \n\n        <compiler-class>templating.taglibs.core.WithNode</compiler-class>\n\n        <attribute>\n            <name>vars</name>\n            <type>custom</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>include</name> \n\n        <compiler-class>templating.taglibs.core.IncludeNode</compiler-class>\n\n        <attribute>\n            <name>template</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>resource</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>static</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <dynamic-attributes>true</dynamic-attributes>\n        \n    </tag>\n    \n    <text-transformer>\n        <class-name>templating.taglibs.core.CoreTextTransformer</class-name>\n    </text-transformer>\n    \n</raptor-taglib>'),$radd("rtld","/templating/taglibs/core/core.rtld");
raptor.defineClass("templating.taglibs.html.HtmlTagTransformer",function(){"use strict";return{process:function(e,t){if(e.isElementNode()){var n=t.options||{},r=n.preserveWhitespace||{},i=n.allowSelfClosing||{},s=n.startTagOnly||{},o=e.uri?e.uri+":"+e.localName:e.localName;r[o]===!0&&e.setPreserveSpace(!0),i[o]===!1&&e.setAllowSelfClosing(!1),t.options.xhtml!==!0&&s[o]===!0&&e.setStartTagOnly(!0)}}}});
$rset("resource","/templating/taglibs/html/html.rtld","<raptor-taglib>\n    \n    \n    <tlib-version>1.0</tlib-version>\n    <short-name>html</short-name>\n    <uri>http://raptorjs.org/templates/html</uri>\n\n    <tag>\n        \n        <name>pre</name> \n        <uri></uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.html.HtmlTagTransformer</class-name>\n        </transformer>\n    </tag>\n    \n    <tag>\n        \n        <name>*</name> \n        <uri>*</uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.html.HtmlTagTransformer</class-name>\n        </transformer>\n    </tag>\n    \n</raptor-taglib>"),$radd("rtld","/templating/taglibs/html/html.rtld");
raptor.defineClass("templating.taglibs.widgets.WidgetsTagTransformer",function(e){"use strict";var t="http://raptorjs.org/templates/widgets";return{process:function(e,n,r){var i,s;if(i=e.getPropertyNS(t,"id"))e.removePropertyNS(t,"id"),e.setProperty("widgetContext",r.makeExpression("[widget, "+i+"]"));if(s=e.getAttributeNS(t,"widget")){e.removeAttributeNS(t,"widget");var o=n.createTagHandlerNode(t,"widget");e.parentNode.replaceChild(o,e),o.appendChild(e),o.setProperty("jsClass",s),o.setProperty("widgetContext",r.makeExpression("[widget, "+i+"]"));var u=e.getAttribute("id");u?(u=n.convertType(u,"string",!0),o.setProperty("id",u)):e.setAttribute("id","${widget.elId()}")}}}});
raptor.defineClass("templating.taglibs.widgets.InitWidgetsTag",function(e){"use strict";var t=e.require("widgets");return{process:function(e,n){if(!t.hasWidgets(n))return;var r=e.includeScriptTag!==!1;r&&n.write('<script type="text/javascript">'),t.writeInitWidgetsCode(n,!0),r&&n.write("</script>")}}});
raptor.defineClass("templating.taglibs.widgets.WidgetTag",function(e){"use strict";var t=e.require("widgets");return{process:function(e,n){var r=e.jsClass,i=e.config,s=e.widgetContext,o=e.id,u,a;s&&(u=s[0],a=s[1]);var f=t.addWidget(r,o,a,i,u,n);e.invokeBody(f)}}});
$rset("resource","/templating/taglibs/widgets/widgets.rtld",'<raptor-taglib>\n    \n    \n    <tlib-version>1.0</tlib-version>\n    <short-name>widgets</short-name>\n    <uri>http://raptorjs.org/templates/widgets</uri>\n    \n    <tag>\n        \n        <name>*</name> \n        <uri>*</uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <attribute>\n            <name>id</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>widget</name>\n        </attribute>\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.widgets.WidgetsTagTransformer</class-name>\n            <after>templating.taglibs.core.CoreTagTransformer</after>\n        </transformer>\n    </tag>\n    \n    <tag>\n        <name>widget</name>\n        <handler-class>templating.taglibs.widgets.WidgetTag</handler-class>\n        \n        <attribute name="jsClass" type="string"/>\n        \n        <nested-variable name="widget"/>\n        \n        <imported-variable property-name="config" expression="data.widgetConfig"/>\n        <imported-variable property-name="widgetContext" expression="data.widgetContext"/>\n    </tag>\n    \n    <tag>\n        <name>initWidgets</name>\n        <handler-class>templating.taglibs.widgets.InitWidgetsTag</handler-class>\n        \n        <attribute name="includeScriptTag" type="boolean"/>\n    </tag>\n    \n</raptor-taglib>'),$radd("rtld","/templating/taglibs/widgets/widgets.rtld");
$rset("rhtml","taglibs/test/Button",function(e){var t=e.e,n=e.ne,r=e.t,i=r("templating.taglibs.widgets.WidgetTag"),s=e.xa,o=e.x;return function(e,t,n){var r=n.w,u=e.widget,a=e.buttonAttrs,f=e.label,l=n.t,c=n.a;l(i,{jsClass:"taglibs.test.ButtonWidget",widgetContext:e.widgetContext,config:e.widgetConfig},function(e){r('<button id="')(s(e.elId()))('"'),c(a),r(">")(o(f))("</button>")})}});
raptor.defineClass("taglibs.test.Button.ButtonTag",function(e){return{process:function(e,t){var n=e.disabled===!0,r={disabled:n?null:undefined,type:e.type||"button"};e.color&&(r.style="background-color: "+e.color),t.renderTemplate("taglibs/test/Button",{label:e.label,widgetContext:e.widgetContext,widgetConfig:{disabled:n},buttonAttrs:r})}}});
$rset("rhtml","taglibs/test/Container",function(e){var t=e.e,n=e.ne,r=e.x;return function(e,t,n){var i=n.w,s=e.widget,o=e.title;i("<div><h1>")(r(o))('</h1><div class="bd">'),e.invokeBody(),i("</div></div>")}});
raptor.defineClass("taglibs.test.Container.ContainerTag",function(e){return{process:function(e,t){t.renderTemplate("taglibs/test/Container",{title:e.title,invokeBody:e.invokeBody})}}});
raptor.defineClass("taglibs.test.Greeting.GreetingTag",function(e){var t=function(){};return t.prototype={process:function(e,t){t.write("Hello "+e.name+"!")}},t});
raptor.defineClass("taglibs.test.Tab.TabTag",function(e){var t=function(){};return t.prototype={process:function(e,t){var n=e.tabs;n.addTab(e)}},t});
$rset("rhtml","taglibs/test/Tabs",function(e){var t=e.e,n=e.ne,r=e.f,i=e.xa,s=e.x;return function(e,t,n){var o=n.w,u=e.tabs;o('<div class="tabs"><ul class="nav nav-tabs">'),r(u,function(e){o('<li class="')(i(e.liClass))('"><a href="#')(i(e.id))('" data-toggle="tab">')(s(e.title))("</a></li>")}),o('</ul><div class="tab-content">'),r(u,function(e){o('<div id="')(i(e.id))('" class="')(i(e.divClass))('">'),e.invokeBody(),o("</div>")}),o("</div></div>")}});
raptor.defineClass("taglibs.test.Tabs.TabsTag",function(e){var t=e.require("templating"),n=function(){};return n.prototype={process:function(n,r){var i=[],s=!1;n.invokeBody({addTab:function(e){e.active&&(e.activeFound=!0),e.id="tab"+i.length,i.push(e)}}),!s&&i.length&&(i[0].active=!0),e.forEach(i,function(e){e.liClass=e.active?"active":"",e.divClass=e.active?"tab-pane active":"tab-pane"}),t.render("taglibs/test/Tabs",{tabs:i},r)}},n});
raptor.define("taglibs.test.TestFunctions",{upperCase:function(e){return e?e.toString().toUpperCase():""},classNames:function(){var e=[];for(var t=0,n=arguments.length,r;t<n;t++)r=arguments[t],r&&e.push(r);return e.join(" ")}});
$rset("resource","/taglibs/test/test.rtld",'<raptor-taglib>\n    \n    <tlib-version>1.0</tlib-version>\n    <short-name>test</short-name>\n    <uri>http://raptorjs.org/templates/test</uri>\n    \n    <import-taglib path="/taglibs/test/Button/Button.rtld"/>\n    <import-taglib path="/taglibs/test/Container/Container.rtld"/>\n    <import-taglib path="/taglibs/test/Greeting/Greeting.rtld"/>\n    <import-taglib path="/taglibs/test/Tab/Tab.rtld"/>\n    <import-taglib path="/taglibs/test/Tabs/Tabs.rtld"/>\n    \n    <function class="taglibs.test.TestFunctions">\n        <name>upperCase</name>\n    </function>\n    \n    <function class="taglibs.test.TestFunctions">\n        <name>classNames</name>\n    </function>\n\n</raptor-taglib>'),$radd("rtld","/taglibs/test/test.rtld");
$rset("resource","/taglibs/test/Button/Button.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>button</name>\n        <handler-class>taglibs.test.Button.ButtonTag</handler-class>\n        \n        <attribute name="label"/>\n        <attribute name="type"/>\n        <attribute name="color"/>\n        <attribute name="disabled" type="boolean"/>\n        <attribute name="id" uri="widgets" type="string"/>\n    </tag>\n    \n</raptor-taglib>');
$rset("resource","/taglibs/test/Container/Container.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>container</name>\n        <handler-class>taglibs.test.Container.ContainerTag</handler-class>\n        \n        <attribute name="title"/>\n    </tag>\n    \n</raptor-taglib>');
$rset("resource","/taglibs/test/Greeting/Greeting.rtld","<raptor-taglib>\n\n    <tag>\n        <name>greeting</name>\n        <handler-class>taglibs.test.Greeting.GreetingTag</handler-class>\n        <attribute>\n            <name>name</name>\n        </attribute>\n        <attribute>\n            <name>adult</name>\n            <type>boolean</type>\n        </attribute>\n    </tag>\n    \n</raptor-taglib>");
$rset("resource","/taglibs/test/Tab/Tab.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>tab</name>\n        <handler-class>taglibs.test.Tab.TabTag</handler-class>\n        \n        <attribute name="title"/>\n        \n        <imported-variable property-name="tabs" expression="tabs"/>\n    </tag>\n    \n</raptor-taglib>');
$rset("resource","/taglibs/test/Tabs/Tabs.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>tabs</name>\n        <handler-class>taglibs.test.Tabs.TabsTag</handler-class>\n        <nested-variable name="tabs"/>\n    </tag>\n    \n</raptor-taglib>');
raptor.define("components.buttons.Button.ButtonWidget",function(e){var t=function(e){var t=this;this.toggled=!1,this.jqueryButton=this.$(),this._toggle=e.toggle,e.toggled&&this.toggle(),this.$().click(function(){t.publish("click",{button:this}),t._toggle&&t.toggle()})};return t.events=["click","toggle"],t.prototype={toggle:function(){this.toggled=!this.toggled,this.jqueryButton.button("toggle"),this.publish("toggle",{button:this})}},t});
!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery);
raptor.define("components.nav.Nav.NavWidget",function(e){var t=function(e){var t=this;this.$("LI").click(function(){t.publish("navItemClick",{el:this,nav:t})})};return t.events=["navItemClick"],t.prototype={},t});
raptor.define("components.templates.Errors.ErrorsWidget",function(e){var t=function(e){this._hasErrors=!1};return t.prototype={setErrors:function(e){e&&e.length?(this.$("#ul").empty(),this.addErrors(e)):(this._hasErrors=!1,this.$("#ul").hide().empty())},clearErrors:function(){this.setErrors(null)},hasErrors:function(){return this._hasErrors},addErrors:function(t){if(t&&t.length){this._hasErrors=!0;var n=this.getEl("ul");e.forEach(t,function(t){var r=document.createElement("LI");r.innerHTML=e.require("templating").renderToString("components/templates/Errors-error",{message:t.message}),n.appendChild(r)},this),this.$("#ul").show()}}},t});
$rset("rhtml","components/templates/Errors-error",function(e){var t=e.e,n=e.ne,r=e.x;return function(e,t,n){var i=n.w,s=e.message;i('<span class="x"></span><pre class="message">')(r(s))("</pre>")}});
raptor.define("components.templates.TemplateTestbed.TemplateTestbedWidget",function(raptor){var stringify=raptor.require("json.stringify").stringify,TemplateTestbedWidget=function(e){this.samples=e.samples,this.autoRender=!0,this.compileRequired=!0,this.dataModified=!0,this.optionsModified=!0,this.renderRequired=!0,this.optionsVisible=!1,this.defaultOptionsJson=stringify(raptor.require("templating.compiler").defaultOptions),this.loadSample(0),this.renderButton.subscribe("click",function(e){this.update()},this),this.showCompiledToggleButton.subscribe("toggle",function(e){this.toggleCompiledOutput()},this),this.showOptionsToggleButton.subscribe("toggle",function(e){this.toggleCompilerOptions()},this),this.autoRenderToggleButton.subscribe("toggle",function(e){this.autoRender=!this.autoRender},this),this.templateEditor.subscribe("change",function(){this.compileRequired=!0,this.renderRequired=!0,this.autoRender&&this.update()},this),this.dataEditor.subscribe("change",function(){this.dataModified=!0,this.renderRequired=!0,this.autoRender&&this.update()},this),this.optionsEditor.subscribe("change",function(){this.optionsModified=!0,this.compileRequired=!0,this.renderRequired=!0,this.autoRender&&this.update()},this),this.samplesNav.subscribe("navItemClick",function(e){var t=$(e.el).data("sample");this.loadSample(t)},this)};return TemplateTestbedWidget.prototype={loadSample:function(e){var t=this.samples[e];t.templatesLoaded||(raptor.forEach(t.templates,function(e){raptor.require("templating.compiler").compileAndLoad(e.source,e.path)},this),t.templatesLoaded=!0),this.templateEditor.setValue(t.template),this.dataEditor.setValue(t.data),this.optionsEditor.setValue(t.options||this.defaultOptionsJson),this.update(),t.showCompilerOptions&&this.toggleCompilerOptions(!0)},handleEditorException:function(e,t){var n=t.errors;n||(n=[{message:t.toString()}]),e.addErrors(n)},update:function(){this.updateJson("compilerOptions","optionsModified",this.optionsEditor,this.optionsErrors),this.compileTemplate(),this.updateJson("templateData","dataModified",this.dataEditor,this.dataErrors),this.renderTemplate()},compileTemplate:function(){if(!this.compilerOptions)return;if(!this.compileRequired)return;this.templateName=null;var templateSrc=this.templateEditor.getValue(),compiler=raptor.require("templating.compiler"),compiledSrc;this.templateErrors.clearErrors();var templateDom;try{templateDom=raptor.require("xml.dom").createParser().parse(templateSrc)}catch(e){this.handleEditorException(this.templateErrors,"Invalid XML")}if(templateDom)try{var compilerOptions=raptor.extend({defaultTemplateName:"test",nameCallback:function(e){templateName=e}},this.compilerOptions);compiledSrc=compiler.compile(templateDom,"test",compilerOptions)}catch(e){this.handleEditorException(this.templateErrors,e)}if(compiledSrc){this.compiledEditor.setValue(compiledSrc),raptor.require("templating").unload(templateName);try{eval(compiledSrc),this.templateName=templateName}catch(e){this.handleEditorException(this.templateErrors,e)}}else this.compiledEditor.setValue("");this.compileRequired=!1},updateJson:function(targetProp,modifiedProp,editor,errors){if(!this[modifiedProp])return;this[targetProp]=null,errors.clearErrors();var jsonData=editor.getValue(),data;try{data=eval("("+jsonData+")"),this[targetProp]=data}catch(e){this.handleEditorException(errors,e)}this[modifiedProp]=!1},renderTemplate:function(){if(!this.renderRequired)return;if(this.templateData&&this.templateName&&this.compilerOptions)try{var e=raptor.require("templating").renderToString(this.templateName,this.templateData);this.outputEditor.setValue(e),this.$("#htmlViewer").html(e)}catch(t){this.handleEditorException(this.templateErrors,t),this.outputEditor.setValue(""),this.$("#htmlViewer").html("")}else this.outputEditor.setValue(""),this.$("#htmlViewer").html("");this.renderRequired=!1},toggleCompiledOutput:function(){this.$("#compiledTemplateSection").toggle()},toggleCompilerOptions:function(e){if(arguments.length===1&&e===this.visible)return;this.optionsVisible=!this.optionsVisible,this.optionsVisible?this.$("#compilerOptionsSection").removeClass("compiler-options-hidden"):this.$("#compilerOptionsSection").addClass("compiler-options-hidden")}},TemplateTestbedWidget});
$rload(function(e){"use strict";var t="",n=function(e){return e?e.replace(/^\s*|\s*$/g,""):t},r=/\$\{([A-Za-z0-9_\.]+)\}/g;e.defineCore("strings",{compare:function(e,t){return e<t?-1:e>t?1:0},isEmpty:function(e){return e==null||n(e).length===0},length:function(e){return e==null?0:e.length},isString:function(e){return e!=null&&e.constructor===String},equals:function(e,t,r){return r!==!1&&(e=n(e),t=n(t)),e==t},notEquals:function(e,t,n){return this.equals(e,t,n)===!1},trim:n,ltrim:function(e){return e?e.replace(/^\s*/g,""):t},rtrim:function(e){return e?e.replace(/\s*$/g,""):t},startsWith:function(e,t){return!e||e.length<t.length?!1:e.substring(0,t.length)===t},endsWith:function(e,t){return!e||e.length<t.length?!1:e.substring(e.length-t.length)===t},unicodeEncode:function(e){return"\\u"+("0000"+(+e.charCodeAt(0)).toString(16)).slice(-4)},merge:function(e,t){var n,i=[],s=0;r.lastIndex=0;while(n=r.exec(e))i.push(e.substring(s,n.index)),i.push(t[n[1]]||n[0]),s=r.lastIndex;return i.push(e.substring(s)),i.join("")}})})
$rload(function(e){"use strict";var t=function(){this.array=[],this.length=0,this.memberProp=!0};t.prototype={append:function(e){var t=e==null?"null":e.toString();return this.length+=t.length,this.array.push(t),this},write:function(e){return this.append(e)},toString:function(){return this.array.join("")},clear:function(){return this.array=[],this.length=0,this}},e.extendCore("strings",{StringBuilder:t,createStringBuilder:function(){return new t}})})
$rload(function(e){"use strict";var t=e.forEach,n=e.forEachEntry,r=e.arrayFromArguments,i=e.isArray,s=e.extend,o=0,u="__lstnrs",a=function(){},f,l=function(e,t){return e?t?function(){e.apply(t,arguments)}:e:a},c=function(e,n){var r=[],i;n.removed=!0,t(e._listeners,function(e){e!==n&&!e.removed&&r.push(e)}),e._listeners=r,(i=n.thisObj)&&delete i[u][n.id],e._listeners.length||e._onEmpty()},h=function(e,t){return function(){c(e,t)}},p=function(t){return function(r){if(!arguments.length)n(t,function(e,t){t.remove()});else{var i=t[r];i||e.errors.throwError(new Error("Invalid message name: "+r)),i.unsubscribe()}}},d=function(e,t){this.name=e,this.data=t};d.prototype={getName:function(){return this.name},getData:function(){return this.data}};var v=function(){this._listeners=[],this._onEmpty=a};v.prototype={add:function(e,t,n){var r={callback:e,thisObj:t,removed:!1,autoRemove:n,id:o++},i,s=this;s._listeners.push(r);var a={remove:h(s,r)};return a.unsubscribe=a.remove,t&&((i=t[u])||(i=t[u]={}),i[r.id]=a),a},publish:function(){var e=arguments,n=this;t(n._listeners,function(t){if(t.removed)return;t.callback.apply(t.thisObj,e),t.autoRemove&&c(n,t)})},onEmpty:function(e,t){this._onEmpty=l(e,t)}};var m=function(t,n){var r=n._allowed;if(r&&!r[t])throw new Error('Invalid message name of "'+t+'". Allowed messages: '+e.keys(r).join(", "))},g=function(e){return function(t){var n=[e].concat(r(arguments));this[typeof t=="function"?"subscribe":"publish"].apply(this,n)}},y=function(){this._byName={}};return y.prototype={__observable:!0,registerMessages:function(e,t){this._allowed||(this._allowed={});for(var n=0,r=e.length;n<r;n++){var i=e[n];this._allowed[i]=!0,t&&(this[i]=g(i))}},subscribe:function(e,t,r,i){var s=this,o,u;if(typeof e=="object")return i=r,r=t,o={},n(e,function(e,t){o[e]=s.subscribe(e,t,r,i)}),u={unsubscribe:p(o)},u.remove=u.removeAll=u.unsubscribe,u;m(e,s);var a=s._byName[e];return a||(s._byName[e]=a=new v,a.onEmpty(function(){delete s._byName[e]})),a.add(t,r,i)},publish:function(e,t){var n;i(t)?n=t:(f.isMessage(e)?(t=e,e=t.getName()):t=f.createMessage(e,t),n=[t.data,t]),m(e,this);var r=this,s=function(e){var t=r._byName[e];if(!t)return;t.publish.apply(t,n)};s(e),s("*");var o=e.lastIndexOf(".");return o>=0&&s(e.substring(0,o+1)+"*"),t}},e.listeners=f={Message:d,createListeners:function(){return new v},createObservable:function(e,t){var n=new y;return e&&n.registerMessages(e,t),n},makeObservable:function(e,t,n,r){t||(t=e),t._observable||(t._observable=!0,s(t,y.prototype)),y.call(e),n&&e.registerMessages(n,r)},isObervable:function(e){return e&&e.__observable},createMessage:function(e,t){return new d(e,t)},isMessage:function(e){return e instanceof d},bind:l,unsubscribeFromAll:function(e){var t=e[u];if(t)for(var n in t)t[n].unsubscribe()}}})
raptor.define("xml.utils",function(e){"use strict";var t=e.extend,n=/(\n|\"|[&<>]|[^\u0020-\}])/g,r={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","\n":"&#"+"\n".charCodeAt(0)+";"},i=t(t({},r),{"\n":"\n"}),s=function(e,t){return e==null?null:typeof e!="string"?e:e.replace(n,function(e){var n=t[e];return n||"&#"+e.charCodeAt(0)+";"})};return{escapeXml:function(e){return s(e,i)},escapeXmlAttr:function(e){return e?s(""+e,r):e}}})
raptor.defineClass("templating.Context",function(e){"use strict";var t=e.forEachEntry,n=e.require("xml.utils").escapeXmlAttr,r=e.require("strings"),i=e.require("listeners"),s=0,o,u=function(e,t){return function(){return e.apply(t,arguments)}},a=function(e){this.writer=e;var n=this;this.attributes={},i.makeObservable(this,a.prototype);var r={};t(o,function(e,t){r[e]=u(t,n)}),this._helpers=r};return a.prototype={uniqueId:function(){return s++},write:function(e){if(e==null)return;this.writer.write(e)},captureString:function(e,t){var n=r.createStringBuilder();return this.swapWriter(n,e,t),n.toString()},swapWriter:function(e,t,n){var r=this.writer;try{this.writer=e,t.call(n)}finally{this.writer=r}},invokeHandler:function(e,t){e.process(t,this)},getFunction:function(t,n){var r=t+":"+n,i=this._helpers[r],s;return i||(arguments.length===1?s=o[t]:s=e.require("templating").getFunction(t,n),i=this._helpers[r]=u(s,this)),i},isTagInput:function(e){return e&&e.hasOwnProperty("_tag")},renderTemplate:function(t,n){e.require("templating").render(t,n,this)}},a.namespacedHelpers=o={w:function(e){return this.write(e),this._helpers.w},h:function(e,t){return this.getFunction(e,t)},t:function(t,n,r,i){n||(n={}),n._tag=!0,n.invokeBody=r,i&&e.extend(n,i),this.invokeHandler(t,n)},a:function(e){if(!e)return;t(e,function(e,t){if(t===undefined)return;this.write(" "+e+(t===null?"":'="'+n(t)+'"'))},this)},i:function(e,t){this.renderTemplate(e,t)}},a})
raptor.define("templating",function(e){"use strict";var t=function(e){return $rget("rhtml",e)},n={},r=e.forEachEntry,i=e.isArray,s=e.require("strings"),o=e.require("xml.utils").escapeXml,u=e.require("xml.utils").escapeXmlAttr,a=e.require("templating.Context"),f,l,c=function(t,n,r){var i=e.require(t),s=i[n]||i.prototype&&i.prototype[n];return s||e.throwError(new Error('Helper function not found with name "'+n+'" in class "'+t+'"')),s},h=function(e){return e?typeof e=="string"?!s.trim(e).length:i(e)?!e.length:!0:!0};return f={render:function(r,i,s){s||e.throwError(new Error("Context is required"));var o=n[r];o||(o=t(r),!o&&this.findTemplate&&(this.findTemplate(r),o=t(r)),o&&(o=o(f.helpers)),o||e.throwError(new Error('Template not found with name "'+r+'"')),n[r]=o);try{o(i||{},s,s._helpers)}catch(u){e.throwError(new Error('Unable to render template with name "'+r+'". Exception: '+u),u)}},renderToString:function(e,t,n){var r=s.createStringBuilder(),i=this,o=function(){i.render(e,t,n)};return n?n.swapWriter(r,o):(n=this.createContext(r),o()),r.toString()},unload:function(e){delete n[e]},getFunction:function(e,t){return arguments.length===1?l[e]:c(e,t)},createContext:function(e){var t=new a(e);return t},registerFunctions:function(e,t,n,i){r(n,function(n,r){var s;i?s=function(){return r.apply(i,arguments)}:s=r,l[e+":"+n]=s,t&&(l[t+":"+n]=s)},this)},helpers:{h:c,t:function(t){var n=e.require(t),r;return(r=n.instance)||(r=n.instance=new n),r},f:function(e,t){if(!e)return;i(e)||(e=[e]);var n=0,r=e.length,s={getLength:function(){return r},isLast:function(){return n===r-1},isFirst:function(){return n===0},getIndex:function(){return n}};for(;n<r;n++){var o=e[n];t(o||"",s)}},e:h,ne:function(e){return!h(e)},x:o,xa:u,nx:function(e){return{toString:function(){return e}}}}},l=f.helpers,f})
$rload(function(e){"use strict";e.resources={}})
$rload(function(e){"use strict";e.defineClass("resources.Resource",function(e){return{init:function(e,t){this.setSearchPathEntry(e),this.setPath(t)},setPath:function(e){this.path=e},getPath:function(){return this.path},isFileResource:function(){return!1},getName:function(){return this._name==null&&(this._name=this.path.substring(this.path.lastIndexOf("/")+1)),this._name},getSystemPath:function(){e.errors.throwError(new Error("getSystemPath() Not Implemented"))},readFully:function(){e.errors.throwError(new Error("Not Implemented"))},toString:function(){return"["+this.getClass().getName()+": path="+this.getPath()+", systemPath="+this.getSystemPath()+"]"},exists:function(){return!0},findChild:function(t){var n=e.resources;return n.findResource(n.joinPaths(this.getPath(),t))},setSearchPathEntry:function(e){this.searchPathEntry=e},getSearchPathEntry:function(){return this.searchPathEntry}}})})
$rload(function(e){"use strict";e.defineClass("resources.MissingResource",{superclass:"resources.Resource"},function(){var e=function(t){e.superclass.constructor.call(this,null,t)};return e.prototype={exists:function(){return!1}},e})})
raptor.define("resources.BrowserResource","resources.Resource",function(){var e=function(t,n,r){e.superclass.constructor.call(this,t,n),this.path=n,this.contents=r};return e.prototype={readFully:function(){return this.contents},getSystemPath:function(){return this.path}},e})
$rload(function(e){"use strict";var t=e.logging.logger("resources"),n=e.require("resources.Resource"),r=e.require("resources.MissingResource"),i=e.require("resources.BrowserResource");e.extend(e.resources,{findResource:function(e){if(e instanceof n)return e;var t=$rget("resource",e);return t?new i(null,e,t):new r(e)}})})
$rload(function(e){"use strict";var t={"*":".*?","?":".?"};e.regexp={escape:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},simple:function(e){var n=this;return new RegExp("^"+e.replace(/[\*\?]|[^\*\?]*/g,function(e){return t[e]||n.escape(e)})+"$")}}})
$rload(function(e){"use strict";e.objects={extend:e.extend,forEachEntry:e.forEachEntry,keys:e.keys,values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},entries:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({key:n,value:e[n]});return t},isEmpty:function(e){if(!e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}}})
raptor.define("json.stringify",function(){"use strict";var e=raptor.require("strings"),t=e.unicodeEncode,n=",",r="null",i=Array,s=/([^ -~]|(["'\\]))/g,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"},u=function(e){return e<10?"0"+e:e},a=function(e){return e.getUTCFullYear()+"-"+u(e.getUTCMonth()+1)+"-"+u(e.getUTCDate())+"T"+u(e.getUTCHours())+":"+u(e.getUTCMinutes())+":"+u(e.getUTCSeconds())+"Z"};return{stringify:function(u,f){f||(f={});var l=f.special||s,c=e.createStringBuilder(),h=function(e){c.append(e)},p=f.useSingleQuote===!0,d=p===!0?"'":'"',v=function(e){return d+e.replace(l,function(e){if(e==='"')return p?'"':'\\"';if(e==="'")return p?"\\'":"'";var n=o[e];return n||t(e)})+d},m=function(e){if(e==null){h(r);return}var t=e.constructor,s,o;if(e===!0||e===!1||t===Boolean)h(e.toString());else if(t===i){h("["),o=e.length;for(s=0;s<o;s++)s!==0&&h(n),m(e[s]);h("]")}else if(t===Date)h(a(e));else{var u=typeof e;switch(u){case"string":h(v(e));break;case"number":h(isFinite(e)?e+"":r);break;case"object":h("{");var f=!0,l;for(var c in e)if(e.hasOwnProperty(c)){l=e[c];if(l==null)continue;f===!1?h(n):f=!1,h(v(c)),h(":"),m(l)}h("}");break;default:h(r)}}};return m(u),c.toString()}}})
raptor.define("xml.dom",function(){"use strict";return{createParser:function(e){var t=raptor.require("xml.dom.DomParser");return new t(e)}}})
raptor.defineClass("xml.dom.DomParser",function(e){var t=function(e){};return t.prototype={parse:function(e){try{var t=$.parseXML(e);return t}catch(n){throw new Error("Invalid XML")}}},t})
raptor.define("xml.sax",function(){"use strict";return{createParser:function(e){e=e||{};if(e.dom)return this.createParserForDom(e);var t=raptor.find("xml.sax.SaxParser")||raptor.find("xml.sax.SaxParserDom");return new t(e)},createParserForDom:function(e){var t=raptor.require("xml.sax.SaxParserDom");return new t(e)}}})
raptor.defineClass("xml.sax.BaseSaxParser",function(){"use strict";var e=raptor.require("listeners"),t=raptor.arrayFromArguments,n=function(){this.observable=e.createObservable(["startElement","endElement","characters","comment","error"])};return n.prototype={on:function(e,t){this.observable.subscribe.apply(this.observable,arguments)},_startElement:function(e){this.observable.publish("startElement",e)},_endElement:function(e){this.observable.publish("endElement",e)},_characters:function(e){e=e.replace(/\r\n|\r/g,"\n"),this.observable.publish("characters",e)},_comment:function(e){this.observable.publish("comment",e)},_error:function(){var e=t(arguments);this.observable.publish("error",e)},getPos:function(){return"(unknown)"}},n})
raptor.define("xml.dom-to-sax",function(){"use strict";var e=function(e){this.node=e};e.prototype={getNamespaceURI:function(){return this.node.namespaceURI||""},getLocalName:function(){return this.node.localName},getQName:function(){return this.node.prefix?this.node.prefix+":"+this.node.localName:this.node.localName},getValue:function(){return this.node.nodeValue},getPrefix:function(){return this.node.prefix},toString:function(){return"[Attribute: uri="+this.getNamespaceURI()+", qName="+this.getQName()+", value="+this.getValue()+"]"}};var t=function(e){this.node=e};return t.prototype={getNamespaceURI:function(){return this.node.namespaceURI||""},getLocalName:function(){return this.node.localName},getQName:function(){return this.node.prefix?this.node.prefix+":"+this.node.localName:this.node.localName},getPrefix:function(){return this.node.prefix||""},getAttributes:function(){var t=this.attributes;if(!t){t=this.attributes=[];var n=this.node.attributes;for(var r=0,i=n.length;r<i;r++)t.push(new e(n.item(r)))}return t},getNamespaceMappings:function(){var e=this._namespaceMappings;return e||(e=this._namespaceMappings={},raptor.forEach(this.getAttributes(),function(t){t.getPrefix()==="xmlns"&&(e[t.getLocalName()]=t.getValue())},this)),e},toString:function(){var e=[];return raptor.forEach(this.getAttributes(),function(t){e.push(t.toString())},this),e=e.join(", "),"[Element: uri="+this.getNamespaceURI()+", localName="+this.getLocalName()+", qName="+this.getQName()+", prefix="+this.getPrefix()+", attributes=["+e+"], ns="+JSON.stringify(this.getNamespaceMappings())+"]"}},{domToSax:function(e,n,r){var i=raptor.require("listeners").createObservable(["startElement","endElement","comment","characters"],!0);i.subscribe(n,r);var s=function(e){i.characters(e.nodeValue)},o=function(e){i.comment(e.nodeValue)},u=function(e){var n=new t(e);i.startElement(n);var r=e.childNodes,s=r.length;for(var o=0;o<s;o++){var u=r[o];a(u)}i.endElement(n)},a=function(e){switch(e.nodeType){case 1:u(e);break;case 2:break;case 3:s(e);break;case 4:s(e);break;case 5:s(e);break;case 6:s(e);break;case 7:break;case 8:o(e);break;case 9:u(e.documentElement)}};a(e)}}})
raptor.defineClass("xml.sax.SaxParserDom","xml.sax.BaseSaxParser",function(e){var t=function(e){t.superclass.constructor.call(this)};return t.prototype={parse:function(t,n){var r;if(t.documentElement)r=t;else{var i=e.require("xml.dom").createParser();r=i.parse(t,n)}e.require("xml.dom-to-sax").domToSax(r.documentElement,{startElement:this._startElement,endElement:this._endElement,comment:this._comment,characters:this._characters},this)}},t})
$rload(function(e){"use strict";e.arrays={forEach:e.forEach,isArray:e.isArray,fromArguments:e.arrayFromArguments,concatArrays:function(e){var t=[],n=0,r=arguments.length,i;for(;n<r;n++)i=arguments[n],i!=null&&(t=t.concat.apply(t,i));return t},pop:function(e){var t=this.peek(e);return e.splice(e.length-1,1),t},peek:function(e){return e&&e.length?e[e.length-1]:undefined}}})
raptor.define("xml.sax.object-mapper",function(e){"use strict";var t=e.forEach,n=e.require("xml.sax"),r=e.forEachEntry,i=e.require("arrays"),s=e.require("strings"),o="string",u="boolean",a="object",f=function(e,t,n){var r=function(e){var r;return t==="attribute"?r=n["@"+e]:t==="element"&&(r=n["<"+e+">"]),r||(r=n[e]),r},i=e.getNamespaceURI(),s;return i?(s=r(i+":"+e.getLocalName()),type||(s=r(i+":*"))):s=r(e.getLocalName()),s||(s=r("*")),typeof s=="function"&&(s=s(e,t)),s},l=function(e,t){var n=[];return r(e,function(e,r){if(s.startsWith(e,"_"))return;if(t&&r._type===a)return;n.push(t?e:e.charAt(0)==="<"?e:"<"+e+">")},this),"["+n.join(", ")+"]"},c=function(e,t){t||(t={}),this.skipping=!1,this.options=t,this.trimText=t.trimText!==!1,this.contextStack=[],this.schema=e};return c.prototype={_parseProp:function(e,t){var n=this.options.parseProp;return n&&(e=n(e,t)),e},_setProperty:function(e,t,n,r,i){typeof r=="string"&&(this.trimText&&(r=s.trim(r)),r=this._parseProp(r,i),t._type===u&&(r=r.toLowerCase(),r=r==="true"||r==="yes"));var o=t._targetProp||(typeof e=="string"?e:e.getNamespaceURI()?e.getNamespaceURI()+":"+e.getLocalName():e.getLocalName());t._set?t._set(n,o,r,i):n[o]=r},skipCurrentElement:function(){if(this.skipping)return;var e=this.getCurrentContext();e.skip=!0,this.skipping=!0},error:function(t){e.throwError(new Error(t+" ("+this.saxParser.getPos()+")"))},getCurrentContext:function(){return i.peek(this.contextStack)},read:function(r,c){this.saxParser=n.createParser({trim:!0,normalize:!0}),this.contextStack=[],this.skipping=!1;var h=this,p,d=this.saxParser;return d.on({error:function(e){h.error(e)},startElement:function(n){var r=h.getCurrentContext(),i=r?r.schema:h.schema,s,c={el:n,tagName:n.getLocalName(),uri:n.getNamespaceURI(),parentContext:r};h.contextStack.push(c);if(h.skipping)return;c.schema=s=f(n,"element",i),s||(console.error("EL: ",n),console.error("parentSchema: ",i),h.error("Unexpected element: <"+n.getQName()+">. Expected one of: "+l(i)));if(s._type===o||s._type===u)s._begin&&s._begin(r?r.object:null,c);else if(s._type===a){c.object=s._begin?s._begin(r?r.object:null,c)||{}:{};if(!c.object)throw new Error('_begin() for "'+n.getLocalName()+'" did not return an object.')}h.skipping||t(n.getAttributes(),function(t){if(h.skipping)return!1;var n=f(t,"attribute",s);n||h.error("Unexpected attribute: "+t.getQName()+". Expected one of: "+l(s,!0));var r=e.extend({},c);return r.attr=t,h._setProperty(t,n,c.object,t.getValue(),r),!0})},characters:function(e){if(h.skipping===!0)return;var t=h.getCurrentContext();t.text=t.text?t.text+e:e},endElement:function(){var e=h.getCurrentContext(),t=e.parentContext,n=e.schema;if(h.skipping!==!0)if(n._type===o||n._type===u)h._setProperty(e.el,n,t?t.object:null,e.text,e),n._end&&n._end(e.object,t?t.object:null,e);else if(n._type===a)e.text!=null&&s.trim(e.text)&&(n._text?h._setProperty("text",n._text,e.object,e.text,e):n._setText?n._setText(e.object,h._parseProp(e.text,e)):h.error("Unexpected text: "+e.text)),n._end&&n._end(e.object,t?t.object:null,e),n._targetProp&&h._setProperty(e.el,n,t?t.object:null,e.object);else if(n._type)throw new Error("Invalid type: "+n._type);h.contextStack.length===1&&(p=e.object),i.pop(h.contextStack),e.skip===!0&&(h.skipping=!1)}}),d.parse(r,c),p}},{createReader:function(e,t){return new c(e,t)},read:function(e,t,n,r){return this.createReader(n,r).read(e,t)}}})
raptor.defineClass("templating.compiler.Expression",function(){"use strict";var e=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|\s+(?:and|or|lt|gt|eq|ne|lt|gt|ge|le)\s+/g,t=raptor.require("strings"),n={and:" && ",or:" || ",eq:" === ",ne:" !== ",lt:" < ",gt:" > ",ge:" >= ",le:" <= "},r=function(r){return r.replace(e,function(e){return n[t.trim(e)]||e})},i=function(e,t){t!==!1&&typeof e=="string"&&(e=r(e)),this.expression=e};return i.prototype={getExpression:function(){return this.expression},toString:function(){return this.expression}},i})
raptor.defineClass("templating.compiler.ExpressionParser",function(e){"use strict";var t=e.require("templating.compiler.Expression"),n=e.require("strings"),r=e.require("regexp"),i={"${":"}","{%":"%}",$:null},s=function(t){var n=[];return e.forEach(t,function(e){n.push(r.escape("\\\\"+e)),n.push(r.escape("\\"+e)),n.push(r.escape(e))}),n.join("|")},o=s(["{%","${","$"]),u=function(){return new RegExp(o,"g")},a=/^([_a-zA-Z]\w*)/g,f=function(e,t){var n=e.split("\n"),r=0,i;while(r<n.length){i=n[r];if(t-i.length+1<0)break;t-=i.length+1,r++}return{str:i,pos:t}},l=function(e,t,n){var r=f(e,t);t=r.pos,e=r.str;var i=t-n,s=t+n,o;i<0&&(i=0),s>e.length&&(s=e.length);var u="...",a="...",l="\n"+u+e.substring(i,s)+a+"\n";for(o=0;o<u.length;o++)l+=" ";for(o=i;o<s;o++)l+=o===t?"^":" ";for(o=0;o<a.length;o++)l+=" ";return l},c=e.defineClass(function(){return{init:function(e,t){this.callback=e,this.callbackThisObj=t,this.text=""},_invokeCallback:function(t,n){this.callback[t]||e.throwError(new Error(t+" not allowed: "+n)),this.callback[t].call(this.callbackThisObj,n)},_endText:function(){this.text&&(this._invokeCallback("text",this.text),this.text="")},addText:function(e){this.text+=e},addExpression:function(e){this._endText(),e instanceof t||(e=new t(e)),this._invokeCallback("expression",e)},addScriptlet:function(e){this._endText(),this._invokeCallback("scriptlet",e)}}}),h=function(){};return h.getConditionalExpression=function(){},h.parse=function(t,r,s){var o=0,f,p,d,v,m,g,y,b,w=function(t){if(r.error){r.error.call(s,t);return}e.throwError(new Error(t))},E=u(),S=new c(r,s);E.lastIndex=0;e:while(p=E.exec(t)){if(n.startsWith(p[0],"\\\\"))f=p.index+1,b=p[0].substring(2),v=p.index+p[0].length;else{if(n.startsWith(p[0],"\\")){S.addText(t.substring(o,p.index)),S.addText(p[0].substring(1)),o=E.lastIndex;continue}i.hasOwnProperty(p[0])?(b=p[0],f=p.index):e.throwError(new Error("Illegal state. Unexpected start token: "+p[0]))}v=E.lastIndex,o!==f&&S.addText(t.substring(o,f));var x=i[b];if(!x){a.lastIndex=0;var T=a.exec(t.substring(v));if(!T){S.addText(p[0]),E.lastIndex=o=v;continue e}var N=T[1];S.addExpression(N),E.lastIndex=o=v+=N.length;continue e}g=b==="{%",y=b==="{?";var C=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|\%\}|[\{\}]/g;C.lastIndex=v;var k=0;while(d=C.exec(t)){if(d[0]==="{"){k++;continue}if(d[0]==="}"){if(g)continue;if(k!==0){k--;continue}}else{if(d[0]!=="%}")continue;g||w('Ending "'+d[0]+'" token was found but matched with starting "'+b+'" token. Location: '+l(t,d.index,10))}m=t.substring(v,d.index);var L;if(b==="${"){var A=m.indexOf(":");A!=-1&&(L=h.custom[m.substring(0,A)],L&&L.call(h,m.substring(A+1),S))}L||(g?S.addScriptlet(n.trim(m)):y?S.addExpression(this.getConditionalExpression(m)):S.addExpression(m)),E.lastIndex=C.lastIndex,o=C.lastIndex;continue e}w('Ending "'+i[b]+'" token not found for "'+b+'" token. Location: '+l(t,p.index,10)+"\n")}o!==t.length&&S.addText(t.substring(o,t.length)),S._endText()},h.custom={xml:function(e,n){e=new t(e),e.escapeXml=!1,n.addExpression(e)},entity:function(e,t){t.addText("&"+e+";")},startTag:function(e,t){t.addText("<"+e+">")},endTag:function(e,t){t.addText("</"+e+">")},newline:function(e,t){t.addText("\n")}},h})
raptor.defineClass("templating.compiler.TypeConverter",function(e){"use strict";var t=e.require("templating.compiler.ExpressionParser"),n=e.require("json.stringify").stringify,r=e.require("templating.compiler.Expression"),i=function(){};return i.convert=function(i,s,o){var u=!1,a=[];if(i==null)return i;if(s==="custom"||s==="identifier")return i;if(s==="expression")return new r(i);if(o){t.parse(i,{text:function(e){a.push(n(e))},expression:function(e){a.push(e),u=!0}});if(u)return new r(a.join("+"))}if(s==="string")return o?new r(i?n(i):"null"):i;if(s==="boolean")return i=i.toLowerCase(),i=i==="true"||i==="yes",o?new r(i):i;if(s==="float"||s==="double"||s==="number"||s==="integer")return s==="integer"?i=parseInt(i,10):i=parseFloat(i),o?new r(i):i;e.throwError(new Error("Unsupported attribute targetType: "+s))},i})
raptor.defineClass("templating.compiler.AttributeSplitter",function(e){"use strict";var t=e.require("listeners"),n=e.require("strings"),r=["text","expression"],i=e.require("templating.compiler.Expression"),s=e.require("templating.compiler.TypeConverter"),o=/"(?:[^"]|\\")*"|'(?:[^']|\\')*'|==|===|[;=]/g,u=function(){};return u.parse=function(t,r,i){i||(i={});var u=0,a=i.ordered===!0,f=i.defaultName,l,c=-1,h=a?[]:{},p=function(t){if(i.errorHandler){i.errorHandler(t);return}e.throwError(new Error(t))},d=function(e){if(u===e)return;var i,o;if(c!=-1)i=n.trim(t.substring(u,c)),o=t.substring(c+1,e);else if(f){i=f,o=t.substring(u,e);if(!n.trim(o).length)return}else i=t.substring(u,e);i&&(i=n.trim(i));if(!n.trim(i).length&&!n.trim(o).length){c=-1;return}if(r){var l=r[i]||r["*"];l?(o!=null&&(o=s.convert(o,l.type,l.allowExpressions!==!1)),l.name&&(i=l.name)):p('Invalid sub-attribute name of "'+i+'"')}a?h.push({name:i,value:o}):h[i]=o,c=-1};while(l=o.exec(t))l[0]==";"?(d(l.index),u=l.index+1,c=-1):l[0]=="="&&c==-1&&(c=l.index);return d(t.length),h},u})
raptor.defineClass("templating.compiler.TemplateBuilder",function(e){"use strict";var t=e.require("json.stringify").stringify,n=e.require("strings"),r=e.require("templating.compiler.Expression"),i=e.forEach,s=function(e,t){this.filePath=t,this.compiler=e,this.options=e.options,this.templateName=null,this.curText=null,this.attributes={},this.staticVars=[],this.staticVarsLookup={},this.helperFunctionsAdded={},this.vars=[],this.varsLookup={},this.javaScriptCode=n.createStringBuilder(),this.getStaticHelperFunction("empty","e"),this.getStaticHelperFunction("notEmpty","ne"),this.getContextHelperFunction("write","w"),this.preserveWhitespace=0};return s.prototype={getTemplateName:function(){var e=this.options||{};return e.templateName||this.templateName||e.defaultTemplateName},beginPreserveWhitespace:function(){this.preserveWhitespace++},endPreserveWhitespace:function(){this.preserveWhitespace--},isPreserveWhitespace:function(){var e=this.options.preserveWhitespace;return this.preserveWhitespace>0||e===!0||e&&e["*"]},_getHelperFunction:function(e,t,n){var r=t+":"+(n?"static":"context"),i=this.helperFunctionsAdded[r];return i?i:(n?this.addStaticVar(e,"helpers."+t):this.addVar(e,"contextHelpers."+t),this.helperFunctionsAdded[r]=e,e)},getContextHelperFunction:function(e,t){return this._getHelperFunction(e,t,!1)},getStaticHelperFunction:function(e,t){return this._getHelperFunction(e,t,!0)},hasStaticVar:function(e){return this.staticVarsLookup[e]===!0},addStaticVar:function(e,t){this.staticVarsLookup[e]=!0,this.staticVars.push({name:e,expression:t})},hasVar:function(e){return this.vars[e]===!0},addVar:function(e,t){this.vars[e]=!0,this.vars.push({name:e,expression:t})},_writeVars:function(e,t){if(!e.length)return;t.append("var ");var n=[];i(e,function(e){n.push(e.name+"="+e.expression)}),t.append(n.join(",")+";")},_endText:function(){if(this.hasErrors())return;var e=this.curText;e&&(this.curText=null,this.addWrite(t(e,{useSingleQuote:!0})))},addText:function(e){if(this.hasErrors())return;this.curText===null?this.curText=e:this.curText+=e},_endWrites:function(){var e=this.curWrites;e&&(this.curWrites=null,this.curWrites=null,i(e,function(e,t){t===0?this.javaScriptCode.append("write("):this.javaScriptCode.append("("),this.javaScriptCode.append(e),this.javaScriptCode.append(")")},this),this.javaScriptCode.append(";"))},addWrite:function(e,t){if(this.hasErrors())return;this._endText(),this.curWrites||(this.curWrites=[]),t&&(t.escapeXml&&(e=this.getStaticHelperFunction("escapeXml","x")+"("+e+")"),t.escapeXmlAttr&&(e=this.getStaticHelperFunction("escapeXmlAttr","xa")+"("+e+")")),this.curWrites.push(e)},addJavaScriptCode:function(e){if(this.hasErrors())return;this._endText(),this._endWrites(),this.javaScriptCode.append(e)},getOutput:function(){if(this.hasErrors())return"";var e=n.createStringBuilder(),r=this.getTemplateName();r||this.addError('Template name not defined in template at path "'+this.filePath+'"');var i=this.params;return i?i=["context"].concat(i):i=["context"],e.append('$rset("rhtml",'),e.append(t(r)),e.append(","),e.append("function(helpers){"),this._writeVars(this.staticVars,e),e.append("return function(data, context, contextHelpers){\n"),this._writeVars(this.vars,e),this._endText(),this._endWrites(),e.append(this.javaScriptCode.toString()),e.append("}});"),e.toString()},setTemplateName:function(e){this.templateName=e},makeExpression:function(t){if(t instanceof r)return t;if(typeof t=="string")return new r(t);e.throwError(new Error("Unsupported expression object: "+t))},isExpression:function(e){return e instanceof r},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,t},hasErrors:function(){return this.compiler.hasErrors()},addError:function(e,t){this.compiler.addError(e,t)},getErrors:function(){return this.compiler.getErrors()}},s})
raptor.defineClass("templating.compiler.TemplateCompiler",function(raptor){"use strict";var TemplateBuilder=raptor.require("templating.compiler.TemplateBuilder"),ParseTreeBuilder=raptor.require("templating.compiler.ParseTreeBuilder"),Expression=raptor.require("templating.compiler.Expression"),errors=raptor.require("errors"),minifier=raptor.find("js-minifier"),TypeConverter=raptor.require("templating.compiler.TypeConverter"),TemplateCompiler=function(e,t){this.taglibs=e,this.options=t||{},this.errors=[]};return TemplateCompiler.prototype={transformTree:function(e,t){try{this.taglibs.forEachNodeTransformer(e,function(n){e.isTransformerApplied(n)||(e.setTransformerApplied(n),this._transformerApplied=!0,e.compiler=this,n.getInstance().process(e,this,t))},this)}catch(n){errors.throwError(new Error('Unable to compile template at path "'+t.filePath+". Error: "+n.message),n)}for(var r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];i.parentNode||raptor.throwError(new Error("Invalid node found in tree. parentNode property of child node is not set. Node: "+e)),this.transformTree(i,t)}},compile:function(e,t,n,r){var i=this,s,o,u=function(){var e="Errors in template:\n",t=i.getErrors();for(var n=0,r=t.length;n<r;n++)e+=n+1+") "+(t[n].pos?"["+t[n].pos+"] ":"")+t[n].message+"\n";var s=new Error(e);throw s.errors=i.getErrors(),s};try{s=ParseTreeBuilder.parse(e,t,this.taglibs),o=new TemplateBuilder(this,t);do this._transformerApplied=!1,this.transformTree(s,o);while(this._transformerApplied)}catch(a){errors.throwError(new Error('An error occurred while trying to compile template at path "'+t+'". Exception: '+a),a)}try{s.generateCode(o)}catch(a){errors.throwError(new Error('An error occurred while trying to compile template at path "'+t+'". Exception: '+a),a)}this.hasErrors()&&u();var f=o.getOutput();minifier&&this.options.minify===!0&&(f=minifier.minify(f)),n&&n.call(r,{source:f,templateName:o.getTemplateName()});var l=this.options;return l&&l.nameCallback&&l.nameCallback(o.getTemplateName()),f},compileAndLoad:function(xmlSrc,filePath){var compiledSrc=this.compile(xmlSrc,filePath,function(e){raptor.require("templating").unload(e.templateName)});try{eval(compiledSrc)}catch(e){this.logger().error("Unable to load compiled template: "+compiledSrc,e),errors.throwError(new Error('Unable to load template at path "'+filePath+'". Exception: '+e.message),e)}},isExpression:function(e){return e instanceof Expression},createTagHandlerNode:function(e,t){var n=raptor.require("templating.taglibs.core.TagHandlerNode"),r=this.taglibs.getTagDef(e,t),i=new n(r);return i},convertType:function(e,t,n){return TypeConverter.convert(e,t,n)},addError:function(e,t){this.errors.push({message:e,pos:t})},hasErrors:function(){return this.errors.length!==0},getErrors:function(){return this.errors}},TemplateCompiler})
raptor.defineClass("templating.compiler.Taglib",function(e){"use strict";var t=function(){};return t.prototype={},t.Tag=e.defineClass(function(){var t=function(){};return t.prototype={getAttributeDef:function(e,t){return e==null&&(e=""),this.attributeMap?this.attributeMap[e+":"+t]||this.attributeMap[e+":*"]||this.attributeMap["*:"+t]||this.attributeMap["*:*"]:null},toString:function(){return"[Tag: <"+this.uri+":"+this.name+">]"},forEachAttribute:function(t,n){e.forEachEntry(this.attributeMap,function(e,r){t.call(n,r)})}},t}),t.Transformer=e.defineClass(function(){var t=0,n=function(){this.id=t++,this.tag=null,this.className=null,this.instance=null};return n.prototype={getInstance:function(){this.className||e.throwError(new Error("Transformer class not defined for tag transformer (tag="+this.tag+")"));if(!this.instance){var t=e.require(this.className);this.instance=new t,this.instance.id=this.id}return this.instance},toString:function(){return"[Taglib.Transformer: "+this.className+"]"}},n}),t})
raptor.defineClass("templating.compiler.TaglibCollection",function(e){"use strict";var t=e.forEach,n=e.extend,r=e.strings,i=e.require("templating.compiler.Taglib"),s=e.require("templating.compiler.ElementNode"),o=e.require("templating.compiler.TextNode"),u=i.Tag,a=i.Transformer,f=/^(?:(\*|(?:(?:@?[A-Za-z0-9_\-]+\s*,\s*)*@?[A-Za-z0-9_\-]+))\s+from\s+)?([^ ]*)(?:\s+as\s+([A-Za-z0-9_\-]+))?$/,l=function(e,t,n){if(e[t]!=null)return e[t];var r=t.indexOf("-"),i,s,o;if(r!=-1){i=t.substring(0,r),o=t.substring(r+1),s=n._prefixes[i];if(s)return{uri:s,name:o,prefix:i}}return null},c=function(n,i){this._tagImports={},this._attrImports={},this._prefixes={};var s=r.trim(i).split(/\s*;\s*/);t(s,function(r){if(!r)return;var i=r.match(f),s,o={},u,a;i?(s=i[1],u=n.resolveURI(i[2]),a=i[3],a||(a=n.resolvePrefix(u)||n.resolveShortName(u),a||e.throwError(new Error('Unable to handle imports from "'+u+'". The taglib does not have a prefix or short name defined.')))):e.throwError(new Error('Invalid import: "'+r+'"')),this._prefixes[a]=u,s&&t(s.split(/\s*,\s*/),function(e){o[e]=!0}),n.forEachTag(u,function(e,t){e.uri===u&&(o["*"]||o[e.name])&&(this._tagImports[e.name]={uri:u,name:e.name,prefix:a}),e.forEachAttribute(function(t){e.uri!==u&&(o["*"]||o["@"+t.name])&&(this._attrImports[t.name]={uri:u,name:t.name,prefix:a})},this)},this)},this)};c.prototype={getImportedTag:function(e){return l(this._tagImports,e,this)},getImportedAttribute:function(e){return l(this._attrImports,e,this)}};var h=function(){this.tagTransformersLookup={},this.tagDefs={},this.textTransformers={},this.taglibsByURI={},this.shortNameToUriMapping={},this.uriToShortNameMapping={},this.uriToPrefixMapping={},this.functionsLookup={}};return h.prototype={forEachTag:function(t,n,r){t=this.resolveURI(t);var i=this.taglibsByURI[t];if(!i)return;e.forEachEntry(i.tags,function(e,t){n.call(r,t,i)})},isTaglib:function(e){return this.taglibsByURI[e]!=null},add:function(e){e=n(new i,e);var r=this.taglibsByURI[e.uri]||e;this.taglibsByURI[e.uri]=r,e.shortName&&(this.taglibsByURI[e.shortName]=e,e.shortName&&(r.shortName=e.shortName,this.shortNameToUriMapping[e.shortName]=e.uri,this.uriToShortNameMapping[e.uri]=e.shortName),e.prefix&&(r.prefix=e.prefix,this.uriToPrefixMapping[e.uri]=e.prefix));var s=e.tags;delete e.tags,e.tags={},t(s,function(i,s){var o=i.uri==null?e.uri:i.uri,f=i.name,l=o+":"+f;i=n(new u,i),i.taglib=r,i.uri=o,r.tags[l]=i,this.tagDefs[l]=i;if(i.transformers){var c;(c=this.tagTransformersLookup[l])||(this.tagTransformersLookup[l]=c={transformers:[],before:{},after:{},_addRelativeTransformer:function(e,t,n){var r=this[e][n];r||(r=this[e][n]=[]),r.push(t)}}),t(i.transformers,function(e){e=n(new a,e),e.after?c._addRelativeTransformer("after",e,e.after):e.before?c._addRelativeTransformer("before",e,e.before):c.transformers.push(e)},this)}},this),t(e.textTransformers,function(e){this.textTransformers[e.className]=n(new a,e)},this),t(e.functions,function(t){if(!t.name)return;this.functionsLookup[e.uri+":"+t.name]=t,r.shortName&&(this.functionsLookup[e.shortName+":"+t.name]=t)},this)},forEachNodeTransformer:function(e,t,n){e instanceof s?this.forEachTagTransformer(e.uri,e.localName,t,n):e instanceof o&&this.forEachTextTransformer(t,n)},resolveURI:function(e){return e?this.shortNameToUriMapping[e]||e:e},resolveShortName:function(e){return e?this.shortNameToUriMapping[e]?e:this.uriToShortNameMapping[e]:e},resolvePrefix:function(e){return e?(e=this.resolveURI(e),this.uriToPrefixMapping[e]):e},forEachTagTransformer:function(e,t,n,r){e==null&&(e="");var i=function(e,t){if(!e)return;t||(t=e.transformers);if(!t)return;for(var s=0,o=t.length;s<o;s++){var u=t[s];e.before[u.className]&&i(e,e.before[u.className]);if(n.call(r,u)===!1)return;e.after[u.className]&&i(e,e.after[u.className])}};i(this.tagTransformersLookup[e+":"+t]),i(this.tagTransformersLookup[e+":*"]),i(this.tagTransformersLookup["*:*"])},forEachTextTransformer:function(t,n){e.forEachEntry(this.textTransformers,function(e,r){var i=t.call(n,r);return i===!1?!1:!0})},getTagDef:function(e,t){var n=this.tagDefs[e+":"+t];return n||(n=this.tagDefs[e+":*"]),n},getFunction:function(e,t){return this.functionsLookup[e+":"+t]},getImports:function(e){return new c(this,e)}},h})
raptor.define("templating.compiler",function(e){"use strict";var t=e.require("templating.compiler.TaglibCollection"),n=new t,r=e.extend,i=e.require("templating.compiler.ExpressionParser"),s={minify:!1,preserveWhitespace:{pre:!0,textarea:!0},allowSelfClosing:{script:!1,div:!1,textarea:!1,li:!1,b:!1},startTagOnly:{img:!0,br:!0,input:!0}};return{createCompiler:function(t){this.discoverTaglibs&&this.discoverTaglibs();var i=e.require("templating.compiler.TemplateCompiler");return t?t=r(r({},s),t):t=s,new i(n,t)},compile:function(e,t,n){return this.createCompiler(n).compile(e,t)},compileAndLoad:function(e,t,n){this.createCompiler(n).compileAndLoad(e,t)},loadTaglibXml:function(t,n){var r=e.require("templating.compiler.TaglibXmlLoader"),i=r.load(t,n);return this.addTaglib(i),i},addTaglib:function(e){n.add(e)},hasTaglib:function(e){return n.isTaglib(e)},registerCustomExpressionHandler:function(e,t){i.custom[e]=t},defaultOptions:s,taglibs:n}}),raptor.global.$rtld=function(e){"use strict";raptor.require("templating.compiler").addTaglib(e)}
raptor.defineClass("templating.compiler.Node",function(e){"use strict";var t=e.forEachEntry,n=e.forEach,r=e.isArray,i=e.require("objects").isEmpty,s=Array.prototype.splice,o=e.errors,u=function(e,t){n(e,function(e){if(e.parentNode){var n=e.parentNode.removeChild(e);n||o.throwError(new Error("Unexpected state. Child not found in parent. (node="+e+", parentNode="+t+")"))}e.parentNode=t},this)},a=function(e){this.nodeType||(this._isRoot=!1,this.nodeType=e,this.parentNode=null,this.childNodes=[],this.namespaceMappings={},this.prefixMappings={},this.transformersApplied={},this.properties={})};return a.prototype={getPosition:function(){var e=this.pos||this.getProperty("pos")||{toString:function(){return"(unknown position)"}};return e},addError:function(t){this.compiler||e.throwError(new Error("Template compiler not set for node "+this));var n=this.getPosition();this.compiler.addError(t+" ("+this.toString()+")",n)},setProperty:function(e,t){this.setPropertyNS(null,e,t)},setPropertyNS:function(e,t,n){e||(e="");var r=this.properties[e];r||(r=this.properties[e]={}),r[t]=n},setProperties:function(e){this.setPropertiesNS(null,e)},setPropertiesNS:function(e,n){e||(e=""),t(n,function(t,n){this.setPropertyNS(e,t,n)},this)},getPropertyNamespaces:function(){return e.keys(this.properties)},getProperties:function(e){return this.getPropertiesNS(null)},getPropertiesNS:function(e){return e||(e=""),this.properties[e]},forEachProperty:function(e,n){t(this.properties,function(r,i){t(i,function(t,i){e.call(n,r,t,i)},this)},this)},getProperty:function(e){return this.getPropertyNS(null,e)},getPropertyNS:function(e,t){e||(e="");var n=this.properties[e];return n?n[t]:undefined},removeProperty:function(e){this.removePropertyNS("",e)},removePropertyNS:function(e,t){e||(e="");var n=this.properties[e];n&&delete n[t],i(n)&&delete this.properties[e]},forEachPropertyNS:function(e,n,r){e==null&&(e="");var i=this.properties[e];i&&t(i,function(e,t){n.call(r,e,t)},this)},forEachChild:function(e,t){n(this.childNodes,e,t)},isTransformerApplied:function(e){return this.transformersApplied[e.id]===!0},setTransformerApplied:function(e){this.transformersApplied[e.id]=!0},hasChildren:function(){return this.childNodes.length>0},appendChild:function(e){this.appendChildren([e])},appendChildren:function(e){if(!e)return;r(e)||(e=[e]),this.childNodes=this.childNodes.concat(e),u(e,this)},isRoot:function(){return this._isRoot===!0},removeChild:function(e){for(var t=0,n=this.childNodes.length,r;t<n;t++)if((r=this.childNodes[t])===e)return e.parentNode=null,this.childNodes.splice(t,1),r;return null},removeChildren:function(){u(this.childNodes,null);var e=this.childNodes;return this.childNodes=[],e},replaceChild:function(e,t){if(e===t)return!1;for(var n=0,r=this.childNodes.length;n<r;n++)if(this.childNodes[n]==t)return u(e,this),this.childNodes[n]=e,t.parentNode=null,!0;return!1},insertAfter:function(e,t){if(!e)return;r(e)||(e=[e]);var n=this.childNodes;if(t)for(var i=0,o=n.length;i<o;i++)if(n[i]===t){if(i===o-1)break;u(e,this);var a=[i+1,0].concat(e);s.apply(n,a);return}this.appendChildren(e)},isTextNode:function(){return!1},isElementNode:function(){return!1},setStripExpression:function(e){this.stripExpression=e},generateCode:function(t){this.compiler=t.compiler;var n=this.preserveSpace||this.isPreserveSpace&&this.isPreserveSpace();n&&t.beginPreserveWhitespace();try{if(!this.stripExpression||this.stripExpression.toString()==="false")this.doGenerateCode(t);else if(this.stripExpression.toString()==="true")this.generateCodeForChildren(t);else{(!this.generateBeforeCode||!this.generateAfterCode)&&this.addError("The c:strip directive is not supported for node "+this);var r=t.getAttribute("nextStripVarId");r==null&&(r=t.setAttribute("nextStripVarId",0));var i="__strip"+r++;t.addJavaScriptCode("var "+i+"=!("+this.stripExpression+");"),t.addJavaScriptCode("if ("+i+"){"),this.generateBeforeCode(t),t.addJavaScriptCode("}"),this.generateCodeForChildren(t),t.addJavaScriptCode("if ("+i+"){"),this.generateAfterCode(t),t.addJavaScriptCode("}")}}catch(s){e.throwError(new Error("Unable to generate code for node "+this+" at position ["+this.getPosition()+"]. Exception: "+s),s)}n&&t.endPreserveWhitespace()},doGenerateCode:function(e){this.generateCodeForChildren(e)},generateCodeForChildren:function(e){e||o.throwError(new Error('The "template" argument is required')),n(this.childNodes,function(t){t.generateCode(e)},this)},addNamespaceMappings:function(e){if(!e)return;var n=this.namespaceMappings,r=this.prefixMappings;t(e,function(e,t){n[e]=t,r[t]=e})},resolveNamespacePrefix:function(e){var t=this.prefixMappings[e];return!t&&this.parentNode?this.parentNode.resolveNamespacePrefix():t},getNodeClass:function(){return this.nodeClass||this.getClass()},setNodeClass:function(e){this.nodeClass=e}},a})
raptor.defineClass("templating.compiler.ElementNode","templating.compiler.Node",function(){"use strict";var e=raptor.forEachEntry,t=raptor.require("xml.utils").escapeXmlAttr,n="http://www.w3.org/XML/1998/namespace",r="http://www.w3.org/XML/1998/namespace",i=raptor.require("templating.compiler.ExpressionParser"),s=function(){s.superclass.constructor.call(this,"element"),this.prefix=null,this.localName=null,this.uri=null,this.qName=null,this.dynamicAttributesExpression=null,this.attributes={},this.allowSelfClosing=!0,this.startTagOnly=!1};return s.prototype={setStartTagOnly:function(e){this.startTagOnly=!0},setAllowSelfClosing:function(e){this.allowSelfClosing=e},isElementNode:function(){return!0},isTextNode:function(){return!1},getAttributes:function(){var t=[];return e(this.attributes,function(e,n){t.push(n)},this),t},getAttribute:function(e){return this.getAttributeNS(null,e)},getAttributeNS:function(e,t){var n=this.attributes[(e||"")+":"+t];return n?n.value:null},setAttribute:function(e,t){this.setAttributeNS(null,e,t)},setAttributeNS:function(e,t,n,r){this.attributes[(e||"")+":"+t]={localName:t,value:n,prefix:r,uri:e,qName:r?r+":"+t:t,name:e?e+":"+t:t,toString:function(){return this.name}}},setEmptyAttribute:function(e){this.setAttribute(e,null)},removeAttribute:function(e){this.removeAttributeNS(null,e)},removeAttributeNS:function(e,t){delete this.attributes[(e||"")+":"+t]},isPreserveSpace:function(){return this.preserveSpace===!0||this.getAttributeNS(n,"space")==="preserve"||this.getAttributeNS(r,"space")==="preserve"||this.getAttribute("xml:space")==="preserve"},removePreserveSpaceAttr:function(){this.removeAttributeNS(n,"space"),this.removeAttributeNS(r,"space"),this.removeAttribute("space")},setPreserveSpace:function(e){this.preserveSpace=e},setStripExpression:function(e){this.stripExpression=e},doGenerateCode:function(e){this.generateBeforeCode(e),this.generateCodeForChildren(e),this.generateAfterCode(e)},generateBeforeCode:function(n){var r=this.preserveSpace=this.isPreserveSpace(),s=this.prefix?this.prefix+":"+this.localName:this.localName;r&&this.removePreserveSpaceAttr(),n.addText("<"+s),this.attributes&&e(this.attributes,function(e,r){n.addText(" ");var o=r.prefix;!o&&r.uri&&(o=this.resolveNamespacePrefix(r.uri)),o?s=o+(r.localName?":"+r.localName:""):s=r.localName,r.value===null||r.value===undefined?n.addText(s):(n.addText(s+'="'),i.parse(r.value,{text:function(e){n.addText(t(e))},expression:function(e){n.addWrite(e,{escapeXmlAttr:!0})},error:function(e){this.addError('Invalid expression found in attribute "'+s+'". '+e)}},this),n.addText('"'))},this),this.dynamicAttributesExpression&&n.addJavaScriptCode(n.getContextHelperFunction("attrs","a")+"("+this.dynamicAttributesExpression+");"),this.childNodes.length?n.addText(">"):this.startTagOnly?n.addText(">"):this.allowSelfClosing&&n.addText("/>")},generateAfterCode:function(e){var t=this.prefix?this.prefix+":"+this.localName:this.localName;this.childNodes.length?e.addText("</"+t+">"):!this.startTagOnly&&!this.allowSelfClosing&&e.addText("></"+t+">")},toString:function(){return"<"+(this.prefix?this.prefix+":"+this.localName:this.localName)+">"}},s})
raptor.defineClass("templating.compiler.TextNode","templating.compiler.Node",function(){"use strict";var e=function(t){e.superclass.constructor.call(this,"text"),this.text=t};return e.prototype={doGenerateCode:function(e){var t=this.text;if(t){var n=e.isPreserveWhitespace();n||(t=this.text.replace(/(^\n\s*|\n\s*$)/g,"").replace(/\s+/g," ")),e.addText(t)}},getText:function(){return this.text},isTextNode:function(){return!0},isElementNode:function(){return!1},toString:function(){return"[text]"}},e})
raptor.defineClass("templating.compiler.ParseTreeBuilder",function(){"use strict";var e=raptor.require("xml.sax"),t=raptor.forEach,n=raptor.require("templating.compiler.TextNode"),r=raptor.require("templating.compiler.ElementNode"),i=function(){};return i.parse=function(e,t,n){var r=new i;return r.parse(e,t,n)},i.prototype={parse:function(i,s,o){var u=this.logger(),a=null,f=null,l=null,c,h=e.createParser({trim:!1,normalize:!1,dom:i.documentElement!=null});return h.on({error:function(e){raptor.throwError(e)},characters:function(e){if(!a)return;l?l.text+=e:(l=new n(e),l.pos=h.getPos(),a.appendChild(l))},startElement:function(e){l=null;var n,i,s,u=new r;u.prefix=e.getPrefix(),u.localName=e.getLocalName(),u.qName=e.getQName(),u.uri=o.resolveURI(e.getNamespaceURI()),u.addNamespaceMappings(e.getNamespaceMappings()),u.pos=h.getPos(),t(e.getAttributes(),function(e){e.getLocalName()==="imports"&&!e.getNamespaceURI()&&(n=e.getValue())},this),a?a.appendChild(u):(f=u,n&&(c=o.getImports(n))),t(e.getAttributes(),function(e){var t=o.resolveURI(e.getNamespaceURI()),n=e.getLocalName(),r=e.getPrefix();!t&&c&&(i=c.getImportedAttribute(n))&&(t=i.uri,n=i.name,r=i.prefix),u.setAttributeNS(t,n,e.getValue(),r)},this),!u.uri&&c&&(s=c.getImportedTag(u.localName))&&(u.uri=s.uri,u.localName=s.name,u.prefix=s.prefix),a=u},endElement:function(){l=null,a=a.parentNode}},this),h.parse(i,s),f._isRoot=!0,f},getRootNode:function(){return this.rootNode}},i})
raptor.defineClass("templating.compiler.TaglibXmlLoader",function(e){"use strict";var t=e.require("xml.sax.object-mapper"),n="string",r="boolean",i="object",s=0,o=function(e,t){this.src=e,this.filePath=t};return o.load=function(e,t){var n=new o(e,t);return n.load()},o.prototype={load:function(){var o=this.src,u=this.filePath,a=this.logger(),f={},l=function(t){var n=t["extends"];delete t["extends"];var r=f[n];r||e.throwError(new Error('Parent tag with ID "'+n+'" not found in taglib at path "'+u+'"')),r["extends"]&&l(r),e.forEachEntry(r,function(e,n){t[e]===undefined&&(t[e]=n)}),t.attributeMap&&r.attributeMap&&t.attributeMap!==r.attributeMap?e.forEachEntry(r.attributeMap,function(e,n){t.attributeMap[e]||(t.attributeMap[e]=n)}):r.attributeMap&&(t.attributemap=r.attributeMap)},c=function(e){if(!e)return;for(var t=0,n=e.length;t<n;t++){var r=e[t];r["extends"]&&l(r)}},h,p={"raptor-taglib":{_type:i,_begin:function(){var e={uri:null,shortName:null};return h||(h=e),e},"tlib-version":{_type:n,_targetProp:"version"},"short-name":{_type:n,_targetProp:"shortName"},uri:{_type:n},prefix:{_type:n},tag:{_type:i,_begin:function(){return{}},_end:function(e){e.uri==null&&(e.uri=h.uri),h.tags||(h.tags=[]),e.id&&(f[e.id]=e),h.tags.push(e)},name:{_type:n,_targetProp:"name"},uri:{_type:n,_set:function(e,t,n,r){e.uri=n||""}},id:{_type:n},"extends":{_type:n,_targetProp:"extends"},"handler-class":{_type:n,_targetProp:"handlerClass"},"compiler-class":{_type:n,_targetProp:"compilerClass"},"dynamic-attributes":{_type:r,_targetProp:"dynamicAttributes"},attribute:{_type:i,_begin:function(){return{type:"string"}},_end:function(e,t){t.attributeMap||(t.attributeMap={});var n=e.uri||"";t.attributeMap[n+":"+e.name]=e},name:{_type:n},uri:{_type:n},required:{_type:r},type:{_type:n},"allow-expressions":{_type:r,_targetProp:"allowExpressions"}},"nested-variable":{_type:i,_begin:function(){return{name:null}},_end:function(e,t){t.nestedVariables||(t.nestedVariables=[]),t.nestedVariables.push(e)},name:{_type:n,_targetProp:"name"}},"imported-variable":{_type:i,_begin:function(){return{propertyName:null,expression:null}},_end:function(e,t){t.importedVariables||(t.importedVariables=[]),t.importedVariables.push(e)},"property-name":{_type:n,_targetProp:"propertyName"},expression:{_type:n}},transformer:{_type:i,_begin:function(){return{id:s++,className:null,path:null}},_end:function(e,t){t.transformers||(t.transformers=[]),t.transformers.push(e)},"class-name":{_type:n,_targetProp:"className"},after:{_type:n,_targetProp:"after"},before:{_type:n,_targetProp:"before"}}},"text-transformer":{_type:i,_begin:function(){return{id:s++,className:null,path:null}},_end:function(e){h.textTransformers||(h.textTransformers=[]),h.textTransformers.push(e)},"class-name":{_type:n,_targetProp:"className"}},"import-taglib":{_type:i,_begin:function(){return{}},_end:function(n){var r=n.path,i=e.require("resources").findResource(r),s;i.exists()||e.throwError(new Error('Imported taglib with path "'+r+'" not found in taglib at path "'+u+'"')),s=i.readFully(),t.read(s,i.getSystemPath(),p)},path:{_type:n}},"function":{_type:i,_begin:function(){return{}},_end:function(e){h.functions||(h.functions=[]),h.functions.push(e)},name:{_type:n},"class":{_type:n,_targetProp:"functionClass"},"bind-to-context":{_type:r,_targetProp:"bindToContext"}}}};return t.read(o,u,p),c(h.tags),h}},o})
raptor.extend("templating.compiler",function(e,t){"use strict";var n=!1;return{discoverTaglibs:function(){if(n)return;n=!0;var t=$rget("rtld");e.forEach(t,function(t){var n=e.require("resources").findResource(t);n&&n.exists()&&this.loadTaglibXml(n.readFully(),n.getPath())},this)}}})
raptor.defineClass("templating.taglibs.core.CoreTagTransformer",function(e){"use strict";var t=e.extend,n=e.forEach,r="http://raptorjs.org/templates/core",i=e.errors,s=e.require("templating.compiler.Node"),o=e.require("templating.taglibs.core.WriteNode"),u=e.require("templating.taglibs.core.ForNode"),a=e.require("templating.taglibs.core.IfNode"),f=e.require("templating.taglibs.core.WhenNode"),l=e.require("templating.taglibs.core.OtherwiseNode"),c=e.require("templating.taglibs.core.TagHandlerNode"),h=e.require("templating.compiler.Expression"),p=e.require("templating.compiler.AttributeSplitter"),d=e.require("templating.compiler.TypeConverter"),v=function(e,t,n){return d.convert(e,t,n)};return{process:function(i,s){var d=this,m,g,y,b,w,E,S,x,T,N=function(e,t){n(i.getAttributes(),function(n){if(n.uri==="http://www.w3.org/2000/xmlns/"||n.uri==="http://www.w3.org/XML/1998/namespace"||n.prefix=="xmlns")return;var r=n.prefix,o=n.prefix&&n.uri!=P.taglib.uri?n.uri:null,u=P.getAttributeDef(o,n.localName);!u&&o&&(o=s.taglibs.resolveShortName(o),u=P.getAttributeDef(o,n.localName));var a=u?u.type||"string":"string",f,l=n.uri;try{f=v(n.value,a,u?u.allowExpressions!==!1:!0)}catch(c){i.addError('Invalid attribute value of "'+n.value+'" for attribute "'+n.name+'": '+c.message),f=n.value}l===P.taglib.uri&&(l="",r=""),!u&&!P.dynamicAttributes&&i.addError('The tag "'+P.name+'" in taglib "'+l+'" does not support attribute "'+n+'"'),e.call(t,l,n.localName,f,r,u)},this)};(w=i.getAttributeNS(r,"parseBodyText"))!=null&&(i.removeAttributeNS(r,"parseBodyText"),i.parseBodyText=w!=="false");if((b=i.getAttributeNS(r,"when"))!=null){i.removeAttributeNS(r,"when");var C=new f({test:new h(b),pos:i.getPosition()});i.parentNode.replaceChild(C,i),C.appendChild(i)}if(i.getAttributeNS(r,"otherwise")!=null){i.removeAttributeNS(r,"otherwise");var k=new l({pos:i.getPosition()});i.parentNode.replaceChild(k,i),k.appendChild(i)}(y=i.getAttributeNS(r,"attrs"))!=null&&(i.removeAttributeNS(r,"attrs"),i.dynamicAttributesExpression=y);if((m=i.getAttributeNS(r,"for"))!=null){i.removeAttributeNS(r,"for");var L=p.parse(m,{each:{type:"custom"},separator:{type:"expression"},varStatus:{type:"identifier"}},{defaultName:"each",errorHandler:function(e){i.addError('Invalid c:for attribute of "'+m+'". Error: '+e)}});L.pos=i.getPosition();var A=new u(L);i.parentNode.replaceChild(A,i),A.appendChild(i)}if((g=i.getAttributeNS(r,"if"))!=null){i.removeAttributeNS(r,"if");var O=new a({test:new h(g),pos:i.getPosition()});i.parentNode.replaceChild(O,i),O.appendChild(i)}if((S=i.getAttributeNS(r,"bodyContent"))!=null){i.removeAttributeNS(r,"bodyContent");var M=new o({expression:S,pos:i.getPosition()});i.removeChildren(),i.appendChild(M)}i.getAttributeNS&&(E=i.getAttributeNS(r,"strip"))!=null&&(i.removeAttributeNS(r,"strip"),i.setStripExpression||i.addError("The c:strip directive is not allowed for target node"),i.setStripExpression(E));if(i.getAttributeNS&&(x=i.getAttributeNS(r,"replace"))!=null){i.removeAttributeNS(r,"replace");var _=new o({expression:x,pos:i.getPosition()});i.parentNode.replaceChild(_,i),i=_}var D=i.uri,P=s.taglibs.getTagDef(D,i.localName);if(P){if(P.handlerClass)c.convertNode(i,P),N(function(e,t,n,r,s){s?i.setPropertyNS(e,t,n):i.addDynamicAttribute(r?r+":"+t:t,n)});else if(P.compilerClass){var H=e.require(P.compilerClass);t(i,H.prototype),H.call(i),i.setNodeClass(H),N(function(e,t,n){i.setPropertyNS(e,t,n)})}}else D&&s.taglibs.isTaglib(D)&&i.addError("Tag "+i.toString()+' is not allowed in taglib "'+D+'"')}}})
raptor.defineClass("templating.taglibs.core.CoreTextTransformer",function(){"use strict";var e=raptor.require("templating.compiler.ExpressionParser"),t=raptor.require("templating.compiler.TextNode"),n=raptor.require("templating.taglibs.core.WriteNode"),r=raptor.require("templating.taglibs.core.ScriptletNode");return{process:function(i,s){if(i.parentNode&&i.parentNode.parseBodyText===!1)return;var o=[];e.parse(i.text,{text:function(e){o.push({text:e})},expression:function(e){o.push({expression:e})},scriptlet:function(e){o.push({scriptlet:e})},error:function(e){i.addError(e)}},this);if(o.length>0){var u=0;o[0].text?(i.text=o[0].text,u=1):(i.text="",u=0);var a=[];for(var f=u;f<o.length;f++){var l=o[f],c=null;l.hasOwnProperty("text")?(c=new t(l.text),c.setTransformerApplied(this)):l.hasOwnProperty("expression")?c=new n({expression:l.expression,escapeXml:l.expression.escapeXml!==!1}):l.hasOwnProperty("scriptlet")&&(c=new r(l.scriptlet)),c&&a.push(c)}i.parentNode.insertAfter(a,i)}}}})
raptor.defineClass("templating.taglibs.core.ForNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=/^(.+)\s+in\s+(.+)$/,n=raptor.require("json.stringify").stringify,r=function(e){var n=e.match(t);if(!n)throw new Error('Invalid each attribute of "'+e+'"');return{"var":n[1],"in":n[2]}},i=function(e){i.superclass.constructor.call(this),e&&this.setProperties(e)};return i.prototype={doGenerateCode:function(e){var t=this.getProperty("each"),i=this.getProperty("separator"),s=this.getProperty("varStatus");if(!t){this.addError('"each" attribute is required'),this.generateCodeForChildren(e);return}var o;try{o=r(t)}catch(u){this.addError(u.message),this.generateCodeForChildren(e);return}var a=e.makeExpression(o["in"]),f=o["var"];i&&!s&&(s="__loop");var l=[f];s&&l.push(s),e.addJavaScriptCode(e.getStaticHelperFunction("forEach","f")+"("+a+",function("+l.join(",")+"){"),this.generateCodeForChildren(e),i&&(e.addJavaScriptCode("if (!"+s+".isLast()){"),e.addWrite(e.isExpression(i)?i.getExpression():n(i)),e.addJavaScriptCode("}")),e.addJavaScriptCode("});")}},i})
raptor.defineClass("templating.taglibs.core.IfNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(e){var t=this.getProperty("test");t||this.addError('"test" attribute is required'),e.addJavaScriptCode("if ("+t+"){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")}},t})
raptor.defineClass("templating.taglibs.core.TagHandlerNode","templating.compiler.Node",function(e){"use strict";var t=e.extend,n=e.forEach,r=e.require("json.stringify").stringify,i=e.forEachEntry,s=e.require("templating.compiler.Expression"),o=function(e,t){var n=e._handlerVars;n||(e._handlerVars=n={});var i=n[t];return i||(n[t]=i=t.replace(/[.\-]/g,"_"),e.addStaticVar(i,e.getStaticHelperFunction("getTagHandler","t")+"("+r(t)+")")),i},u=function(e){var t,n=[];return e?(i(e,function(e,t){t instanceof s?n.push(r(e)+":"+t.expression):typeof t=="string"?n.push(r(e)+":"+r(t)):n.push(r(e)+":"+t)}),n.length?"{"+n.join(",")+"}":"{}"):"{}"},a=function(e){this.nodeType||a.superclass.constructor.call(this),this.tagDef=e,this.dynamicAttributes=null};return a.convertNode=function(e,n){t(e,a.prototype),a.call(e,n)},a.prototype={addDynamicAttribute:function(e,t){this.dynamicAttributes||(this.dynamicAttributes={}),this.dynamicAttributes[e]=t},doGenerateCode:function(e){var t=o(e,this.tagDef.handlerClass);e.addJavaScriptCode(e.getContextHelperFunction("invokeHandler","t")+"("+t+","),n(this.tagDef.importedVariables,function(e){this.setProperty(e.propertyName,new s(e.expression))},this),e.addJavaScriptCode(u(this.getProperties())+",");if(this.hasChildren()){var r=[];n(this.tagDef.nestedVariables,function(e){r.push(e.name)}),e.addJavaScriptCode("function("+r.join(",")+"){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")}else e.addJavaScriptCode("null");var i=this.getPropertyNamespaces(),a=[];n(i,function(e){if(e!==""){var t=this.getPropertiesNS(e);a.push('"'+e+'":'+u(t))}},this),this.dynamicAttributes&&a.push('"*":'+u(this.dynamicAttributes)),a.length&&(e.addJavaScriptCode(",{"),e.addJavaScriptCode(a.join(",")),e.addJavaScriptCode("}")),e.addJavaScriptCode(");")}},a})
raptor.defineClass("templating.taglibs.core.TemplateNode","templating.compiler.Node",function(){"use strict";var e=raptor.forEach,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(t){var n=this.getProperty("name"),r=this.getProperty("params"),i=function(e){var n=e.replace(/[^a-zA-Z0-9]+/g,"_");return t.hasStaticVar(n)||t.addStaticVar(n,JSON.stringify(e)),n},s;r?(r=r.split(/\s*,\s*/g),e(r,function(e){t.addVar(e,"data."+e)},this)):r=null,this.forEachProperty(function(n,r,o){n||(n=this.uri),r==="functions"&&e(o.split(/\s*[,;]\s*/g),function(e){var r=t.compiler.taglibs.getFunction(n,e);r?(s=i(r.functionClass),r.bindToContext===!0?t.addVar(e,t.getContextHelperFunction("getContextHelper","h")+"("+s+","+JSON.stringify(e)+")"):t.addStaticVar(e,t.getStaticHelperFunction("getHelper","h")+"("+s+","+JSON.stringify(e)+")")):this.addError('Function with name "'+e+'" not found in taglib "'+n+'"')},this)},this),n?t.setTemplateName(n):t.getTemplateName()||this.addError('The "name" attribute is required for the '+this.toString()+" tag or it must be passed in as a compiler option."),this.generateCodeForChildren(t)}},t})
raptor.defineClass("templating.taglibs.core.WriteNode","templating.compiler.Node",function(){"use strict";var e=function(t){e.superclass.constructor.call(this,"write"),t&&this.setProperties(t)};return e.prototype={doGenerateCode:function(e){var t=this.getExpression(),n=this.getProperty("escapeXml")!==!1;t&&e.addWrite(t,{escapeXml:n})},getExpression:function(){return this.getProperty("expression")||this.getProperty("value")||this.getAttribute("expression")||this.getAttribute("value")},toString:function(){return'<c:write expression="'+this.getExpression()+'">'}},e})
raptor.defineClass("templating.taglibs.core.InvokeNode","templating.compiler.Node",function(){"use strict";var e=raptor.forEach,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(t){var n=this.getProperty("function"),r,i=t.getAttribute("core:definedFunctions");n||this.addError('"function" attribute is required');if(n.indexOf("(")===-1){r=i?i[n]:null;var s=[],o={},u=[];r&&(u=r.params||[],e(u,function(e){o[e]=!0},this)),this.forEachPropertyNS("",function(e,t){if(e==="function")return;o[e]||this.addError('Parameter with name "'+e+'" not supported for function with name "'+n+'". Allowed parameters: '+u.join(", "))},this),e(u,function(e){o[e]=!0;var t=this.getAttribute(e);t==null?s.push("undefined"):s.push(this.getProperty(e))},this),t.addWrite(n+"("+s.join(",")+")")}else{var a=n.substring(0,n.indexOf("("));r=i?i[a]:null,r?t.addWrite(n):t.addJavaScriptCode(n+";")}}},t})
raptor.defineClass("templating.taglibs.core.ScriptletNode","templating.compiler.Node",function(){"use strict";var e=function(t){e.superclass.constructor.call(this,"scriptlet"),this.code=t};return e.prototype={doGenerateCode:function(e){this.code&&e.addJavaScriptCode(this.code)},toString:function(){return"{%"+this.code+"%}"}},e})
raptor.defineClass("templating.taglibs.core.ChooseNode","templating.compiler.Node",function(e){"use strict";var t=e.require("strings"),n=e.require("templating.taglibs.core.WhenNode"),r=e.require("templating.taglibs.core.OtherwiseNode"),i=function(e){i.superclass.constructor.call(this)};return i.prototype={doGenerateCode:function(e){var i=null,s=!1;this.forEachChild(function(o){o.isTextNode()?t.isEmpty(o.getText())||this.addError('Static text "'+t.trim(o.getText())+'" is not allowed in '+this.toString()+" tag."):o.getNodeClass()===n?(i&&this.addError(i+" tag must be last child of tag "+this+"."),s||(s=!0,o.firstWhen=!0),o.generateCode(e)):o.getNodeClass()===r?(i&&this.addError("More than one "+i+" tag is not allowed as child of tag "+this+"."),i=o,o.generateCode(e)):this.addError(o+" tag is not allowed as child of tag "+this+".")},this),s||this.addError(""+i+" tag is required to have at least one sibling <c:when> tag.")}},i})
raptor.defineClass("templating.taglibs.core.DefNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=raptor.require("strings"),n=/^([A-Za-z_][A-Za-z0-9_]*)\(((?:[A-Za-z_][A-Za-z0-9_]*,\s*)*[A-Za-z_][A-Za-z0-9_]*)?\)$/,r=function(e){r.superclass.constructor.call(this),e&&this.setProperties(e)};return r.prototype={doGenerateCode:function(e){var r=this.getProperty("function");if(!r){this.addError('"function" attribute is required'),this.generateCodeForChildren(e);return}r=t.trim(r);var i=n.exec(r);if(!i){this.addError('Invalid function name of "'+r+'"'),this.generateCodeForChildren(e);return}var s=i[1],o=i[2]?i[2].split(/\s*,\s*/):[],u=e.getAttribute("core:definedFunctions");u||(u=e.setAttribute("core:definedFunctions",{})),u[s]={params:o},e.addJavaScriptCode("function "+r+"{return "+e.getStaticHelperFunction("noEscapeXml","nx")+"(context.captureString(function(){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}));}")}},r})
raptor.defineClass("templating.taglibs.core.IncludeNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=raptor.require("json.stringify").stringify,n=function(e){n.superclass.constructor.call(this),e&&this.setProperties(e)};return n.prototype={doGenerateCode:function(e){var n=this.getProperty("template"),r;if(n){this.removeProperty("template");var i=[];this.forEachPropertyNS("",function(e,n){i.push(t(e)+": "+n)},this);var s=e.getContextHelperFunction("include","i")+"("+n+",{"+i.join(",")+"});";e.addJavaScriptCode(s)}else if(r=this.getAttribute("resource")){var o=this.getProperty("static")!==!1;if(o){var u=raptor.require("resources").findResource(r);if(!u.exists()){this.addError('"each" attribute is required');return}e.addWrite(raptor.require("json.stringify").stringify(u.readFully()))}}else this.addError('"template" or "resource" attribute is required')}},n})
raptor.defineClass("templating.taglibs.core.OtherwiseNode","templating.compiler.Node",function(e){"use strict";var t=e.require("strings"),n=function(e){n.superclass.constructor.call(this),e&&this.setProperties(e)};return n.prototype={doGenerateCode:function(e){e.addJavaScriptCode(" else {"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")},toString:function(){return"<c:otherwise>"}},n})
raptor.defineClass("templating.taglibs.core.WhenNode","templating.compiler.Node",function(){"use strict";var e=raptor.errors,t=function(e){t.superclass.constructor.call(this),e&&this.setProperties(e)};return t.prototype={doGenerateCode:function(e){var t=this.getProperty("test");t||(console.error("WHEN NODE: ",this.properties),this.addError('"test" attribute is required for '+this.toString()+" tag.")),this.firstWhen||e.addJavaScriptCode(" else "),e.addJavaScriptCode("if ("+t+"){"),this.generateCodeForChildren(e),e.addJavaScriptCode("}")}},t})
raptor.defineClass("templating.taglibs.core.WithNode","templating.compiler.Node",function(e){"use strict";var t=e.errors,n=e.require("templating.compiler.AttributeSplitter"),r=/^[A-Za-z_][A-Za-z0-9_]*$/,i=function(e){i.superclass.constructor.call(this),e&&this.setProperties(e)};return i.prototype={doGenerateCode:function(t){var i=this.getProperty("vars"),s=this;i||this.addError('"vars" attribute is required');var o=n.parse(i,{"*":{type:"expression"}},{ordered:!0,errorHandler:function(e){s.addError('Invalid variable declarations of "'+i+'". Error: '+e)}}),u=[];e.forEach(o,function(e){r.test(e.name)||this.addError('Invalid variable name of "'+e.name+'" in "'+i+'"'),u.push(e.name+(e.value?"="+e.value:""))},this),t.addJavaScriptCode("(function() {"),t.addJavaScriptCode("var "+u.join(",")+";"),this.generateCodeForChildren(t),t.addJavaScriptCode("}());")}},i})
$rset("resource","/templating/taglibs/core/core.rtld",'<raptor-taglib>\n    \n    \n    <tlib-version>1.0</tlib-version>\n    \n    <uri>http://raptorjs.org/templates/core</uri>\n    <short-name>core</short-name>\n    <prefix>c</prefix>\n    \n    <tag id="template">\n        \n        <name>template</name> \n        \n        <attribute>\n            <name>name</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>params</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>imports</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <uri>*</uri>\n            <name>functions</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n\n        <compiler-class>templating.taglibs.core.TemplateNode</compiler-class>\n    </tag>\n    \n    <tag extends="template">\n    \n        <uri></uri>\n        <name>template</name>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>*</name> \n        <uri>*</uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <attribute>\n            <name>for</name>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n\n        <attribute>\n            <name>if</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>attrs</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>when</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>otherwise</name>\n            <type>empty</type>\n        </attribute>\n        \n        <attribute>\n            <name>parseBodyText</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>strip</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>bodyContent</name>\n            <type>expression</type>\n        </attribute>\n        \n        <attribute>\n            <name>replace</name>\n            <type>expression</type>\n        </attribute>\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.core.CoreTagTransformer</class-name>\n        </transformer>\n    </tag>\n    \n    \n    \n    <tag>\n        \n        <name>for</name> \n\n        <compiler-class>templating.taglibs.core.ForNode</compiler-class>\n        \n        <attribute>\n            <name>each</name>\n            <required>true</required>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <attribute>\n            <name>separator</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>varStatus</name>\n            <type>identifier</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n    </tag>\n    \n    <tag>\n        \n        <name>write</name> \n\n        <compiler-class>templating.taglibs.core.WriteNode</compiler-class>\n        \n        <attribute>\n            <name>value</name>\n            <required>true</required>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>escapeXml</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>if</name> \n\n        <compiler-class>templating.taglibs.core.IfNode</compiler-class>\n\n        <attribute>\n            <name>test</name>\n            <type>expression</type>\n        </attribute>\n\n    </tag>\n    \n    <tag>\n        \n        <name>invoke</name> \n\n        <compiler-class>templating.taglibs.core.InvokeNode</compiler-class>\n\n        <attribute>\n            <name>function</name>\n            <type>custom</type>\n            <allow-expressions>false</allow-expressions>\n            <required>true</required>\n        </attribute>\n\n        <attribute>\n            <name>*</name>\n            <uri></uri>\n            <type>string</type>\n            <allow-expressions>true</allow-expressions>\n        </attribute>\n    </tag>\n    \n    <tag>\n        \n        <name>choose</name> \n\n        <compiler-class>templating.taglibs.core.ChooseNode</compiler-class>\n\n    </tag>\n\n    <tag>\n        \n        <name>when</name> \n\n        <compiler-class>templating.taglibs.core.WhenNode</compiler-class>\n\n        <attribute>\n            <name>test</name>\n            <type>expression</type>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>otherwise</name> \n\n        <compiler-class>templating.taglibs.core.OtherwiseNode</compiler-class>\n\n    </tag>\n        \n    <tag>\n        \n        <name>def</name> \n\n        <compiler-class>templating.taglibs.core.DefNode</compiler-class>\n\n        <attribute>\n            <name>function</name>\n            <type>custom</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>with</name> \n\n        <compiler-class>templating.taglibs.core.WithNode</compiler-class>\n\n        <attribute>\n            <name>vars</name>\n            <type>custom</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n    </tag>\n    \n    <tag>\n        \n        <name>include</name> \n\n        <compiler-class>templating.taglibs.core.IncludeNode</compiler-class>\n\n        <attribute>\n            <name>template</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>resource</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>static</name>\n            <type>boolean</type>\n            <allow-expressions>false</allow-expressions>\n        </attribute>\n        \n        <dynamic-attributes>true</dynamic-attributes>\n        \n    </tag>\n    \n    <text-transformer>\n        <class-name>templating.taglibs.core.CoreTextTransformer</class-name>\n    </text-transformer>\n    \n</raptor-taglib>'),$radd("rtld","/templating/taglibs/core/core.rtld")
raptor.defineClass("templating.taglibs.html.HtmlTagTransformer",function(){"use strict";return{process:function(e,t){if(e.isElementNode()){var n=t.options||{},r=n.preserveWhitespace||{},i=n.allowSelfClosing||{},s=n.startTagOnly||{},o=e.uri?e.uri+":"+e.localName:e.localName;r[o]===!0&&e.setPreserveSpace(!0),i[o]===!1&&e.setAllowSelfClosing(!1),t.options.xhtml!==!0&&s[o]===!0&&e.setStartTagOnly(!0)}}}})
$rset("resource","/templating/taglibs/html/html.rtld","<raptor-taglib>\n    \n    \n    <tlib-version>1.0</tlib-version>\n    <short-name>html</short-name>\n    <uri>http://raptorjs.org/templates/html</uri>\n\n    <tag>\n        \n        <name>pre</name> \n        <uri></uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.html.HtmlTagTransformer</class-name>\n        </transformer>\n    </tag>\n    \n    <tag>\n        \n        <name>*</name> \n        <uri>*</uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.html.HtmlTagTransformer</class-name>\n        </transformer>\n    </tag>\n    \n</raptor-taglib>"),$radd("rtld","/templating/taglibs/html/html.rtld")
raptor.defineClass("templating.taglibs.widgets.WidgetsTagTransformer",function(e){"use strict";var t="http://raptorjs.org/templates/widgets";return{process:function(e,n,r){var i,s;if(i=e.getPropertyNS(t,"id"))e.removePropertyNS(t,"id"),e.setProperty("widgetContext",r.makeExpression("[widget, "+i+"]"));if(s=e.getAttributeNS(t,"widget")){e.removeAttributeNS(t,"widget");var o=n.createTagHandlerNode(t,"widget");e.parentNode.replaceChild(o,e),o.appendChild(e),o.setProperty("jsClass",s),o.setProperty("widgetContext",r.makeExpression("[widget, "+i+"]"));var u=e.getAttribute("id");u?(u=n.convertType(u,"string",!0),o.setProperty("id",u)):e.setAttribute("id","${widget.elId()}")}}}})
raptor.defineClass("templating.taglibs.widgets.InitWidgetsTag",function(e){"use strict";var t=e.require("widgets");return{process:function(e,n){if(!t.hasWidgets(n))return;var r=e.includeScriptTag!==!1;r&&n.write('<script type="text/javascript">'),t.writeInitWidgetsCode(n,!0),r&&n.write("</script>")}}})
raptor.defineClass("templating.taglibs.widgets.WidgetTag",function(e){"use strict";var t=e.require("widgets");return{process:function(e,n){var r=e.jsClass,i=e.config,s=e.widgetContext,o=e.id,u,a;s&&(u=s[0],a=s[1]);var f=t.addWidget(r,o,a,i,u,n);e.invokeBody(f)}}})
$rset("resource","/templating/taglibs/widgets/widgets.rtld",'<raptor-taglib>\n    \n    \n    <tlib-version>1.0</tlib-version>\n    <short-name>widgets</short-name>\n    <uri>http://raptorjs.org/templates/widgets</uri>\n    \n    <tag>\n        \n        <name>*</name> \n        <uri>*</uri> <!-- Register attributes supported by all tags in all namespaces -->\n        \n        <attribute>\n            <name>id</name>\n            <type>string</type>\n        </attribute>\n        \n        <attribute>\n            <name>widget</name>\n        </attribute>\n        \n        <!-- Compiler that applies to all tags as well -->\n        <transformer>\n            <class-name>templating.taglibs.widgets.WidgetsTagTransformer</class-name>\n            <after>templating.taglibs.core.CoreTagTransformer</after>\n        </transformer>\n    </tag>\n    \n    <tag>\n        <name>widget</name>\n        <handler-class>templating.taglibs.widgets.WidgetTag</handler-class>\n        \n        <attribute name="jsClass" type="string"/>\n        \n        <nested-variable name="widget"/>\n        \n        <imported-variable property-name="config" expression="data.widgetConfig"/>\n        <imported-variable property-name="widgetContext" expression="data.widgetContext"/>\n    </tag>\n    \n    <tag>\n        <name>initWidgets</name>\n        <handler-class>templating.taglibs.widgets.InitWidgetsTag</handler-class>\n        \n        <attribute name="includeScriptTag" type="boolean"/>\n    </tag>\n    \n</raptor-taglib>'),$radd("rtld","/templating/taglibs/widgets/widgets.rtld")
$rset("rhtml","taglibs/test/Button",function(e){var t=e.e,n=e.ne,r=e.t,i=r("templating.taglibs.widgets.WidgetTag"),s=e.xa,o=e.x;return function(e,t,n){var r=n.w,u=e.widget,a=e.buttonAttrs,f=e.label,l=n.t,c=n.a;l(i,{jsClass:"taglibs.test.ButtonWidget",widgetContext:e.widgetContext,config:e.widgetConfig},function(e){r('<button id="')(s(e.elId()))('"'),c(a),r(">")(o(f))("</button>")})}})
raptor.defineClass("taglibs.test.Button.ButtonTag",function(e){return{process:function(e,t){var n=e.disabled===!0,r={disabled:n?null:undefined,type:e.type||"button"};e.color&&(r.style="background-color: "+e.color),t.renderTemplate("taglibs/test/Button",{label:e.label,widgetContext:e.widgetContext,widgetConfig:{disabled:n},buttonAttrs:r})}}})
$rset("rhtml","taglibs/test/Container",function(e){var t=e.e,n=e.ne,r=e.x;return function(e,t,n){var i=n.w,s=e.widget,o=e.title;i("<div><h1>")(r(o))('</h1><div class="bd">'),e.invokeBody(),i("</div></div>")}})
raptor.defineClass("taglibs.test.Container.ContainerTag",function(e){return{process:function(e,t){t.renderTemplate("taglibs/test/Container",{title:e.title,invokeBody:e.invokeBody})}}})
raptor.defineClass("taglibs.test.Greeting.GreetingTag",function(e){var t=function(){};return t.prototype={process:function(e,t){t.write("Hello "+e.name+"!")}},t})
raptor.defineClass("taglibs.test.Tab.TabTag",function(e){var t=function(){};return t.prototype={process:function(e,t){var n=e.tabs;n.addTab(e)}},t})
$rset("rhtml","taglibs/test/Tabs",function(e){var t=e.e,n=e.ne,r=e.f,i=e.xa,s=e.x;return function(e,t,n){var o=n.w,u=e.tabs;o('<div class="tabs"><ul class="nav nav-tabs">'),r(u,function(e){o('<li class="')(i(e.liClass))('"><a href="#')(i(e.id))('" data-toggle="tab">')(s(e.title))("</a></li>")}),o('</ul><div class="tab-content">'),r(u,function(e){o('<div id="')(i(e.id))('" class="')(i(e.divClass))('">'),e.invokeBody(),o("</div>")}),o("</div></div>")}})
raptor.defineClass("taglibs.test.Tabs.TabsTag",function(e){var t=e.require("templating"),n=function(){};return n.prototype={process:function(n,r){var i=[],s=!1;n.invokeBody({addTab:function(e){e.active&&(e.activeFound=!0),e.id="tab"+i.length,i.push(e)}}),!s&&i.length&&(i[0].active=!0),e.forEach(i,function(e){e.liClass=e.active?"active":"",e.divClass=e.active?"tab-pane active":"tab-pane"}),t.render("taglibs/test/Tabs",{tabs:i},r)}},n})
raptor.define("taglibs.test.TestFunctions",{upperCase:function(e){return e?e.toString().toUpperCase():""},classNames:function(){var e=[];for(var t=0,n=arguments.length,r;t<n;t++)r=arguments[t],r&&e.push(r);return e.join(" ")}})
$rset("resource","/taglibs/test/test.rtld",'<raptor-taglib>\n    \n    <tlib-version>1.0</tlib-version>\n    <short-name>test</short-name>\n    <uri>http://raptorjs.org/templates/test</uri>\n    \n    <import-taglib path="/taglibs/test/Button/Button.rtld"/>\n    <import-taglib path="/taglibs/test/Container/Container.rtld"/>\n    <import-taglib path="/taglibs/test/Greeting/Greeting.rtld"/>\n    <import-taglib path="/taglibs/test/Tab/Tab.rtld"/>\n    <import-taglib path="/taglibs/test/Tabs/Tabs.rtld"/>\n    \n    <function class="taglibs.test.TestFunctions">\n        <name>upperCase</name>\n    </function>\n    \n    <function class="taglibs.test.TestFunctions">\n        <name>classNames</name>\n    </function>\n\n</raptor-taglib>'),$radd("rtld","/taglibs/test/test.rtld")
$rset("resource","/taglibs/test/Button/Button.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>button</name>\n        <handler-class>taglibs.test.Button.ButtonTag</handler-class>\n        \n        <attribute name="label"/>\n        <attribute name="type"/>\n        <attribute name="color"/>\n        <attribute name="disabled" type="boolean"/>\n        <attribute name="id" uri="widgets" type="string"/>\n    </tag>\n    \n</raptor-taglib>')
$rset("resource","/taglibs/test/Container/Container.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>container</name>\n        <handler-class>taglibs.test.Container.ContainerTag</handler-class>\n        \n        <attribute name="title"/>\n    </tag>\n    \n</raptor-taglib>')
$rset("resource","/taglibs/test/Greeting/Greeting.rtld","<raptor-taglib>\n\n    <tag>\n        <name>greeting</name>\n        <handler-class>taglibs.test.Greeting.GreetingTag</handler-class>\n        <attribute>\n            <name>name</name>\n        </attribute>\n        <attribute>\n            <name>adult</name>\n            <type>boolean</type>\n        </attribute>\n    </tag>\n    \n</raptor-taglib>")
$rset("resource","/taglibs/test/Tab/Tab.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>tab</name>\n        <handler-class>taglibs.test.Tab.TabTag</handler-class>\n        \n        <attribute name="title"/>\n        \n        <imported-variable property-name="tabs" expression="tabs"/>\n    </tag>\n    \n</raptor-taglib>')
$rset("resource","/taglibs/test/Tabs/Tabs.rtld",'<raptor-taglib>\n\n    <tag>\n        <name>tabs</name>\n        <handler-class>taglibs.test.Tabs.TabsTag</handler-class>\n        <nested-variable name="tabs"/>\n    </tag>\n    \n</raptor-taglib>')
raptor.define("widgets",function(e){"use strict";var t=function(e,t,n,r,i){this.type=t,this.id=e,this.nestedWidgetId=n,this.config=r,this.parent=i,this.children=[],i&&i.children.push(this)};return t.prototype={elId:function(e){return arguments.length===0?this.id:this.id+"-"+e}},{addWidget:function(n,r,i,s,o,u){r||(r=this._nextWidgetId(u));var a=new t(r,n,i,s,o);i&&(o||e.throwError(new Error("Widget with an assigned ID is not scoped within another widget.")),a.docId=o.id);if(!o){var f=u.attributes;f.widgets||(f.widgets=[]),f.widgets.push(a)}return a},hasWidgets:function(e){var t=e.attributes;return t.widgets&&t.widgets.length!==0},_nextDocId:function(e){var t=e.attributes;return t.nextDocId||(t.nextDocId=1),t.nextDocId++}}})
raptor.extend("widgets",function(e){"use strict";var t="prototype",n={},r=e.errors,i=e.listeners,s="events",o=e.require("widgets.Widget"),u=e.arrayFromArguments,a=0,f=function(e){this.widget=e,this.widgetsById={}};return f.prototype={addWidget:function(e,t){var n=this.widgetsById[t],r=this.widget,i;t.length>2&&t.substring(t.length-2)==="[]"&&(t=t.slice(0,-2),i=!0),n?n.push(e):this.widgetsById[t]=[e],i?(r[t]||(r[t]=[])).push(e):r[t]=e},getWidget:function(t){var n=this.widgetsById[t];if(!n||n.length===0)return undefined;if(n.length===1)return n[0];e.throwError(new Error('getWidget: Multiple widgets found with ID "'+t+'"'))},getWidgets:function(e){return this.widgetsById[e]||[]}},{_initAll:function(a){var l=this.logger(),c={},h=function(e,t,n){try{e.init(t)}catch(r){l.error('Unable to initialize widget of type "'+n+"'. Exception: "+r,r)}},p=function(e,t,n){e.onReady(function(){h(e,t,n)})},d=function(e,t){return this.publish(e,u(arguments,1))},v=function(u,a){if(!u)return;var c=0,m=u.length;for(;c<m;c++){var g=u[c],y=g[0],b=g[1],w=g[2],E=g[3],S=g[4]||{},x=g.slice(5);w===0&&(w=undefined),E===0&&(E=undefined),S===0&&(E=undefined),l.debug('Creating widget of type "'+y+'" ('+b+")");var T=e.find(y);T||r.throwError(new Error('Unable to initialize widget of type "'+y+'". The class for the widget was not found.'));var N=o._init,C;N[t]=C=T[t],C.init=T,C._isWidget||e.extend(C,o,!1);var k=new N;i.makeObservable(k,C),C.notify||(C.notify=d,C.on=C.subscribe),k.registerMessages(["beforeDestroy","destroy"],!1);var L=C[s]||T[s];L&&k.registerMessages(L,!1),k._id=b,k._childId=E,n[b]=k,E&&w&&n[w]._doc.addWidget(k,E),k._doc=new f(k),x&&x.length&&v(x,k),k.initBeforeOnDomReady===!0?h(k,S,y):p(k,S,y)}};v(a)},get:function(e){return n[e]},_nextWidgetId:function(){return"c"+a++}}}),raptor.global.$rwidgets=function(){"use strict";var e=raptor.require("widgets");e._initAll(raptor.arrayFromArguments(arguments))}
raptor.defineMixin("widgets.Widget",{singleton:!0},function(e){"use strict";var t=e.forEach,n=e.require("listeners"),r=function(e,i,s){var o={widget:e},u;e.publish("beforeDestroy",o),n.unsubscribeFromAll(e),e.__destroyed=!0,i&&(u=e.getRootEl(),u&&u.parentNode.removeChild(u)),s&&t(e.getChildren(),function(e){r(e,i&&!u,!0)}),e.publish("destroy",o)};return{_isWidget:!0,_init:function(){this._children=[],this._childrenById={}},getElId:function(e){return e?this._id+"-"+e:this._id},getRootElId:function(e){return this.getElId()},getEl:function(e){return document.getElementById(this.getElId(e))},getRootEl:function(){return this.getEl()},getWidget:function(e){var t=this._doc;return t?t.getWidget(e):null},getWidgets:function(e){var t=this._doc;return t?t.getWidgets(e):null},getChild:function(e){return this.getWidget(e)},getChildren:function(e){return this.getWidget(e)},getDoc:function(){return this._doc},getParent:function(){return this._parentWidget},getChildWidget:function(e){return this.getChild(e)},getChildWidgets:function(e){return this.getChildren.apply(this,arguments)},getParentWidget:function(){return this._parentWidget},destroy:function(e){r(this,!0,!0)},isDestroyed:function(){return this.__destroyed}}})
raptor.extend("widgets.Widget",function(e){"use strict";var t=/\#(\w+)( .*)?/g,n=e.global;return{$:function(e){var r=arguments;if(r.length===1){if(typeof e=="function"){var i=this;$(function(){e.apply(i,r)})}else if(typeof e=="string"){var s=t.exec(e);t.lastIndex=0;if(s!=null){var o=s[1];return s[2]==null?$(this.getEl(o)):$("#"+this.getElId(o)+s[2])}var u=this.getEl();if(!u)throw new Error("Root element is not defined for widget");if(u)return $(e,u)}}else if(r.length===2){if(typeof r[1]=="string")return $(e,this.getEl(r[1]))}else if(r.length===0)return $(this.getEl());return $.apply(n,arguments)},onReady:function(e){var t=this;$(function(){e.call(t,t)})}}})
var CodeMirror=function(){function e(r,i){function sn(e){return e>=0&&e<Ct.size}function un(e){return E(Ct,e)}function an(e,t){Wt=!0;var n=t-e.height;for(var r=e;r;r=r.parent)r.height+=n}function fn(e){var t={line:0,ch:0};Ln(t,{line:Ct.size-1,ch:un(Ct.size-1).text.length},lt(e),t,t),Ft=!0}function ln(e){var t=[];return Ct.iter(0,Ct.size,function(e){t.push(e.text)}),t.join(e||"\n")}function cn(e){K.scrollTop&&(bt.scrollTop+=K.scrollTop,K.scrollTop=0);if(Dt!=bt.scrollTop||Pt!=K.scrollLeft)Dt=bt.scrollTop,Pt=K.scrollLeft,tr([]),s.fixedGutter&&(st.style.left=K.scrollLeft+"px"),s.onScroll&&s.onScroll(on)}function hn(e){function d(e){if(i=="single")ur(n,e);else if(i=="double"){var t=yr(e);rt(e,h)?ur(t.from,p):ur(h,t.to)}else i=="triple"&&(rt(e,h)?ur(p,hr({line:e.line,ch:0})):ur(h,hr({line:e.line+1,ch:0})))}function v(e){var t=ei(e,!0);if(t&&!nt(t,u)){Lt||Tn(),u=t,d(t),Ft=!1;var n=er();if(t.line>=n.to||t.line<n.from)a=setTimeout(pi(function(){v(e)}),150)}}function m(e){clearTimeout(a);var t=ei(e);t&&d(t),L(e),Jn(),Ft=!0,g(),l()}or(D(e,"shiftKey"));for(var t=M(e);t!=C;t=t.parentNode)if(t.parentNode==G&&t!=Y)return;for(var t=M(e);t!=C;t=t.parentNode)if(t.parentNode==ot)return s.onGutterClick&&s.onGutterClick(on,at(ot.childNodes,t)+$t,e),L(e);var n=ei(e);switch(_(e)){case 3:j&&ti(e);return;case 2:n&&lr(n.line,n.ch,!0),setTimeout(Jn,20),L(e);return}if(!n){M(e)==K&&L(e);return}Lt||Tn();var r=+(new Date),i="single";if(_t&&_t.time>r-400&&nt(_t.pos,n))i="triple",L(e),setTimeout(Jn,20),br(n.line);else if(Mt&&Mt.time>r-400&&nt(Mt.pos,n)){i="double",_t={time:r,pos:n},L(e);var o=yr(n);ur(o.from,o.to)}else Mt={time:r,pos:n};var u=n,a;if(s.dragDrop&&J&&!s.readOnly&&!nt(At.from,At.to)&&!rt(n,At.from)&&!rt(At.to,n)&&i=="single"){U&&(K.draggable=!0);function f(t){U&&(K.draggable=!1),Ht=!1,l(),c(),Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)<10&&(L(t),lr(n.line,n.ch,!0),Jn())}var l=P(document,"mouseup",pi(f),!0),c=P(K,"drop",pi(f),!0);Ht=!0,K.dragDrop&&K.dragDrop();return}L(e),i=="single"&&lr(n.line,n.ch,!0);var h=At.from,p=At.to,g=P(document,"mousemove",pi(function(e){clearTimeout(a),L(e),!F&&!_(e)?m(e):v(e)}),!0),l=P(document,"mouseup",pi(m),!0)}function pn(e){for(var t=M(e);t!=C;t=t.parentNode)if(t.parentNode==ot)return L(e);L(e)}function dn(e){if(s.onDragEvent&&s.onDragEvent(on,k(e)))return;e.preventDefault();var t=ei(e,!0),n=e.dataTransfer.files;if(!t||s.readOnly)return;if(n&&n.length&&window.FileReader&&window.File){function r(e,n){var r=new FileReader;r.onload=function(){o[n]=r.result,++u==i&&(t=hr(t),pi(function(){var e=jn(o.join(""),t,t);ur(t,e)})())},r.readAsText(e)}var i=n.length,o=Array(i),u=0;for(var a=0;a<i;++a)r(n[a],a)}else{if(Ht&&!rt(t,At.from)&&!rt(At.to,t))return;try{var o=e.dataTransfer.getData("Text");o&&di(function(){var e=At.from,n=At.to;ur(t,t),Ht&&jn("",e,n),Fn(o),Jn()})}catch(e){}}}function vn(e){var t=Rn();e.dataTransfer.setData("Text",t);if(j||z||W){var n=document.createElement("img");n.scr="data:image/gif;base64,R0lGODdhAgACAIAAAAAAAP///ywAAAAAAgACAAACAoRRADs=",e.dataTransfer.setDragImage(n,0,0)}}function mn(e,t){if(typeof e=="string"){e=u[e];if(!e)return!1}var n=Ot;try{s.readOnly&&(jt=!0),t&&(Ot=null),e(on)}catch(r){if(r!=B)throw r;return!1}finally{Ot=n,jt=!1}return!0}function gn(e){function u(){o=!0}var t=f(s.keyMap),n=t.auto;clearTimeout(wn),n&&!c(e)&&(wn=setTimeout(function(){f(s.keyMap)==t&&(s.keyMap=n.call?n.call(null,on):n)},50));var r=ht[D(e,"keyCode")],i=!1;if(r==null||e.altGraphKey)return!1;D(e,"altKey")&&(r="Alt-"+r),D(e,"ctrlKey")&&(r="Ctrl-"+r),D(e,"metaKey")&&(r="Cmd-"+r);var o=!1;return D(e,"shiftKey")?i=l("Shift-"+r,s.extraKeys,s.keyMap,function(e){return mn(e,!0)},u)||l(r,s.extraKeys,s.keyMap,function(e){if(typeof e=="string"&&/^go[A-Z]/.test(e))return mn(e)},u):i=l(r,s.extraKeys,s.keyMap,mn,u),o&&(i=!1),i&&(L(e),ni(),F&&(e.oldKeyCode=e.keyCode,e.keyCode=0)),i}function yn(e,t){var n=l("'"+t+"'",s.extraKeys,s.keyMap,function(e){return mn(e,!0)});return n&&(L(e),ni()),n}function En(e){Lt||Tn(),F&&e.keyCode==27&&(e.returnValue=!1),Un&&Vn()&&(Un=!1);if(s.onKeyEvent&&s.onKeyEvent(on,k(e)))return;var t=D(e,"keyCode");or(t==16||D(e,"shiftKey"));var r=gn(e);W&&(bn=r?t:null,!r&&t==88&&D(e,n?"metaKey":"ctrlKey")&&Fn(""))}function Sn(e){Un&&Vn();if(s.onKeyEvent&&s.onKeyEvent(on,k(e)))return;var t=D(e,"keyCode"),n=D(e,"charCode");if(W&&t==bn){bn=null,L(e);return}if((W&&(!e.which||e.which<10)||V)&&gn(e))return;var r=String.fromCharCode(n==null?t:n);s.electricChars&&Nt.electricChars&&s.smartIndent&&!s.readOnly&&Nt.electricChars.indexOf(r)>-1&&setTimeout(pi(function(){Er(At.to.line,"smart")}),75);if(yn(e,r))return;Wn()}function xn(e){if(s.onKeyEvent&&s.onKeyEvent(on,k(e)))return;D(e,"keyCode")==16&&(Ot=null)}function Tn(){if(s.readOnly=="nocursor")return;Lt||(s.onFocus&&s.onFocus(on),Lt=!0,K.className.search(/\bCodeMirror-focused\b/)==-1&&(K.className+=" CodeMirror-focused"),zt||$n(!0)),zn(),ni()}function Nn(){Lt&&(s.onBlur&&s.onBlur(on),Lt=!1,Qt&&pi(function(){Qt&&(Qt(),Qt=null)})(),K.className=K.className.replace(" CodeMirror-focused","")),clearInterval(Tt),setTimeout(function(){Lt||(Ot=null)},150)}function Cn(e){return e>0&&e<1?1:e>-1&&e<0?-1:Math.round(e)}function kn(e){var t=0,n=0;if(e.type=="DOMMouseScroll"){var r=-e.detail*8;e.axis==e.HORIZONTAL_AXIS?t=r:e.axis==e.VERTICAL_AXIS&&(n=r)}else e.wheelDeltaX!==undefined&&e.wheelDeltaY!==undefined?(t=e.wheelDeltaX/3,n=e.wheelDeltaY/3):e.wheelDelta!==undefined&&(n=e.wheelDelta/3);var i=!1;t=Cn(t),n=Cn(n);if(t>0&&K.scrollLeft>0||t<0&&K.scrollLeft+K.clientWidth<K.scrollWidth)K.scrollLeft-=t,i=!0;if(n>0&&bt.scrollTop>0||n<0&&bt.scrollTop+bt.clientHeight<bt.scrollHeight)bt.scrollTop-=n,i=!0;i&&O(e)}function Ln(e,t,n,r,i){if(jt)return;if(tn){var o=[];Ct.iter(e.line,t.line+1,function(e){o.push(e.text)}),tn.addChange(e.line,n.length,o);while(tn.done.length>s.undoDepth)tn.done.shift()}_n(e,t,n,r,i)}function An(e,t){if(!e.length)return;var n=e.pop(),r=[];for(var i=n.length-1;i>=0;i-=1){var s=n[i],o=[],u=s.start+s.added;Ct.iter(s.start,u,function(e){o.push(e.text)}),r.push({start:s.start,added:s.old.length,old:o});var a={line:s.start+s.old.length-1,ch:ut(o[o.length-1],s.old[s.old.length-1])};_n({line:s.start,ch:0},{line:u-1,ch:un(u-1).text.length},s.old,a,a)}Ft=!0,t.push(r)}function On(){An(tn.done,tn.undone)}function Mn(){An(tn.undone,tn.done)}function _n(e,t,n,r,i){function T(e){return e<=Math.min(t.line,t.line+y)?e:e+y}if(jt)return;var o=!1,u=Gt.length;s.lineWrapping||Ct.iter(e.line,t.line+1,function(e){if(!e.hidden&&e.text.length==u)return o=!0,!0});if(e.line!=t.line||n.length>1)Wt=!0;var a=t.line-e.line,f=un(e.line),l=un(t.line);if(e.ch==0&&t.ch==0&&n[n.length-1]==""){var c=[],h=null;e.line?(h=un(e.line-1),h.fixMarkEnds(l)):l.fixMarkStarts();for(var p=0,d=n.length-1;p<d;++p)c.push(g.inheritMarks(n[p],h));a&&Ct.remove(e.line,a,Xt),c.length&&Ct.insert(e.line,c)}else if(f==l)if(n.length==1)f.replace(e.ch,t.ch,n[0]);else{l=f.split(t.ch,n[n.length-1]),f.replace(e.ch,null,n[0]),f.fixMarkEnds(l);var c=[];for(var p=1,d=n.length-1;p<d;++p)c.push(g.inheritMarks(n[p],f));c.push(l),Ct.insert(e.line+1,c)}else if(n.length==1)f.replace(e.ch,null,n[0]),l.replace(null,t.ch,""),f.append(l),Ct.remove(e.line+1,a,Xt);else{var c=[];f.replace(e.ch,null,n[0]),l.replace(null,t.ch,n[n.length-1]),f.fixMarkEnds(l);for(var p=1,d=n.length-1;p<d;++p)c.push(g.inheritMarks(n[p],f));a>1&&Ct.remove(e.line+1,a-1,Xt),Ct.insert(e.line+1,c)}if(s.lineWrapping){var v=Math.max(5,K.clientWidth/Gr()-3);Ct.iter(e.line,e.line+n.length,function(e){if(e.hidden)return;var t=Math.ceil(e.text.length/v)||1;t!=e.height&&an(e,t)})}else Ct.iter(e.line,e.line+n.length,function(e){var t=e.text;!e.hidden&&t.length>u&&(Gt=t,u=t.length,Zt=!0,o=!1)}),o&&(Yt=!0);var m=[],y=n.length-a-1;for(var p=0,b=kt.length;p<b;++p){var w=kt[p];w<e.line?m.push(w):w>t.line&&m.push(w+y)}var E=e.line+Math.min(n.length,500);ui(e.line,E),m.push(E),kt=m,fi(100),qt.push({from:e.line,to:t.line+1,diff:y});var S={from:e,to:t,text:n};if(Rt){for(var x=Rt;x.next;x=x.next);x.next=S}else Rt=S;ar(hr(r),hr(i),T(At.from.line),T(At.to.line))}function Dn(){var e=Ct.height*Jr()+2*Yr();return e-1>K.offsetHeight?e:!1}function Pn(e){var t=Dn();bt.style.display=t?"block":"none",t&&(wt.style.height=t+"px",bt.style.height=K.offsetHeight+"px",e!=null&&(bt.scrollTop=e)),Y.style.top=Vt*Jr()-bt.scrollTop+"px"}function Hn(){var e=document.createElement("div"),t=document.createElement("div");e.className="CodeMirror-scrollbar",e.style.cssText="position: absolute; left: -9999px; height: 100px;",t.className="CodeMirror-scrollbar-inner",t.style.height="200px",e.appendChild(t),document.body.appendChild(e);var n=e.offsetWidth<=1;return document.body.removeChild(e),n}function Bn(){var e=0;Gt="",Zt=!0,Ct.iter(0,Ct.size,function(t){var n=t.text;!t.hidden&&n.length>e&&(e=n.length,Gt=n)}),Yt=!1}function jn(e,t,n){function r(r){if(rt(r,t))return r;if(!rt(n,r))return i;var s=r.line+e.length-(n.line-t.line)-1,o=r.ch;return r.line==n.line&&(o+=e[e.length-1].length-(n.ch-(n.line==t.line?t.ch:0))),{line:s,ch:o}}t=hr(t),n?n=hr(n):n=t,e=lt(e);var i;return In(e,t,n,function(e){return i=e,{from:r(At.from),to:r(At.to)}}),i}function Fn(e,t){In(lt(e),At.from,At.to,function(e){return t=="end"?{from:e,to:e}:t=="start"?{from:At.from,to:At.from}:{from:At.from,to:e}})}function In(e,t,n,r){var i=e.length==1?e[0].length+t.ch:e[e.length-1].length,s=r({line:t.line+e.length-1,ch:i});Ln(t,n,e,s.from,s.to)}function qn(e,t,n){var r=e.line,i=t.line;if(r==i)return un(r).text.slice(e.ch,t.ch);var s=[un(r).text.slice(e.ch)];return Ct.iter(r+1,i,function(e){s.push(e.text)}),s.push(un(i).text.slice(0,t.ch)),s.join(n||"\n")}function Rn(e){return qn(At.from,At.to,e)}function zn(){if(Un)return;St.set(s.pollInterval,function(){li(),Vn(),Lt&&zn(),ci()})}function Wn(){function t(){li();var n=Vn();!n&&!e?(e=!0,St.set(60,t)):(Un=!1,zn()),ci()}var e=!1;Un=!0,St.set(20,t)}function Vn(){if(zt||!Lt||ct(X)||s.readOnly)return!1;var e=X.value;if(e==Xn)return!1;Ot=null;var t=0,n=Math.min(Xn.length,e.length);while(t<n&&Xn[t]==e[t])++t;return t<Xn.length?At.from={line:At.from.line,ch:At.from.ch-(Xn.length-t)}:Bt&&nt(At.from,At.to)&&(At.to={line:At.to.line,ch:Math.min(un(At.to.line).text.length,At.to.ch+(e.length-t))}),Fn(e.slice(t),"end"),e.length>1e3?X.value=Xn="":Xn=e,!0}function $n(e){nt(At.from,At.to)?e&&(Xn=X.value=""):(Xn="",X.value=Rn(),tt(X))}function Jn(){s.readOnly!="nocursor"&&X.focus()}function Kn(){var e=vt.getBoundingClientRect();if(F&&e.top==e.bottom)return;var t=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(e.top<0||e.bottom>t)&&Qn()}function Qn(){var e=Gn();return Yn(e.x,e.y,e.x,e.yBot)}function Gn(){var e=Ur(At.inverted?At.from:At.to),t=s.lineWrapping?Math.min(e.x,pt.offsetWidth):e.x;return{x:t,y:e.y,yBot:e.yBot}}function Yn(e,t,n,r){var i=Zn(e,t,n,r),o=!1;i.scrollLeft!=null&&(K.scrollLeft=i.scrollLeft,o=!0),i.scrollTop!=null&&(bt.scrollTop=i.scrollTop,o=!0),o&&s.onScroll&&s.onScroll(on)}function Zn(e,t,n,r){var i=Zr(),o=Yr();t+=o,r+=o,e+=i,n+=i;var u=K.clientHeight,a=bt.scrollTop,f={},l=K.scrollHeight,c=t<o+10,h=r+o>l-10;t<a?f.scrollTop=c?0:Math.max(0,t):r>a+u&&(f.scrollTop=(h?l:r)-u);var p=K.clientWidth,d=K.scrollLeft,v=s.fixedGutter?st.clientWidth:0,m=e<v+i+10;return e<d+v||m?(m&&(e=0),f.scrollLeft=Math.max(0,e-10-v)):n>p+d-3&&(f.scrollLeft=n+10-p),f}function er(e){var t=Jr(),n=(e!=null?e:bt.scrollTop)-Yr(),r=Math.max(0,Math.floor(n/t)),i=Math.ceil((n+K.clientHeight)/t);return{from:x(Ct,r),to:x(Ct,i)}}function tr(e,t,n){function d(){var e=yt.firstChild,t=!1;return Ct.iter($t,Jt,function(n){if(!n.hidden){var r=Math.round(e.offsetHeight/c)||1;n.height!=r&&(an(n,r),Wt=t=!0)}e=e.nextSibling}),t}if(!K.clientWidth){$t=Jt=Vt=0;return}var r=er(n);if(e!==!0&&e.length==0&&r.from>$t&&r.to<Jt){Pn(n);return}var i=Math.max(r.from-100,0),o=Math.min(Ct.size,r.to+100);$t<i&&i-$t<20&&(i=$t),Jt>o&&Jt-o<20&&(o=Math.min(Ct.size,Jt));var u=e===!0?[]:nr([{from:$t,to:Jt,domStart:0}],e),a=0;for(var f=0;f<u.length;++f){var l=u[f];l.from<i&&(l.domStart+=i-l.from,l.from=i),l.to>o&&(l.to=o),l.from>=l.to?u.splice(f--,1):a+=l.to-l.from}if(a==o-i&&i==$t&&o==Jt){Pn(n);return}u.sort(function(e,t){return e.domStart-t.domStart});var c=Jr(),h=st.style.display;yt.style.display="none",rr(i,o,u),yt.style.display=st.style.display="";var p=i!=$t||o!=Jt||Kt!=K.clientHeight+c;p&&(Kt=K.clientHeight+c),$t=i,Jt=o,Vt=T(Ct,i);if(yt.childNodes.length!=Jt-$t)throw new Error("BAD PATCH! "+JSON.stringify(u)+" size="+(Jt-$t)+" nodes="+yt.childNodes.length);if(s.lineWrapping){d();var v=Dn(),m=v?"block":"none";bt.style.display!=m&&(bt.style.display=m,v&&(wt.style.height=v+"px"),d())}return st.style.display=h,(p||Wt)&&ir()&&s.lineWrapping&&d()&&ir(),Pn(n),sr(),!t&&s.onUpdate&&s.onUpdate(on),!0}function nr(e,t){for(var n=0,r=t.length||0;n<r;++n){var i=t[n],s=[],o=i.diff||0;for(var u=0,a=e.length;u<a;++u){var f=e[u];i.to<=f.from&&i.diff?s.push({from:f.from+o,to:f.to+o,domStart:f.domStart}):i.to<=f.from||i.from>=f.to?s.push(f):(i.from>f.from&&s.push({from:f.from,to:i.from,domStart:f.domStart}),i.to<f.to&&s.push({from:i.to+o,to:f.to+o,domStart:f.domStart+(i.to-f.from)}))}e=s}return e}function rr(e,t,n){if(!n.length)yt.innerHTML="";else{function r(e){var t=e.nextSibling;return e.parentNode.removeChild(e),t}var i=0,s=yt.firstChild,o;for(var u=0;u<n.length;++u){var a=n[u];while(a.domStart>i)s=r(s),i++;for(var f=0,l=a.to-a.from;f<l;++f)s=s.nextSibling,i++}while(s)s=r(s)}var c=n.shift(),s=yt.firstChild,f=e,h=document.createElement("div");Ct.iter(e,t,function(e){c&&c.to==f&&(c=n.shift());if(!c||c.from>f){if(e.hidden)var t=h.innerHTML="<pre></pre>";else{var t="<pre"+(e.className?' class="'+e.className+'"':"")+">"+e.getHTML(Nr)+"</pre>";e.bgClassName&&(t='<div style="position: relative"><pre class="'+e.bgClassName+'" style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: -2">&#160;</pre>'+t+"</div>")}h.innerHTML=t,yt.insertBefore(h.firstChild,s)}else s=s.nextSibling;++f})}function ir(){if(!s.gutter&&!s.lineNumbers)return;var e=Y.offsetHeight,t=K.clientHeight;st.style.height=(e-t<2?t:e)+"px";var n=[],r=$t,i;Ct.iter($t,Math.max(Jt,$t+1),function(e){if(e.hidden)n.push("<pre></pre>");else{var t=e.gutterMarker,o=s.lineNumbers?s.lineNumberFormatter(r+s.firstLineNumber):null;t&&t.text?o=t.text.replace("%N%",o!=null?o:""):o==null&&(o=" "),n.push(t&&t.style?'<pre class="'+t.style+'">':"<pre>",o);for(var u=1;u<e.height;++u)n.push("<br/>&#160;");n.push("</pre>"),t||(i=r)}++r}),st.style.display="none",ot.innerHTML=n.join("");if(i!=null&&s.lineNumbers){var o=ot.childNodes[i-$t],u=String(Ct.size).length,a=et(o.firstChild),f="";while(a.length+f.length<u)f+=" ";f&&o.insertBefore(document.createTextNode(f),o.firstChild)}st.style.display="";var l=Math.abs((parseInt(pt.style.marginLeft)||0)-st.offsetWidth)>2;return pt.style.marginLeft=st.offsetWidth+"px",Wt=!1,l}function sr(){var e=nt(At.from,At.to),t=Ur(At.from,!0),n=e?t:Ur(At.to,!0),r=At.inverted?t:n,i=Jr(),o=Z(C),u=Z(yt);A.style.top=Math.max(0,Math.min(K.offsetHeight,r.y+u.top-o.top))+"px",A.style.left=Math.max(0,Math.min(K.offsetWidth,r.x+u.left-o.left))+"px";if(e)vt.style.top=r.y+"px",vt.style.left=(s.lineWrapping?Math.min(r.x,pt.offsetWidth):r.x)+"px",vt.style.display="",gt.style.display="none";else{var a=t.y==n.y,f="",l=pt.clientWidth||pt.offsetWidth,c=pt.clientHeight||pt.offsetHeight;function h(e,t,n,r){var i=R?"width: "+(n?l-n-e:l)+"px":"right: "+n+"px";f+='<div class="CodeMirror-selected" style="position: absolute; left: '+e+"px; top: "+t+"px; "+i+"; height: "+r+'px"></div>'}if(At.from.ch&&t.y>=0){var p=a?l-n.x:0;h(t.x,t.y,p,i)}var d=Math.max(0,t.y+(At.from.ch?i:0)),v=Math.min(n.y,c)-d;v>.2*i&&h(0,d,0,v),(!a||!At.from.ch)&&n.y<c-.5*i&&h(0,n.y,l-n.x,i),gt.innerHTML=f,vt.style.display="none",gt.style.display=""}}function or(e){e?Ot=Ot||(At.inverted?At.to:At.from):Ot=null}function ur(e,t){var n=Ot&&hr(Ot);n&&(rt(n,e)?e=n:rt(t,n)&&(t=n)),ar(e,t),It=!0}function ar(e,t,n,r){mr=null,n==null&&(n=At.from.line,r=At.to.line);if(nt(At.from,e)&&nt(At.to,t))return;if(rt(t,e)){var i=t;t=e,e=i}if(e.line!=n){var o=fr(e,n,At.from.ch);o?e=o:Br(e.line,!1)}t.line!=r&&(t=fr(t,r,At.to.ch)),nt(e,t)?At.inverted=!1:nt(e,At.to)?At.inverted=!1:nt(t,At.from)&&(At.inverted=!0);if(s.autoClearEmptyLines&&nt(At.from,At.to)){var u=At.inverted?e:t;if(u.line!=At.from.line&&At.from.line<Ct.size){var a=un(At.from.line);/^\s+$/.test(a.text)&&setTimeout(pi(function(){if(a.parent&&/^\s+$/.test(a.text)){var e=S(a);jn("",{line:e,ch:0},{line:e,ch:a.text.length})}},10))}}At.from=e,At.to=t,Ut=!0}function fr(e,t,n){function r(t){var r=e.line+t,i=t==1?Ct.size:-1;while(r!=i){var o=un(r);if(!o.hidden){var u=e.ch;if(s||u>n||u>o.text.length)u=o.text.length;return{line:r,ch:u}}r+=t}}var i=un(e.line),s=e.ch==i.text.length&&e.ch!=n;return i.hidden?e.line>=t?r(1)||r(-1):r(-1)||r(1):e}function lr(e,t,n){var r=hr({line:e,ch:t||0});(n?ur:ar)(r,r)}function cr(e){return Math.max(0,Math.min(e,Ct.size-1))}function hr(e){if(e.line<0)return{line:0,ch:0};if(e.line>=Ct.size)return{line:Ct.size-1,ch:un(Ct.size-1).text.length};var t=e.ch,n=un(e.line).text.length;return t==null||t>n?{line:e.line,ch:n}:t<0?{line:e.line,ch:0}:e}function pr(e,t){function o(){for(var t=r+e,n=e<0?-1:Ct.size;t!=n;t+=e){var i=un(t);if(!i.hidden)return r=t,s=i,!0}}function u(t){if(i==(e<0?0:s.text.length)){if(!!t||!o())return!1;i=e<0?s.text.length:0}else i+=e;return!0}var n=At.inverted?At.from:At.to,r=n.line,i=n.ch,s=un(r);if(t=="char")u();else if(t=="column")u(!0);else if(t=="word"){var a=!1;for(;;){if(e<0&&!u())break;if(ft(s.text.charAt(i)))a=!0;else if(a){e<0&&(e=1,u());break}if(e>0&&!u())break}}return{line:r,ch:i}}function dr(e,t){var n=e<0?At.from:At.to;if(Ot||nt(At.from,At.to))n=pr(e,t);lr(n.line,n.ch,!0)}function vr(e,t){nt(At.from,At.to)?e<0?jn("",pr(e,t),At.to):jn("",At.from,pr(e,t)):jn("",At.from,At.to),It=!0}function gr(e,t){var n=0,r=Ur(At.inverted?At.from:At.to,!0);mr!=null&&(r.x=mr),t=="page"?n=Math.min(K.clientHeight,window.innerHeight||document.documentElement.clientHeight):t=="line"&&(n=Jr());var i=zr(r.x,r.y+n*e+2);t=="page"&&(bt.scrollTop+=Ur(i,!0).y-r.y),lr(i.line,i.ch,!0),mr=r.x}function yr(e){var t=un(e.line).text,n=e.ch,r=e.ch,i=ft(t.charAt(n<t.length?n:n-1))?ft:function(e){return!ft(e)};while(n>0&&i(t.charAt(n-1)))--n;while(r<t.length&&i(t.charAt(r)))++r;return{from:{line:e.line,ch:n},to:{line:e.line,ch:r}}}function br(e){ur({line:e,ch:0},hr({line:e+1,ch:0}))}function wr(e){if(nt(At.from,At.to))return Er(At.from.line,e);var t=At.to.line-(At.to.ch?0:1);for(var n=At.from.line;n<=t;++n)Er(n,e)}function Er(e,t){t||(t="add");if(t=="smart")if(!Nt.indent)t="prev";else var n=oi(e);var r=un(e),i=r.indentation(s.tabSize),o=r.text.match(/^\s*/)[0],u;t=="smart"&&(u=Nt.indent(n,r.text.slice(o.length),r.text),u==B&&(t="prev")),t=="prev"?e?u=un(e-1).indentation(s.tabSize):u=0:t=="add"?u=i+s.indentUnit:t=="subtract"&&(u=i-s.indentUnit),u=Math.max(0,u);var a=u-i,f="",l=0;if(s.indentWithTabs)for(var c=Math.floor(u/s.tabSize);c;--c)l+=s.tabSize,f+="	";while(l<u)++l,f+=" ";jn(f,{line:e,ch:0},{line:e,ch:o.length})}function Sr(){Nt=e.getMode(s,s.mode),Ct.iter(0,Ct.size,function(e){e.stateAfter=null}),kt=[0],fi()}function xr(){var e=s.gutter||s.lineNumbers;st.style.display=e?"":"none",e?Wt=!0:yt.parentNode.style.marginLeft=0}function Tr(e,t){if(s.lineWrapping){C.className+=" CodeMirror-wrap";var n=K.clientWidth/Gr()-3;Ct.iter(0,Ct.size,function(e){if(e.hidden)return;var t=Math.ceil(e.text.length/n)||1;t!=1&&an(e,t)}),pt.style.width=G.style.width="",mt.style.left=""}else C.className=C.className.replace(" CodeMirror-wrap",""),Gt="",Zt=!0,Ct.iter(0,Ct.size,function(e){e.height!=1&&!e.hidden&&an(e,1),e.text.length>Gt.length&&(Gt=e.text)});qt.push({from:0,to:Ct.size})}function Nr(e){var t=s.tabSize-e%s.tabSize,n=en[t];if(n)return n;for(var r='<span class="cm-tab">',i=0;i<t;++i)r+=" ";return en[t]={html:r+"</span>",width:t}}function Cr(){K.className=K.className.replace(/\s*cm-s-\S+/g,"")+s.theme.replace(/(^|\s)\s*/g," cm-s-")}function kr(){var e=a[s.keyMap].style;C.className=C.className.replace(/\s*cm-keymap-\S+/g,"")+(e?" cm-keymap-"+e:"")}function Lr(){this.set=[]}function Ar(e,t,n){function i(e,t,n,i){un(e).addMark(new v(t,n,i,r))}e=hr(e),t=hr(t);var r=new Lr;if(!rt(e,t))return r;if(e.line==t.line)i(e.line,e.ch,t.ch,n);else{i(e.line,e.ch,null,n);for(var s=e.line+1,o=t.line;s<o;++s)i(s,null,null,n);i(t.line,null,t.ch,n)}return qt.push({from:e.line,to:t.line+1}),r}function Or(e){e=hr(e);var t=new m(e.ch);return un(e.line).addMark(t),t}function Mr(e){e=hr(e);var t=[],n=un(e.line).marked;if(!n)return t;for(var r=0,i=n.length;r<i;++r){var s=n[r];(s.from==null||s.from<=e.ch)&&(s.to==null||s.to>=e.ch)&&t.push(s.marker||s)}return t}function _r(e,t,n){return typeof e=="number"&&(e=un(cr(e))),e.gutterMarker={text:t,style:n},Wt=!0,e}function Dr(e){typeof e=="number"&&(e=un(cr(e))),e.gutterMarker=null,Wt=!0}function Pr(e,t){var n=e,r=e;return typeof e=="number"?r=un(cr(e)):n=S(e),n==null?null:t(r,n)?(qt.push({from:n,to:n+1}),r):null}function Hr(e,t,n){return Pr(e,function(e){if(e.className!=t||e.bgClassName!=n)return e.className=t,e.bgClassName=n,!0})}function Br(e,t){return Pr(e,function(e,n){if(e.hidden!=t){e.hidden=t;if(!s.lineWrapping){var r=e.text;t&&r.length==Gt.length?Yt=!0:!t&&r.length>Gt.length&&(Gt=r,Yt=!1)}an(e,t?0:1);var i=At.from.line,o=At.to.line;if(t&&(i==n||o==n)){var u=i==n?fr({line:i,ch:0},i,0):At.from,a=o==n?fr({line:o,ch:0},o,0):At.to;if(!a)return;ar(u,a)}return Wt=!0}})}function jr(e){if(typeof e=="number"){if(!sn(e))return null;var t=e;e=un(e);if(!e)return null}else{var t=S(e);if(t==null)return null}var n=e.gutterMarker;return{line:t,handle:e,text:e.text,markerText:n&&n.text,markerClass:n&&n.style,lineClass:e.className,bgClass:e.bgClassName}}function Fr(e){return dt.innerHTML="<pre><span>x</span></pre>",dt.firstChild.firstChild.firstChild.nodeValue=e,dt.firstChild.firstChild.offsetWidth||10}function Ir(e,t){function i(e){return Rr(n,e).left}if(t<=0)return 0;var n=un(e),r=n.text,s=0,o=0,u=r.length,a,f=Math.min(u,Math.ceil(t/Gr()));for(;;){var l=i(f);if(!(l<=t&&f<u)){a=l,u=f;break}f=Math.min(u,Math.ceil(f*1.2))}if(t>a)return u;f=Math.floor(u*.8),l=i(f),l<t&&(s=f,o=l);for(;;){if(u-s<=1)return a-t>t-o?s:u;var c=Math.ceil((s+u)/2),h=i(c);h>t?(u=c,a=h):(s=c,o=h)}}function Rr(e,t){if(t==0)return{top:0,left:0};var n=s.lineWrapping&&t<e.text.length&&Q.test(e.text.slice(t-1,t+1));dt.innerHTML="<pre>"+e.getHTML(Nr,t,qr,n)+"</pre>";var r=document.getElementById(qr),i=r.offsetTop,o=r.offsetLeft;if(F&&i==0&&o==0){var u=document.createElement("span");u.innerHTML="x",r.parentNode.insertBefore(u,r.nextSibling),i=u.offsetTop}return{top:i,left:o}}function Ur(e,t){var n,r=Jr(),i=r*(T(Ct,e.line)-(t?Vt:0));if(e.ch==0)n=0;else{var o=Rr(un(e.line),e.ch);n=o.left,s.lineWrapping&&(i+=Math.max(0,o.top))}return{x:n,y:i,yBot:i+r}}function zr(e,t){function c(e){var t=Rr(u,e);if(f){var r=Math.round(t.top/n);return Math.max(0,t.left+(r-l)*K.clientWidth)}return t.left}t<0&&(t=0);var n=Jr(),r=Gr(),i=Vt+Math.floor(t/n),o=x(Ct,i);if(o>=Ct.size)return{line:Ct.size-1,ch:un(Ct.size-1).text.length};var u=un(o),a=u.text,f=s.lineWrapping,l=f?i-T(Ct,o):0;if(e<=0&&l==0)return{line:o,ch:0};var h=0,p=0,d=a.length,v,m=Math.min(d,Math.ceil((e+l*K.clientWidth*.9)/r));for(;;){var g=c(m);if(!(g<=e&&m<d)){v=g,d=m;break}m=Math.min(d,Math.ceil(m*1.2))}if(e>v)return{line:o,ch:d};m=Math.floor(d*.8),g=c(m),g<e&&(h=m,p=g);for(;;){if(d-h<=1)return{line:o,ch:v-e>e-p?h:d};var y=Math.ceil((h+d)/2),b=c(y);b>e?(d=y,v=b):(h=y,p=b)}}function Wr(e){var t=Ur(e,!0),n=Z(pt);return{x:n.left+t.x,y:n.top+t.y,yBot:n.top+t.yBot}}function Jr(){if($r==null){$r="<pre>";for(var e=0;e<49;++e)$r+="x<br/>";$r+="x</pre>"}var t=yt.clientHeight;return t==Vr?Xr:(Vr=t,dt.innerHTML=$r,Xr=dt.firstChild.offsetHeight/50||1,dt.innerHTML="",Xr)}function Gr(){return K.clientWidth==Qr?Kr:(Qr=K.clientWidth,Kr=Fr("x"))}function Yr(){return pt.offsetTop}function Zr(){return pt.offsetLeft}function ei(e,t){var n=Z(K,!0),r,i;try{r=e.clientX,i=e.clientY}catch(e){return null}if(!t&&(r-n.left>K.clientWidth||i-n.top>K.clientHeight))return null;var s=Z(pt,!0);return zr(r-s.left,i-s.top)}function ti(e){function o(){var e=lt(X.value).join("\n");e!=i&&!s.readOnly&&pi(Fn)(e,"end"),A.style.position="relative",X.style.cssText=r,q&&(bt.scrollTop=n),zt=!1,$n(!0),zn()}var t=ei(e),n=bt.scrollTop;if(!t||W)return;(nt(At.from,At.to)||rt(t,At.from)||!rt(t,At.to))&&pi(lr)(t.line,t.ch);var r=X.style.cssText;A.style.position="absolute",X.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; "+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",zt=!0;var i=X.value=Rn();Jn(),tt(X);if(j){O(e);var u=P(window,"mouseup",function(){u(),setTimeout(o,20)},!0)}else setTimeout(o,50)}function ni(){clearInterval(Tt);var e=!0;vt.style.visibility="",Tt=setInterval(function(){vt.style.visibility=(e=!e)?"":"hidden"},650)}function ii(e){function v(e,t,n){if(!e.text)return;var r=e.styles,i=o?0:e.text.length-1,s;for(var a=o?0:r.length-2,f=o?r.length:-2;a!=f;a+=2*u){var l=r[a];if(r[a+1]!=h){i+=u*l.length;continue}for(var c=o?0:l.length-1,v=o?l.length:-1;c!=v;c+=u,i+=u)if(i>=t&&i<n&&d.test(s=l.charAt(c))){var m=ri[s];if(m.charAt(1)==">"==o)p.push(s);else{if(p.pop()!=m.charAt(0))return{pos:i,match:!1};if(!p.length)return{pos:i,match:!0}}}}}var t=At.inverted?At.from:At.to,n=un(t.line),r=t.ch-1,i=r>=0&&ri[n.text.charAt(r)]||ri[n.text.charAt(++r)];if(!i)return;var s=i.charAt(0),o=i.charAt(1)==">",u=o?1:-1,a=n.styles;for(var f=r+1,l=0,c=a.length;l<c;l+=2)if((f-=a[l].length)<=0){var h=a[l+1];break}var p=[n.text.charAt(r)],d=/[(){}[\]]/;for(var l=t.line,c=o?Math.min(l+100,Ct.size):Math.max(-1,l-100);l!=c;l+=u){var n=un(l),m=l==t.line,g=v(n,m&&o?r+1:0,m&&!o?r:n.text.length);if(g)break}g||(g={pos:null,match:!1});var h=g.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",y=Ar({line:t.line,ch:r},{line:t.line,ch:r+1},h),b=g.pos!=null&&Ar({line:l,ch:g.pos},{line:l,ch:g.pos+1},h),w=pi(function(){y.clear(),b&&b.clear()});e?setTimeout(w,800):Qt=w}function si(e){var t,n;for(var r=e,i=e-40;r>i;--r){if(r==0)return 0;var o=un(r-1);if(o.stateAfter)return r;var u=o.indentation(s.tabSize);if(n==null||t>u)n=r-1,t=u}return n}function oi(e){var t=si(e),n=t&&un(t-1).stateAfter;return n?n=h(Nt,n):n=p(Nt),Ct.iter(t,e,function(e){e.highlight(Nt,n,s.tabSize),e.stateAfter=h(Nt,n)}),t<e&&qt.push({from:t,to:e}),e<Ct.size&&!un(e).stateAfter&&kt.push(e),n}function ui(e,t){var n=oi(e);Ct.iter(e,t,function(e){e.highlight(Nt,n,s.tabSize),e.stateAfter=h(Nt,n)})}function ai(){var e=+(new Date)+s.workTime,t=kt.length;while(kt.length){if(!un($t).stateAfter)var n=$t;else var n=kt.pop();if(n>=Ct.size)continue;var r=si(n),i=r&&un(r-1).stateAfter;i?i=h(Nt,i):i=p(Nt);var o=0,u=Nt.compareStates,a=!1,f=r,l=!1;Ct.iter(f,Ct.size,function(t){var r=t.stateAfter;if(+(new Date)>e)return kt.push(f),fi(s.workDelay),a&&qt.push({from:n,to:f+1}),l=!0;var c=t.highlight(Nt,i,s.tabSize);c&&(a=!0),t.stateAfter=h(Nt,i);var p=null;if(u){var d=r&&u(r,i);d!=B&&(p=!!d)}p==null&&(c!==!1||!r?o=0:++o>3&&(!Nt.indent||Nt.indent(r,"")==Nt.indent(i,""))&&(p=!0));if(p)return!0;++f});if(l)return;a&&qt.push({from:n,to:f+1})}t&&s.onHighlightComplete&&s.onHighlightComplete(on)}function fi(e){if(!kt.length)return;xt.set(e,pi(ai))}function li(){Ft=It=Rt=null,qt=[],Ut=!1,Xt=[]}function ci(){Yt&&Bn();if(Zt&&!s.lineWrapping){var e=mt.offsetWidth,t=Fr(Gt);mt.style.left=t+"px",pt.style.minWidth=t+e+"px",Zt=!1}var n,r;if(Ut){var i=Gn();n=Zn(i.x,i.y,i.x,i.yBot)}qt.length?r=tr(qt,!0,n?n.scrollTop:null):(Ut&&sr(),Wt&&ir()),n&&Qn(),Ut&&(Kn(),ni()),Lt&&!zt&&(Ft===!0||Ft!==!1&&Ut)&&$n(It),Ut&&s.matchBrackets&&setTimeout(pi(function(){Qt&&(Qt(),Qt=null),nt(At.from,At.to)&&ii(!1)}),20);var o=Ut,u=Xt;Rt&&s.onChange&&on&&s.onChange(on,Rt),o&&s.onCursorActivity&&s.onCursorActivity(on);for(var a=0;a<u.length;++a)u[a](on);r&&s.onUpdate&&s.onUpdate(on)}function pi(e){return function(){hi++||li();try{var t=e.apply(this,arguments)}finally{--hi||ci()}return t}}function di(e){tn.startCompound();try{return e()}finally{tn.endCompound()}}var s={},d=e.defaults;for(var y in d)d.hasOwnProperty(y)&&(s[y]=(i&&i.hasOwnProperty(y)?i:d)[y]);var C=document.createElement("div");C.className="CodeMirror"+(s.lineWrapping?" CodeMirror-wrap":""),C.innerHTML='<div style="overflow: hidden; position: relative; width: 3px; height: 0px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scrollbar"><div class="CodeMirror-scrollbar-inner"></div></div><div class="CodeMirror-scroll" tabindex="-1"><div style="position: relative"><div style="position: relative"><div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div><div class="CodeMirror-lines"><div style="position: relative; z-index: 0"><div style="position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden;"></div><pre class="CodeMirror-cursor">&#160;</pre><pre class="CodeMirror-cursor" style="visibility: hidden">&#160;</pre><div style="position: relative; z-index: -1"></div><div></div></div></div></div></div></div>',r.appendChild?r.appendChild(C):r(C);var A=C.firstChild,X=A.firstChild,K=C.lastChild,G=K.firstChild,Y=G.firstChild,st=Y.firstChild,ot=st.firstChild,pt=st.nextSibling.firstChild,dt=pt.firstChild,vt=dt.nextSibling,mt=vt.nextSibling,gt=mt.nextSibling,yt=gt.nextSibling,bt=A.nextSibling,wt=bt.firstChild;Cr(),kr(),t&&(X.style.width="0px"),U||(K.draggable=!0),pt.style.outline="none",s.tabindex!=null&&(X.tabIndex=s.tabindex),s.autofocus&&Jn(),!s.gutter&&!s.lineNumbers&&(st.style.display="none"),V&&(A.style.height="1px",A.style.position="absolute"),$?bt.className+=Hn()?" cm-sb-overlap":" cm-sb-nonoverlap":I&&(bt.className+=" cm-sb-ie7");try{Fr("x")}catch(Et){throw Et.message.match(/runtime/i)&&(Et=new Error("A CodeMirror inside a P-style element does not work in Internet Explorer. (innerHTML bug)")),Et}var St=new H,xt=new H,Tt,Nt,Ct=new w([new b([new g("")])]),kt,Lt;Sr();var At={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},Ot,Mt,_t,Dt=0,Pt=0,Ht,Bt=!1,jt=!1,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt=0,$t=0,Jt=0,Kt=0,Qt,Gt="",Yt=!1,Zt=!0,en={};pi(function(){fn(s.value||""),Ft=!1})();var tn=new N;P(K,"mousedown",pi(hn)),P(K,"dblclick",pi(pn)),P(pt,"selectstart",L),j||P(K,"contextmenu",ti),P(K,"scroll",cn),P(bt,"scroll",cn),P(bt,"mousedown",function(){Lt&&setTimeout(Jn,0)}),P(K,"mousewheel",kn),P(K,"DOMMouseScroll",kn),P(window,"resize",function(){tr(!0)}),P(X,"keyup",pi(xn)),P(X,"input",Wn),P(X,"keydown",pi(En)),P(X,"keypress",pi(Sn)),P(X,"focus",Tn),P(X,"blur",Nn);if(s.dragDrop){P(K,"dragstart",vn);function nn(e){if(s.onDragEvent&&s.onDragEvent(on,k(e)))return;O(e)}P(K,"dragenter",nn),P(K,"dragover",nn),P(K,"drop",pi(dn))}P(K,"paste",function(){Jn(),Wn()}),P(X,"paste",Wn),P(X,"cut",pi(function(){s.readOnly||Fn("")})),V&&P(G,"mouseup",function(){document.activeElement==X&&X.blur(),Jn()});var rn;try{rn=document.activeElement==X}catch(Et){}rn||s.autofocus?setTimeout(Tn,20):Nn();var on=C.CodeMirror={getValue:ln,setValue:pi(fn),getSelection:Rn,replaceSelection:pi(Fn),focus:function(){window.focus(),Jn(),Tn(),Wn()},setOption:function(e,t){var n=s[e];s[e]=t,e=="mode"||e=="indentUnit"?Sr():e=="readOnly"&&t=="nocursor"?(Nn(),X.blur()):e=="readOnly"&&!t?$n(!0):e=="theme"?Cr():e=="lineWrapping"&&n!=t?pi(Tr)():e=="tabSize"?tr(!0):e=="keyMap"&&kr();if(e=="lineNumbers"||e=="gutter"||e=="firstLineNumber"||e=="theme")xr(),tr(!0)},getOption:function(e){return s[e]},undo:pi(On),redo:pi(Mn),indentLine:pi(function(e,t){typeof t!="string"&&(t==null?t=s.smartIndent?"smart":"prev":t=t?"add":"subtract"),sn(e)&&Er(e,t)}),indentSelection:pi(wr),historySize:function(){return{undo:tn.done.length,redo:tn.undone.length}},clearHistory:function(){tn=new N},setHistory:function(e){tn=new N,tn.done=e.done,tn.undone=e.undone},getHistory:function(){return tn.time=0,{done:tn.done.concat([]),undone:tn.undone.concat([])}},matchBrackets:pi(function(){ii(!0)}),getTokenAt:pi(function(e){return e=hr(e),un(e.line).getTokenAt(Nt,oi(e.line),e.ch)}),getStateAfter:function(e){return e=cr(e==null?Ct.size-1:e),oi(e+1)},cursorCoords:function(e,t){return e==null&&(e=At.inverted),this.charCoords(e?At.from:At.to,t)},charCoords:function(e,t){return e=hr(e),t=="local"?Ur(e,!1):t=="div"?Ur(e,!0):Wr(e)},coordsChar:function(e){var t=Z(pt);return zr(e.x-t.left,e.y-t.top)},markText:pi(Ar),setBookmark:Or,findMarksAt:Mr,setMarker:pi(_r),clearMarker:pi(Dr),setLineClass:pi(Hr),hideLine:pi(function(e){return Br(e,!0)}),showLine:pi(function(e){return Br(e,!1)}),onDeleteLine:function(e,t){if(typeof e=="number"){if(!sn(e))return null;e=un(e)}return(e.handlers||(e.handlers=[])).push(t),e},lineInfo:jr,addWidget:function(e,t,n,r,i){e=Ur(hr(e));var s=e.yBot,o=e.x;t.style.position="absolute",G.appendChild(t);if(r=="over")s=e.y;else if(r=="near"){var u=Math.max(K.offsetHeight,Ct.height*Jr()),a=Math.max(G.clientWidth,pt.clientWidth)-Zr();e.yBot+t.offsetHeight>u&&e.y>t.offsetHeight&&(s=e.y-t.offsetHeight),o+t.offsetWidth>a&&(o=a-t.offsetWidth)}t.style.top=s+Yr()+"px",t.style.left=t.style.right="",i=="right"?(o=G.clientWidth-t.offsetWidth,t.style.right="0px"):(i=="left"?o=0:i=="middle"&&(o=(G.clientWidth-t.offsetWidth)/2),t.style.left=o+Zr()+"px"),n&&Yn(o,s,o+t.offsetWidth,s+t.offsetHeight)},lineCount:function(){return Ct.size},clipPos:hr,getCursor:function(e){return e==null&&(e=At.inverted),it(e?At.from:At.to)},somethingSelected:function(){return!nt(At.from,At.to)},setCursor:pi(function(e,t,n){t==null&&typeof e.line=="number"?lr(e.line,e.ch,n):lr(e,t,n)}),setSelection:pi(function(e,t,n){(n?ur:ar)(hr(e),hr(t||e))}),getLine:function(e){if(sn(e))return un(e).text},getLineHandle:function(e){if(sn(e))return un(e)},setLine:pi(function(e,t){sn(e)&&jn(t,{line:e,ch:0},{line:e,ch:un(e).text.length})}),removeLine:pi(function(e){sn(e)&&jn("",{line:e,ch:0},hr({line:e+1,ch:0}))}),replaceRange:pi(jn),getRange:function(e,t,n){return qn(hr(e),hr(t),n)},triggerOnKeyDown:pi(En),execCommand:function(e){return u[e](on)},moveH:pi(dr),deleteH:pi(vr),moveV:pi(gr),toggleOverwrite:function(){Bt?(Bt=!1,vt.className=vt.className.replace(" CodeMirror-overwrite","")):(Bt=!0,vt.className+=" CodeMirror-overwrite")},posFromIndex:function(e){var t=0,n;return Ct.iter(0,Ct.size,function(r){var i=r.text.length+1;if(i>e)return n=e,!0;e-=i,++t}),hr({line:t,ch:n})},indexFromPos:function(e){if(e.line<0||e.ch<0)return 0;var t=e.ch;return Ct.iter(0,e.line,function(e){t+=e.text.length+1}),t},scrollTo:function(e,t){e!=null&&(K.scrollLeft=e),t!=null&&(bt.scrollTop=t),tr([])},getScrollInfo:function(){return{x:K.scrollLeft,y:bt.scrollTop,height:bt.scrollHeight,width:K.scrollWidth}},setSize:function(e,t){function n(e){return e=String(e),/^\d+$/.test(e)?e+"px":e}e!=null&&(C.style.width=n(e)),t!=null&&(K.style.height=n(t))},operation:function(e){return pi(e)()},compoundChange:function(e){return di(e)},refresh:function(){tr(!0,null,Dt),bt.scrollHeight>Dt&&(bt.scrollTop=Dt)},getInputField:function(){return X},getWrapperElement:function(){return C},getScrollerElement:function(){return K},getGutterElement:function(){return st}},bn=null,wn,Un=!1,Xn="",mr=null;Lr.prototype.clear=pi(function(){var e=Infinity,t=-Infinity;for(var n=0,r=this.set.length;n<r;++n){var i=this.set[n],s=i.marked;if(!s||!i.parent)continue;var o=S(i);e=Math.min(e,o),t=Math.max(t,o);for(var u=0;u<s.length;++u)s[u].marker==this&&s.splice(u--,1)}e!=Infinity&&qt.push({from:e,to:t+1})}),Lr.prototype.find=function(){var e,t;for(var n=0,r=this.set.length;n<r;++n){var i=this.set[n],s=i.marked;for(var o=0;o<s.length;++o){var u=s[o];if(u.marker==this)if(u.from!=null||u.to!=null){var a=S(i);a!=null&&(u.from!=null&&(e={line:a,ch:u.from}),u.to!=null&&(t={line:a,ch:u.to}))}}}return{from:e,to:t}};var qr="CodeMirror-temp-"+Math.floor(Math.random()*16777215).toString(16),Xr,Vr,$r,Kr,Qr=0,ri={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},hi=0;for(var vi in o)o.propertyIsEnumerable(vi)&&!on.propertyIsEnumerable(vi)&&(on[vi]=o[vi]);return on}function f(e){return typeof e=="string"?a[e]:e}function l(e,t,n,r,i){function s(t){t=f(t);var n=t[e];if(n!=null&&r(n))return!0;if(t.nofallthrough)return i&&i(),!0;var o=t.fallthrough;if(o==null)return!1;if(Object.prototype.toString.call(o)!="[object Array]")return s(o);for(var u=0,a=o.length;u<a;++u)if(s(o[u]))return!0;return!1}return t&&s(t)?!0:s(n)}function c(e){var t=ht[D(e,"keyCode")];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function h(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var i=t[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function p(e,t,n){return e.startState?e.startState(t,n):!0}function d(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function v(e,t,n,r){this.from=e,this.to=t,this.style=n,this.marker=r}function m(e){this.from=e,this.to=e,this.line=null}function g(e,t){this.styles=t||[e,null],this.text=e,this.height=1,this.marked=this.gutterMarker=this.className=this.bgClassName=this.handlers=null,this.stateAfter=this.parent=this.hidden=null}function y(e,t,n,r){for(var i=0,s=0,o=0;s<t;i+=2){var u=n[i],a=s+u.length;o==0?(a>e&&r.push(u.slice(e-s,Math.min(u.length,t-s)),n[i+1]),a>=e&&(o=1)):o==1&&(a>t?r.push(u.slice(0,t-s),n[i+1]):r.push(u,n[i+1])),s=a}}function b(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;t<n;++t)e[t].parent=this,r+=e[t].height;this.height=r}function w(e){this.children=e;var t=0,n=0;for(var r=0,i=e.length;r<i;++r){var s=e[r];t+=s.chunkSize(),n+=s.height,s.parent=this}this.size=t,this.height=n,this.parent=null}function E(e,t){while(!e.lines)for(var n=0;;++n){var r=e.children[n],i=r.chunkSize();if(t<i){e=r;break}t-=i}return e.lines[t]}function S(e){if(e.parent==null)return null;var t=e.parent,n=at(t.lines,e);for(var r=t.parent;r;t=r,r=r.parent)for(var i=0,s=r.children.length;;++i){if(r.children[i]==t)break;n+=r.children[i].chunkSize()}return n}function x(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.height;if(t<o){e=s;continue e}t-=o,n+=s.chunkSize()}return n}while(!e.lines);for(var r=0,i=e.lines.length;r<i;++r){var u=e.lines[r],a=u.height;if(t<a)break;t-=a}return n+r}function T(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.chunkSize();if(t<o){e=s;continue e}t-=o,n+=s.height}return n}while(!e.lines);for(var r=0;r<t;++r)n+=e.lines[r].height;return n}function N(){this.time=0,this.done=[],this.undone=[],this.compound=0,this.closed=!1}function C(){O(this)}function k(e){return e.stop||(e.stop=C),e}function L(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function A(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function O(e){L(e),A(e)}function M(e){return e.target||e.srcElement}function _(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),n&&e.ctrlKey&&t==1&&(t=3),t}function D(e,t){var n=e.override&&e.override.hasOwnProperty(t);return n?e.override[t]:e[t]}function P(e,t,n,r){if(typeof e.addEventListener=="function"){e.addEventListener(t,n,!1);if(r)return function(){e.removeEventListener(t,n,!1)}}else{var i=function(e){n(e||window.event)};e.attachEvent("on"+t,i);if(r)return function(){e.detachEvent("on"+t,i)}}}function H(){this.id=null}function G(e,t,n){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var r=0,i=0;r<t;++r)e.charAt(r)=="	"?i+=n-i%n:++i;return i}function Y(e){return e.currentStyle?e.currentStyle:window.getComputedStyle(e,null)}function Z(e,t){try{var n=e.getBoundingClientRect();n={top:n.top,left:n.left}}catch(r){n={top:0,left:0}}if(!t)if(window.pageYOffset==null){var i=document.documentElement||document.body.parentNode;i.scrollTop==null&&(i=document.body),n.top+=i.scrollTop,n.left+=i.scrollLeft}else n.top+=window.pageYOffset,n.left+=window.pageXOffset;return n}function et(e){return e.textContent||e.innerText||e.nodeValue||""}function tt(e){t?(e.selectionStart=0,e.selectionEnd=e.value.length):e.select()}function nt(e,t){return e.line==t.line&&e.ch==t.ch}function rt(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function it(e){return{line:e.line,ch:e.ch}}function ot(e){return st.textContent=e,st.innerHTML}function ut(e,t){if(!t)return 0;if(!e)return t.length;for(var n=e.length,r=t.length;n>=0&&r>=0;--n,--r)if(e.charAt(n)!=t.charAt(r))break;return r+1}function at(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}function ft(e){return/\w/.test(e)||e.toUpperCase()!=e.toLowerCase()}e.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,smartIndent:!0,tabSize:4,keyMap:"default",extraKeys:null,electricChars:!0,autoClearEmptyLines:!1,onKeyEvent:null,onDragEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,dragDrop:!0,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onUpdate:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,workTime:100,workDelay:200,pollInterval:100,undoDepth:40,tabindex:null,autofocus:null,lineNumberFormatter:function(e){return e}};var t=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),n=t||/Mac/.test(navigator.platform),r=/Win/.test(navigator.platform),i=e.modes={},s=e.mimeModes={};e.defineMode=function(t,n){!e.defaults.mode&&t!="null"&&(e.defaults.mode=t);if(arguments.length>2){n.dependencies=[];for(var r=2;r<arguments.length;++r)n.dependencies.push(arguments[r])}i[t]=n},e.defineMIME=function(e,t){s[e]=t},e.resolveMode=function(t){if(typeof t=="string"&&s.hasOwnProperty(t))t=s[t];else if(typeof t=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return typeof t=="string"?{name:t}:t||{name:"null"}},e.getMode=function(t,n){var n=e.resolveMode(n),r=i[n.name];return r?r(t,n):e.getMode(t,"text/plain")},e.listModes=function(){var e=[];for(var t in i)i.propertyIsEnumerable(t)&&e.push(t);return e},e.listMIMEs=function(){var e=[];for(var t in s)s.propertyIsEnumerable(t)&&e.push({mime:t,mode:s[t]});return e};var o=e.extensions={};e.defineExtension=function(e,t){o[e]=t};var u=e.commands={selectAll:function(e){e.setSelection({line:0,ch:0},{line:e.lineCount()-1})},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!nt(t,n);!r&&e.getLine(t.line).length==t.ch?e.replaceRange("",t,{line:t.line+1,ch:0}):e.replaceRange("",t,r?n:{line:t.line})},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",{line:t,ch:0},{line:t})},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.setCursor(0,0,!0)},goDocEnd:function(e){e.setSelection({line:e.lineCount()-1},null,!0)},goLineStart:function(e){e.setCursor(e.getCursor().line,0,!0)},goLineStartSmart:function(e){var t=e.getCursor(),n=e.getLine(t.line),r=Math.max(0,n.search(/\S/));e.setCursor(t.line,t.ch<=r&&t.ch?0:r,!0)},goLineEnd:function(e){e.setSelection({line:e.getCursor().line},null,!0)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharLeft:function(e){e.deleteH(-1,"char")},delCharRight:function(e){e.deleteH(1,"char")},delWordLeft:function(e){e.deleteH(-1,"word")},delWordRight:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),{line:t.line,ch:t.ch-1},{line:t.line,ch:t.ch+1})},newlineAndIndent:function(e){e.replaceSelection("\n","end"),e.indentLine(e.getCursor().line)},toggleOverwrite:function(e){e.toggleOverwrite()}},a=e.keyMap={};a.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharRight",Backspace:"delCharLeft",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},a.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordLeft","Ctrl-Delete":"delWordRight","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},a.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordLeft","Ctrl-Alt-Backspace":"delWordRight","Alt-Delete":"delWordRight","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},a["default"]=n?a.macDefault:a.pcDefault,a.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageUp","Shift-Ctrl-V":"goPageDown","Ctrl-D":"delCharRight","Ctrl-H":"delCharLeft","Alt-D":"delWordRight","Alt-Backspace":"delWordLeft","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},e.fromTextArea=function(t,n){function r(){t.value=u.getValue()}n||(n={}),n.value=t.value,!n.tabindex&&t.tabindex&&(n.tabindex=t.tabindex),n.autofocus==null&&t.getAttribute("autofocus")!=null&&(n.autofocus=!0);if(t.form){var i=P(t.form,"submit",r,!0);if(typeof t.form.submit=="function"){var s=t.form.submit;function o(){r(),t.form.submit=s,t.form.submit(),t.form.submit=o}t.form.submit=o}}t.style.display="none";var u=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},n);return u.save=r,u.getTextArea=function(){return t},u.toTextArea=function(){r(),t.parentNode.removeChild(u.getWrapperElement()),t.style.display="",t.form&&(i(),typeof t.form.submit=="function"&&(t.form.submit=s))},u},e.copyState=h,e.startState=p,d.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var n=t==e;else var n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){var t=this.pos;while(this.eat(e));return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return G(this.string,this.start,this.tabSize)},indentation:function(){return G(this.string,null,this.tabSize)},match:function(e,t,n){if(typeof e!="string"){var i=this.string.slice(this.pos).match(e);return i&&t!==!1&&(this.pos+=i[0].length),i}function r(e){return n?e.toLowerCase():e}if(r(this.string).indexOf(r(e),this.pos)==this.pos)return t!==!1&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},e.StringStream=d,v.prototype={attach:function(e){this.marker.set.push(e)},detach:function(e){var t=at(this.marker.set,e);t>-1&&this.marker.set.splice(t,1)},split:function(e,t){if(this.to<=e&&this.to!=null)return null;var n=this.from<e||this.from==null?null:this.from-e+t,r=this.to==null?null:this.to-e+t;return new v(n,r,this.style,this.marker)},dup:function(){return new v(null,null,this.style,this.marker)},clipTo:function(e,t,n,r,i){e&&r>this.from&&(r<this.to||this.to==null)?this.from=null:this.from!=null&&this.from>=t&&(this.from=Math.max(r,this.from)+i),n&&(t<this.to||this.to==null)&&(t>this.from||this.from==null)?this.to=null:this.to!=null&&this.to>t&&(this.to=r<this.to?this.to+i:t)},isDead:function(){return this.from!=null&&this.to!=null&&this.from>=this.to},sameSet:function(e){return this.marker==e.marker}},m.prototype={attach:function(e){this.line=e},detach:function(e){this.line==e&&(this.line=null)},split:function(e,t){if(e<this.from)return this.from=this.to=this.from-e+t,this},isDead:function(){return this.from>this.to},clipTo:function(e,t,n,r,i){(e||t<this.from)&&(n||r>this.to)?(this.from=0,this.to=-1):this.from>t&&(this.from=this.to=Math.max(r,this.from)+i)},sameSet:function(e){return!1},find:function(){return!this.line||!this.line.parent?null:{line:S(this.line),ch:this.from}},clear:function(){if(this.line){var e=at(this.line.marked,this);e!=-1&&this.line.marked.splice(e,1),this.line=null}}},g.inheritMarks=function(e,t){var n=new g(e),r=t&&t.marked;if(r)for(var i=0;i<r.length;++i)if(r[i].to==null&&r[i].style){var s=n.marked||(n.marked=[]),o=r[i],u=o.dup();s.push(u),u.attach(n)}return n},g.prototype={replace:function(e,t,n){var r=[],i=this.marked,s=t==null?this.text.length:t;y(0,e,this.styles,r),n&&r.push(n,null),y(s,this.text.length,this.styles,r),this.styles=r,this.text=this.text.slice(0,e)+n+this.text.slice(s),this.stateAfter=null;if(i){var o=n.length-(s-e);for(var u=0;u<i.length;++u){var a=i[u];a.clipTo(e==null,e||0,t==null,s,o),a.isDead()&&(a.detach(this),i.splice(u--,1))}}},split:function(e,t){var n=[t,null],r=this.marked;y(e,this.text.length,this.styles,n);var i=new g(t+this.text.slice(e),n);if(r)for(var s=0;s<r.length;++s){var o=r[s],u=o.split(e,t.length);u&&(i.marked||(i.marked=[]),i.marked.push(u),u.attach(i),u==o&&r.splice(s--,1))}return i},append:function(e){var t=this.text.length,n=e.marked,r=this.marked;this.text+=e.text,y(0,e.text.length,e.styles,this.styles);if(r)for(var i=0;i<r.length;++i)r[i].to==null&&(r[i].to=t);if(n&&n.length){r||(this.marked=r=[]);e:for(var i=0;i<n.length;++i){var s=n[i];if(!s.from)for(var o=0;o<r.length;++o){var u=r[o];if(u.to==t&&u.sameSet(s)){u.to=s.to==null?null:s.to+t,u.isDead()&&(u.detach(this),n.splice(i--,1));continue e}}r.push(s),s.attach(this),s.from+=t,s.to!=null&&(s.to+=t)}}},fixMarkEnds:function(e){var t=this.marked,n=e.marked;if(!t)return;e:for(var r=0;r<t.length;++r){var i=t[r],s=i.to==null;if(s&&n)for(var o=0;o<n.length;++o){var u=n[o];if(!u.sameSet(i)||u.from!=null)continue;if(i.from==this.text.length&&u.to==0){n.splice(o,1),t.splice(r--,1);continue e}s=!1;break}s&&(i.to=this.text.length)}},fixMarkStarts:function(){var e=this.marked;if(!e)return;for(var t=0;t<e.length;++t)e[t].from==null&&(e[t].from=0)},addMark:function(e){e.attach(this),this.marked==null&&(this.marked=[]),this.marked.push(e),this.marked.sort(function(e,t){return(e.from||0)-(t.from||0)})},highlight:function(e,t,n){var r=new d(this.text,n),i=this.styles,s=0,o=!1,u=i[0],a;this.text==""&&e.blankLine&&e.blankLine(t);while(!r.eol()){var f=e.token(r,t),l=this.text.slice(r.start,r.pos);r.start=r.pos,s&&i[s-1]==f?i[s-2]+=l:l&&(!o&&(i[s+1]!=f||s&&i[s-2]!=a)&&(o=!0),i[s++]=l,i[s++]=f,a=u,u=i[s]);if(r.pos>5e3){i[s++]=this.text.slice(r.pos),i[s++]=null;break}}return i.length!=s&&(i.length=s,o=!0),s&&i[s-2]!=a&&(o=!0),o||(i.length<5&&this.text.length<10?null:!1)},getTokenAt:function(e,t,n){var r=this.text,i=new d(r);while(i.pos<n&&!i.eol()){i.start=i.pos;var s=e.token(i,t)}return{start:i.start,end:i.pos,string:i.current(),className:s||null,state:t}},indentation:function(e){return G(this.text,null,e)},getHTML:function(e,t,n,r){function u(t,n){if(!t)return;s&&F&&t.charAt(0)==" "&&(t=" "+t.slice(1)),s=!1;if(t.indexOf("	")==-1){o+=t.length;var r=ot(t)}else{var r="";for(var u=0;;){var a=t.indexOf("	",u);if(a==-1){r+=ot(t.slice(u)),o+=t.length-u;break}o+=a-u;var f=e(o);r+=ot(t.slice(u,a))+f.html,o+=f.width,u=a+1}}n?i.push('<span class="',n,'">',r,"</span>"):i.push(r)}function v(e){return e?"cm-"+e.replace(/ +/g," cm-"):null}var i=[],s=!0,o=0,a=u;if(t!=null){var f=0,l='<span id="'+n+'">';a=function(e,n){var s=e.length;if(t>=f&&t<f+s){t>f&&(u(e.slice(0,t-f),n),r&&i.push("<wbr>")),i.push(l);var o=t-f;u(W?e.slice(o,o+1):e.slice(o),n),i.push("</span>"),W&&u(e.slice(o+1),n),t--,f+=s}else f+=s,u(e,n),f==t&&f==d?i.push(l+(j||F&&!I?"&#x200b;":" ")+"</span>"):f>t+10&&/\s/.test(e)&&(a=function(){})}}var c=this.styles,h=this.text,p=this.marked,d=h.length;if(!h&&t==null)a(" ");else if(!p||!p.length)for(var m=0,g=0;g<d;m+=2){var y=c[m],b=c[m+1],w=y.length;g+w>d&&(y=y.slice(0,d-g)),g+=w,a(y,v(b))}else{var E=0,m=0,S="",b,x=0,T=p[0].from||0,N=[],C=0;function k(){var e;while(C<p.length&&((e=p[C]).from==E||e.from==null))e.style!=null&&N.push(e),++C;T=C<p.length?p[C].from:Infinity;for(var t=0;t<N.length;++t){var n=N[t].to;n==null&&(n=Infinity),n==E?N.splice(t--,1):T=Math.min(n,T)}}var L=0;while(E<d){T==E&&k();var A=Math.min(d,T);for(;;){if(S){var O=E+S.length,M=b;for(var _=0;_<N.length;++_)M=(M?M+" ":"")+N[_].style;a(O>A?S.slice(0,A-E):S,M);if(O>=A){S=S.slice(A-E),E=A;break}E=O}S=c[m++],b=v(c[m++])}}}return i.join("")},cleanUp:function(){this.parent=null;if(this.marked)for(var e=0,t=this.marked.length;e<t;++e)this.marked[e].detach(this)}},b.prototype={chunkSize:function(){return this.lines.length},remove:function(e,t,n){for(var r=e,i=e+t;r<i;++r){var s=this.lines[r];this.height-=s.height,s.cleanUp();if(s.handlers)for(var o=0;o<s.handlers.length;++o)n.push(s.handlers[o])}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertHeight:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,i=t.length;r<i;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},w.prototype={chunkSize:function(){return this.size},remove:function(e,t,n){this.size-=t;for(var r=0;r<this.children.length;++r){var i=this.children[r],s=i.chunkSize();if(e<s){var o=Math.min(t,s-e),u=i.height;i.remove(e,o,n),this.height-=u-i.height,s==o&&(this.children.splice(r--,1),i.parent=null);if((t-=o)==0)break;e=0}else e-=s}if(this.size-t<25){var a=[];this.collapse(a),this.children=[new b(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;t<n;++t)this.children[t].collapse(e)},insert:function(e,t){var n=0;for(var r=0,i=t.length;r<i;++r)n+=t[r].height;this.insertHeight(e,t,n)},insertHeight:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<=o){s.insertHeight(e,t,n);if(s.lines&&s.lines.length>50){while(s.lines.length>50){var u=s.lines.splice(s.lines.length-25,25),a=new b(u);s.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(this.children.length<=10)return;var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new w(t);if(!e.parent){var r=new w(e.children);r.parent=e,e.children=[r,n],e=r}else{e.size-=n.size,e.height-=n.height;var i=at(e.parent.children,e);e.parent.children.splice(i+1,0,n)}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iter:function(e,t,n){this.iterN(e,t-e,n)},iterN:function(e,t,n){for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<o){var u=Math.min(t,o-e);if(s.iterN(e,u,n))return!0;if((t-=u)==0)break;e=0}else e-=o}}},N.prototype={addChange:function(e,t,n){this.undone.length=0;var r=+(new Date),i=this.done[this.done.length-1],s=i&&i[i.length-1],o=r-this.time;if(this.compound&&i&&!this.closed)i.push({start:e,added:t,old:n});else if(o>400||!s||this.closed||s.start>e+n.length||s.start+s.added<e)this.done.push([{start:e,added:t,old:n}]),this.closed=!1;else{var u=Math.max(0,s.start-e),a=Math.max(0,e+n.length-(s.start+s.added));for(var f=u;f>0;--f)s.old.unshift(n[f-1]);for(var f=a;f>0;--f)s.old.push(n[n.length-f]);u&&(s.start=e),s.added+=t-(n.length-u-a)}this.time=r},startCompound:function(){this.compound++||(this.closed=!0)},endCompound:function(){--this.compound||(this.closed=!0)}},e.e_stop=O,e.e_preventDefault=L,e.e_stopPropagation=A,e.connect=P,H.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}};var B=e.Pass={toString:function(){return"CodeMirror.Pass"}},j=/gecko\/\d{7}/i.test(navigator.userAgent),F=/MSIE \d/.test(navigator.userAgent),I=/MSIE [1-7]\b/.test(navigator.userAgent),q=/MSIE [1-8]\b/.test(navigator.userAgent),R=F&&document.documentMode==5,U=/WebKit\//.test(navigator.userAgent),z=/Chrome\//.test(navigator.userAgent),W=/Opera\//.test(navigator.userAgent),X=/Apple Computer/.test(navigator.vendor),V=/KHTML\//.test(navigator.userAgent),$=/Mac OS X 10\D([7-9]|\d\d)\D/.test(navigator.userAgent),J=function(){if(q)return!1;var e=document.createElement("div");return"draggable"in e||"dragDrop"in e}(),K=function(){var e=document.createElement("textarea");return e.value="foo\nbar",e.value.indexOf("\r")>-1?"\r\n":"\n"}(),Q=/^$/;j?Q=/$'/:X?Q=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:z&&(Q=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var st=document.createElement("pre");ot("a")=="\na"?ot=function(e){return st.textContent=e,st.innerHTML.slice(1)}:ot("	")!="	"&&(ot=function(e){return st.innerHTML="",st.appendChild(document.createTextNode(e)),st.innerHTML}),e.htmlEscape=ot;var lt="\n\nb".split(/\n/).length!=3?function(e){var t=0,n=[],r=e.length;while(t<=r){var i=e.indexOf("\n",t);i==-1&&(i=e.length);var s=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),o=s.indexOf("\r");o!=-1?(n.push(s.slice(0,o)),t+=o+1):(n.push(s),t=i+1)}return n}:function(e){return e.split(/\r\n?|\n/)};e.splitLines=lt;var ct=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0};e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var ht={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};return e.keyNames=ht,function(){for(var e=0;e<10;e++)ht[e+48]=String(e);for(var e=65;e<=90;e++)ht[e]=String.fromCharCode(e);for(var e=1;e<=12;e++)ht[e+111]=ht[e+63235]="F"+e}(),e}()
CodeMirror.modeExtensions||(CodeMirror.modeExtensions={}),CodeMirror.defineExtension("getModeExt",function(){var e=CodeMirror.resolveMode(this.getOption("mode")).name,t=CodeMirror.modeExtensions[e];if(!t)throw new Error("No extensions found for mode "+e);return t}),CodeMirror.defineExtension("getModeExtAtPos",function(e){var t=this.getTokenAt(e);return t&&t.state&&t.state.mode?CodeMirror.modeExtensions[t.state.mode=="html"?"htmlmixed":t.state.mode]:this.getModeExt()}),CodeMirror.defineExtension("commentRange",function(e,t,n){var r=this.getModeExtAtPos(this.getCursor());if(e){var i=this.getRange(t,n);this.replaceRange(r.commentStart+this.getRange(t,n)+r.commentEnd,t,n),t.line==n.line&&t.ch==n.ch&&this.setCursor(t.line,t.ch+r.commentStart.length)}else{var s=this.getRange(t,n),o=s.indexOf(r.commentStart),u=s.lastIndexOf(r.commentEnd);o>-1&&u>-1&&u>o&&(s=s.substr(0,o)+s.substring(o+r.commentStart.length,u)+s.substr(u+r.commentEnd.length)),this.replaceRange(s,t,n)}}),CodeMirror.defineExtension("autoIndentRange",function(e,t){var n=this;this.operation(function(){for(var r=e.line;r<=t.line;r++)n.indentLine(r,"smart")})}),CodeMirror.defineExtension("autoFormatRange",function(e,t){var n=this.indexFromPos(e),r=this.indexFromPos(t),i=this.getModeExt().autoFormatLineBreaks(this.getValue(),n,r),s=this;this.operation(function(){s.replaceRange(i,e,t);var r=s.posFromIndex(n).line,o=s.posFromIndex(n+i.length).line;for(var u=r;u<=o;u++)s.indentLine(u,"smart")})}),CodeMirror.modeExtensions.css={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(e,t,n){return e=e.substring(t,n),e.replace(new RegExp("(;|\\{|\\})([^\r\n])","g"),"$1\n$2")}},CodeMirror.modeExtensions.javascript={commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],getNonBreakableBlocks:function(e){var t=[new RegExp("for\\s*?\\(([\\s\\S]*?)\\)"),new RegExp('\\\\"([\\s\\S]*?)(\\\\"|$)'),new RegExp("\\\\'([\\s\\S]*?)(\\\\'|$)"),new RegExp("'([\\s\\S]*?)('|$)"),new RegExp('"([\\s\\S]*?)("|$)'),new RegExp("//.*([\r\n]|$)")],n=new Array;for(var r=0;r<t.length;r++){var i=0;while(i<e.length){var s=e.substr(i).match(t[r]);if(s==null)break;n.push({start:i+s.index,end:i+s.index+s[0].length}),i+=s.index+Math.max(1,s[0].length)}}return n.sort(function(e,t){return e.start-t.start}),n},autoFormatLineBreaks:function(e,t,n){e=e.substring(t,n);var r=0,i=new RegExp("(;|\\{|\\})([^\r\n])","g"),s=this.getNonBreakableBlocks(e);if(s!=null){var o="";for(var u=0;u<s.length;u++)s[u].start>r&&(o+=e.substring(r,s[u].start).replace(i,"$1\n$2"),r=s[u].start),s[u].start<=r&&s[u].end>=r&&(o+=e.substring(r,s[u].end),r=s[u].end);return r<e.length-1&&(o+=e.substr(r).replace(i,"$1\n$2")),o}return e.replace(i,"$1\n$2")}},CodeMirror.modeExtensions.xml={commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">"],autoFormatLineBreaks:function(e,t,n){e=e.substring(t,n);var r=e.split("\n"),i=new RegExp("(^\\s*?<|^[^<]*?)(.+)(>\\s*?$|[^>]*?$)"),s=new RegExp("<","g"),o=new RegExp("(>)([^\r\n])","g");for(var u=0;u<r.length;u++){var a=r[u].match(i);if(a!=null&&a.length>3){r[u]=a[1]+a[2].replace(s,"\n$&").replace(o,"$1\n$2")+a[3];continue}}return r.join("\n")}},CodeMirror.modeExtensions.htmlmixed={commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">",";","\\{","\\}"],getModeInfos:function(e,t){var n=new Array;n[0]={pos:0,modeExt:CodeMirror.modeExtensions.xml,modeName:"xml"};var r=new Array;r[0]={regex:new RegExp("<style[^>]*>([\\s\\S]*?)(</style[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.css,modeName:"css"},r[1]={regex:new RegExp("<script[^>]*>([\\s\\S]*?)(</script[^>]*>|$)","i"),modeExt:CodeMirror.modeExtensions.javascript,modeName:"javascript"};var i=typeof t!="undefined"?t:e.length-1;for(var s=0;s<r.length;s++){var o=0;while(o<=i){var u=e.substr(o).match(r[s].regex);if(u==null)break;if(u.length>1&&u[1].length>0){var a=o+u.index+u[0].indexOf(u[1]);n.push({pos:a,modeExt:r[s].modeExt,modeName:r[s].modeName}),n.push({pos:a+u[1].length,modeExt:n[0].modeExt,modeName:n[0].modeName}),o+=u.index+u[0].length;continue}o+=u.index+Math.max(u[0].length,1)}}return n.sort(function(t,n){return t.pos-n.pos}),n},autoFormatLineBreaks:function(e,t,n){var r=this.getModeInfos(e),i=new RegExp("^\\s*?\n"),s=new RegExp("\n\\s*?$"),o="";if(r.length>1)for(var u=1;u<=r.length;u++){var a=r[u-1].pos,f=u<r.length?r[u].pos:n;if(a>=n)break;if(a<t){if(f<=t)continue;a=t}f>n&&(f=n);var l=e.substring(a,f);r[u-1].modeName!="xml"&&(!i.test(l)&&a>0&&(l="\n"+l),!s.test(l)&&f<e.length-1&&(l+="\n")),o+=r[u-1].modeExt.autoFormatLineBreaks(l)}else o=r[0].modeExt.autoFormatLineBreaks(e.substring(t,n));return o}}
raptor.define("components.editors.CodeEditor.CodeEditorWidget",function(e){var t=function(e){var t=this;this.autoFormat=e.autoFormat,this.codeMirror=CodeMirror.fromTextArea(this.getEl(),{mode:e.mode,indentUnit:e.indentUnit,lineNumbers:e.lineNumbers!==!1,readOnly:e.readOnly===!0,onChange:function(e){t.publish("change",{codeEditor:t,value:e.getValue()})}});if(e.autoResize){var n=this.codeMirror.getWrapperElement(),r=n.className;n.className=r?r+" code-editor-auto-resize":"code-editor-auto-resize"}};return t.events=["change"],t.prototype={getTextArea:function(){return this.codeMirror.getTextArea()},getValue:function(){return this.codeMirror.getValue()},setValue:function(e){this.codeMirror.setValue(e);if(this.autoFormat){var t=this.codeMirror.posFromIndex(0),n=this.codeMirror.posFromIndex(e.length);this.codeMirror.autoFormatRange(t,n)}}},t})
CodeMirror.defineMode("javascript",function(e,t){function o(e,t,n){return t.tokenize=n,n(e,t)}function u(e,t){var n=!1,r;while((r=e.next())!=null){if(r==t&&!n)return!1;n=!n&&r=="\\"}return n}function l(e,t,n){return a=e,f=n,t}function c(e,t){var n=e.next();if(n=='"'||n=="'")return o(e,t,h(n));if(/[\[\]{}\(\),;\:\.]/.test(n))return l(n);if(n=="0"&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),l("number","number");if(/\d/.test(n)||n=="-"&&e.eat(/\d/))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),l("number","number");if(n=="/")return e.eat("*")?o(e,t,p):e.eat("/")?(e.skipToEnd(),l("comment","comment")):t.reAllowed?(u(e,"/"),e.eatWhile(/[gimy]/),l("regexp","string-2")):(e.eatWhile(s),l("operator",null,e.current()));if(n=="#")return e.skipToEnd(),l("error","error");if(s.test(n))return e.eatWhile(s),l("operator",null,e.current());e.eatWhile(/[\w\$_]/);var r=e.current(),a=i.propertyIsEnumerable(r)&&i[r];return a&&t.kwAllowed?l(a.type,a.style,r):l("variable","variable",r)}function h(e){return function(t,n){return u(t,e)||(n.tokenize=c),l("string","string")}}function p(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=c;break}n=r=="*"}return l("comment","comment")}function v(e,t,n,r,i,s){this.indented=e,this.column=t,this.type=n,this.prev=i,this.info=s,r!=null&&(this.align=r)}function m(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0}function g(e,t,n,i,s){var o=e.cc;y.state=e,y.stream=s,y.marked=null,y.cc=o,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);for(;;){var u=o.length?o.pop():r?A:L;if(u(n,i)){while(o.length&&o[o.length-1].lex)o.pop()();return y.marked?y.marked:n=="variable"&&m(e,i)?"variable-2":t}}}function b(){for(var e=arguments.length-1;e>=0;e--)y.cc.push(arguments[e])}function w(){return b.apply(null,arguments),!0}function E(e){var t=y.state;if(t.context){y.marked="def";for(var n=t.localVars;n;n=n.next)if(n.name==e)return;t.localVars={name:e,next:t.localVars}}}function x(){y.state.context||(y.state.localVars=S),y.state.context={prev:y.state.context,vars:y.state.localVars}}function T(){y.state.localVars=y.state.context.vars,y.state.context=y.state.context.prev}function N(e,t){var n=function(){var n=y.state;n.lexical=new v(n.indented,y.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function C(){var e=y.state;e.lexical.prev&&(e.lexical.type==")"&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function k(e){return function(n){return n==e?w():e==";"?b():w(arguments.callee)}}function L(e){return e=="var"?w(N("vardef"),j,k(";"),C):e=="keyword a"?w(N("form"),A,L,C):e=="keyword b"?w(N("form"),L,C):e=="{"?w(N("}"),B,C):e==";"?w():e=="function"?w(z):e=="for"?w(N("form"),k("("),N(")"),I,k(")"),C,L,C):e=="variable"?w(N("stat"),_):e=="switch"?w(N("form"),A,N("}","switch"),k("{"),B,C,C):e=="case"?w(A,k(":")):e=="default"?w(k(":")):e=="catch"?w(N("form"),x,k("("),W,k(")"),L,C,T):b(N("stat"),A,k(";"),C)}function A(e){return d.hasOwnProperty(e)?w(M):e=="function"?w(z):e=="keyword c"?w(O):e=="("?w(N(")"),O,k(")"),C,M):e=="operator"?w(A):e=="["?w(N("]"),H(A,"]"),C,M):e=="{"?w(N("}"),H(P,"}"),C,M):w()}function O(e){return e.match(/[;\}\)\],]/)?b():b(A)}function M(e,t){if(e=="operator"&&/\+\+|--/.test(t))return w(M);if(e=="operator"||e==":")return w(A);if(e==";")return;if(e=="(")return w(N(")"),H(A,")"),C,M);if(e==".")return w(D,M);if(e=="[")return w(N("]"),A,k("]"),C,M)}function _(e){return e==":"?w(C,L):b(M,k(";"),C)}function D(e){if(e=="variable")return y.marked="property",w()}function P(e){e=="variable"&&(y.marked="property");if(d.hasOwnProperty(e))return w(k(":"),A)}function H(e,t){function n(r){return r==","?w(e,n):r==t?w():w(k(t))}return function(i){return i==t?w():b(e,n)}}function B(e){return e=="}"?w():b(L,B)}function j(e,t){return e=="variable"?(E(t),w(F)):w()}function F(e,t){if(t=="=")return w(A,F);if(e==",")return w(j)}function I(e){return e=="var"?w(j,R):e==";"?b(R):e=="variable"?w(q):b(R)}function q(e,t){return t=="in"?w(A):w(M,R)}function R(e,t){return e==";"?w(U):t=="in"?w(A):w(A,k(";"),U)}function U(e){e!=")"&&w(A)}function z(e,t){if(e=="variable")return E(t),w(z);if(e=="(")return w(N(")"),x,H(W,")"),C,L,T)}function W(e,t){if(e=="variable")return E(t),w()}var n=e.indentUnit,r=t.json,i=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),i=e("operator"),s={type:"atom",style:"atom"};return{"if":t,"while":t,"with":t,"else":n,"do":n,"try":n,"finally":n,"return":r,"break":r,"continue":r,"new":r,"delete":r,"throw":r,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":i,"typeof":i,"instanceof":i,"true":s,"false":s,"null":s,"undefined":s,NaN:s,Infinity:s}}(),s=/[+\-*&%=<>!?|]/,a,f,d={atom:!0,number:!0,variable:!0,string:!0,regexp:!0},y={state:null,column:null,marked:null,cc:null},S={name:"this",next:{name:"arguments"}};return C.lex=!0,{startState:function(e){return{tokenize:c,reAllowed:!0,kwAllowed:!0,cc:[],lexical:new v((e||0)-n,0,"block",!1),localVars:t.localVars,context:t.localVars&&{vars:t.localVars},indented:0}},token:function(e,t){e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation());if(e.eatSpace())return null;var n=t.tokenize(e,t);return a=="comment"?n:(t.reAllowed=a=="operator"||a=="keyword c"||!!a.match(/^[\[{}\(,;:]$/),t.kwAllowed=a!=".",g(t,n,a,f,e))},indent:function(e,t){if(e.tokenize!=c)return 0;var r=t&&t.charAt(0),i=e.lexical;i.type=="stat"&&r=="}"&&(i=i.prev);var s=i.type,o=r==s;return s=="vardef"?i.indented+4:s=="form"&&r=="{"?i.indented:s=="stat"||s=="form"?i.indented+n:i.info=="switch"&&!o?i.indented+(/^(?:case|default)\b/.test(t)?n:2*n):i.align?i.column+(o?0:1):i.indented+(o?0:n)},electricChars:":{}"}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0})
CodeMirror.defineMode("css",function(e){function r(e,t){return n=t,e}function i(e,t){var n=e.next();if(n=="@")return e.eatWhile(/[\w\\\-]/),r("meta",e.current());if(n=="/"&&e.eat("*"))return t.tokenize=s,s(e,t);if(n=="<"&&e.eat("!"))return t.tokenize=o,o(e,t);if(n!="=")return n!="~"&&n!="|"||!e.eat("=")?n=='"'||n=="'"?(t.tokenize=u(n),t.tokenize(e,t)):n=="#"?(e.eatWhile(/[\w\\\-]/),r("atom","hash")):n=="!"?(e.match(/^\s*\w*/),r("keyword","important")):/\d/.test(n)?(e.eatWhile(/[\w.%]/),r("number","unit")):/[,.+>*\/]/.test(n)?r(null,"select-op"):/[;{}:\[\]]/.test(n)?r(null,n):(e.eatWhile(/[\w\\\-]/),r("variable","variable")):r(null,"compare");r(null,"compare")}function s(e,t){var n=!1,s;while((s=e.next())!=null){if(n&&s=="/"){t.tokenize=i;break}n=s=="*"}return r("comment","comment")}function o(e,t){var n=0,s;while((s=e.next())!=null){if(n>=2&&s==">"){t.tokenize=i;break}n=s=="-"?n+1:0}return r("comment","comment")}function u(e){return function(t,n){var s=!1,o;while((o=t.next())!=null){if(o==e&&!s)break;s=!s&&o=="\\"}return s||(n.tokenize=i),r("string","string")}}var t=e.indentUnit,n;return{startState:function(e){return{tokenize:i,baseIndent:e||0,stack:[]}},token:function(e,t){if(e.eatSpace())return null;var r=t.tokenize(e,t),i=t.stack[t.stack.length-1];if(n=="hash"&&i!="rule")r="string-2";else if(r=="variable")if(i=="rule")r="number";else if(!i||i=="@media{")r="tag";return i=="rule"&&/^[\{\};]$/.test(n)&&t.stack.pop(),n=="{"?i=="@media"?t.stack[t.stack.length-1]="@media{":t.stack.push("{"):n=="}"?t.stack.pop():n=="@media"?t.stack.push("@media"):i=="{"&&n!="comment"&&t.stack.push("rule"),r},indent:function(e,n){var r=e.stack.length;return/^\}/.test(n)&&(r-=e.stack[e.stack.length-1]=="rule"?2:1),e.baseIndent+r*t},electricChars:"}"}}),CodeMirror.defineMIME("text/css","css")
CodeMirror.defineMode("xml",function(e,t){function u(e,t){function n(n){return t.tokenize=n,n(e,t)}var r=e.next();if(r=="<"){if(e.eat("!"))return e.eat("[")?e.match("CDATA[")?n(l("atom","]]>")):null:e.match("--")?n(l("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),n(c(1))):null;if(e.eat("?"))return e.eatWhile(/[\w\._\-]/),t.tokenize=l("meta","?>"),"meta";o=e.eat("/")?"closeTag":"openTag",e.eatSpace(),s="";var i;while(i=e.eat(/[^\s\u00a0=<>\"\'\/?]/))s+=i;return t.tokenize=a,"tag"}if(r=="&"){var u;return e.eat("#")?e.eat("x")?u=e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):u=e.eatWhile(/[\d]/)&&e.eat(";"):u=e.eatWhile(/[\w\.\-:]/)&&e.eat(";"),u?"atom":"error"}return e.eatWhile(/[^&<]/),null}function a(e,t){var n=e.next();return n==">"||n=="/"&&e.eat(">")?(t.tokenize=u,o=n==">"?"endTag":"selfcloseTag","tag"):n=="="?(o="equals",null):/[\'\"]/.test(n)?(t.tokenize=f(n),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function f(e){return function(t,n){while(!t.eol())if(t.next()==e){n.tokenize=a;break}return"string"}}function l(e,t){return function(n,r){while(!n.eol()){if(n.match(t)){r.tokenize=u;break}n.next()}return e}}function c(e){return function(t,n){var r;while((r=t.next())!=null){if(r=="<")return n.tokenize=c(e+1),n.tokenize(t,n);if(r==">"){if(e==1){n.tokenize=u;break}return n.tokenize=c(e-1),n.tokenize(t,n)}}return"meta"}}function d(){for(var e=arguments.length-1;e>=0;e--)h.cc.push(arguments[e])}function v(){return d.apply(null,arguments),!0}function m(e,t){var n=r.doNotIndent.hasOwnProperty(e)||h.context&&h.context.noIndent;h.context={prev:h.context,tagName:e,indent:h.indented,startOfLine:t,noIndent:n}}function g(){h.context&&(h.context=h.context.prev)}function y(e){if(e=="openTag")return h.tagName=s,v(S,b(h.startOfLine));if(e=="closeTag"){var t=!1;return h.context?h.context.tagName!=s&&(r.implicitlyClosed.hasOwnProperty(h.context.tagName.toLowerCase())&&g(),t=!h.context||h.context.tagName!=s):t=!0,t&&(p="error"),v(w(t))}return v()}function b(e){return function(t){return t=="selfcloseTag"||t=="endTag"&&r.autoSelfClosers.hasOwnProperty(h.tagName.toLowerCase())?(E(h.tagName.toLowerCase()),v()):t=="endTag"?(E(h.tagName.toLowerCase()),m(h.tagName,e),v()):v()}}function w(e){return function(t){return e&&(p="error"),t=="endTag"?(g(),v()):(p="error",v(arguments.callee))}}function E(e){var t;for(;;){if(!h.context)return;t=h.context.tagName.toLowerCase();if(!r.contextGrabbers.hasOwnProperty(t)||!r.contextGrabbers[t].hasOwnProperty(e))return;g()}}function S(e){return e=="word"?(p="attribute",v(x,S)):e=="endTag"||e=="selfcloseTag"?d():(p="error",v(S))}function x(e){return e=="equals"?v(T,S):(r.allowMissing||(p="error"),e=="endTag"||e=="selfcloseTag"?d():v())}function T(e){return e=="string"?v(N):e=="word"&&r.allowUnquoted?(p="string",v()):(p="error",e=="endTag"||e=="selfCloseTag"?d():v())}function N(e){return e=="string"?v(N):d()}var n=e.indentUnit,r=t.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!1}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1},i=t.alignCDATA,s,o,h,p;return{startState:function(){return{tokenize:u,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(e,t){e.sol()&&(t.startOfLine=!0,t.indented=e.indentation());if(e.eatSpace())return null;p=o=s=null;var n=t.tokenize(e,t);t.type=o;if((n||o)&&n!="comment"){h=t;for(;;){var r=t.cc.pop()||y;if(r(o||n))break}}return t.startOfLine=!1,p||n},indent:function(e,t,r){var s=e.context;if(e.tokenize!=a&&e.tokenize!=u||s&&s.noIndent)return r?r.match(/^(\s*)/)[0].length:0;if(i&&/<!\[CDATA\[/.test(t))return 0;s&&/^<\//.test(t)&&(s=s.prev);while(s&&!s.startOfLine)s=s.prev;return s?s.indent+n:0},compareStates:function(e,t){if(e.indented!=t.indented||e.tokenize!=t.tokenize)return!1;for(var n=e.context,r=t.context;;n=n.prev,r=r.prev){if(!n||!r)return n==r;if(n.tagName!=r.tagName||n.indent!=r.indent)return!1}},electricChars:"/"}}),CodeMirror.defineMIME("text/xml","xml"),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.mimeModes.hasOwnProperty("text/html")||CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0})
CodeMirror.defineMode("htmlmixed",function(e,t){function s(e,t){var s=n.token(e,t.htmlState);return s=="tag"&&e.current()==">"&&t.htmlState.context&&(/^script$/i.test(t.htmlState.context.tagName)?(t.token=u,t.localState=r.startState(n.indent(t.htmlState,"")),t.mode="javascript"):/^style$/i.test(t.htmlState.context.tagName)&&(t.token=a,t.localState=i.startState(n.indent(t.htmlState,"")),t.mode="css")),s}function o(e,t,n){var r=e.current(),i=r.search(t);return i>-1&&e.backUp(r.length-i),n}function u(e,t){return e.match(/^<\/\s*script\s*>/i,!1)?(t.token=s,t.localState=null,t.mode="html",s(e,t)):o(e,/<\/\s*script\s*>/,r.token(e,t.localState))}function a(e,t){return e.match(/^<\/\s*style\s*>/i,!1)?(t.token=s,t.localState=null,t.mode="html",s(e,t)):o(e,/<\/\s*style\s*>/,i.token(e,t.localState))}var n=CodeMirror.getMode(e,{name:"xml",htmlMode:!0}),r=CodeMirror.getMode(e,"javascript"),i=CodeMirror.getMode(e,"css");return{startState:function(){var e=n.startState();return{token:s,localState:null,mode:"html",htmlState:e}},copyState:function(e){if(e.localState)var t=CodeMirror.copyState(e.token==a?i:r,e.localState);return{token:e.token,localState:t,mode:e.mode,htmlState:CodeMirror.copyState(n,e.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(e,t){return e.token==s||/^\s*<\//.test(t)?n.indent(e.htmlState,t):e.token==u?r.indent(e.localState,t):i.indent(e.localState,t)},compareStates:function(e,t){return e.mode!=t.mode?!1:e.localState?CodeMirror.Pass:n.compareStates(e.htmlState,t.htmlState)},electricChars:"/{}:"}},"xml","javascript","css"),CodeMirror.defineMIME("text/html","htmlmixed")
!function(e){e(function(){"use strict",e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function n(){s.trigger("closed").remove()}var r=e(this),i=r.attr("data-target"),s;i||(i=r.attr("href"),i=i&&i.replace(/.*(?=#[^\s]*$)/,"")),s=e(i),t&&t.preventDefault(),s.length||(s=r.hasClass("alert")?r:r.parent()),s.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;s.removeClass("in"),e.support.transition&&s.hasClass("fade")?s.on(e.support.transition.end,n):n()},e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e(function(){e("body").on("click.alert.data-api",t,n.prototype.close)})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.parent('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")},e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=n,this.options.slide&&this.slide(this.options.slide),this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var n=this.$element.find(".active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(e){return e||(this.paused=!0),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",f=this,l=e.Event("slide");this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u]();if(i.hasClass("active"))return;if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(l);if(l.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger("slid")},0)})}else{this.$element.trigger(l);if(l.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}},e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n);i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):typeof n=="string"||(n=s.slide)?i[n]():s.interval&&i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e(function(){e("body").on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=!i.data("modal")&&e.extend({},i.data(),n.data());i.carousel(s),t.preventDefault()})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning)return;t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning)return;t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e!==null?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n.type=="show"&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=typeof n=="object"&&n;i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e(function(){e("body").on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();e(i).collapse(s)})})}(window.jQuery),!function(e){function t(){e(n).parent().removeClass("open")}"use strict";var n='[data-toggle="dropdown"]',r=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};r.prototype={constructor:r,toggle:function(n){var r=e(this),i,s,o;if(r.is(".disabled, :disabled"))return;return s=r.attr("data-target"),s||(s=r.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,"")),i=e(s),i.length||(i=r.parent()),o=i.hasClass("open"),t(),o||i.toggleClass("open"),!1}},e.fn.dropdown=function(t){return this.each(function(){var n=e(this),i=n.data("dropdown");i||n.data("dropdown",i=new r(this)),typeof t=="string"&&i[t].call(n)})},e.fn.dropdown.Constructor=r,e(function(){e("html").on("click.dropdown.data-api",t),e("body").on("click.dropdown",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",n,r.prototype.toggle)})}(window.jQuery),!function(e){function t(){var t=this,r=setTimeout(function(){t.$element.off(e.support.transition.end),n.call(t)},500);this.$element.one(e.support.transition.end,function(){clearTimeout(r),n.call(t)})}function n(e){this.$element.hide().trigger("hidden"),r.call(this)}function r(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),s?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(i,this)):i.call(this)):t&&t()}function i(){this.$backdrop.remove(),this.$backdrop=null}function s(){var t=this;this.isShown&&this.options.keyboard?e(document).on("keyup.dismiss.modal",function(e){e.which==27&&t.hide()}):this.isShown||e(document).off("keyup.dismiss.modal")}"use strict";var o=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this))};o.prototype={constructor:o,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;e("body").addClass("modal-open"),this.isShown=!0,s.call(this),r.call(this,function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in"),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")})},hide:function(r){r&&r.preventDefault();var i=this;r=e.Event("hide"),this.$element.trigger(r);if(!this.isShown||r.isDefaultPrevented())return;this.isShown=!1,e("body").removeClass("modal-open"),s.call(this),this.$element.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?t.call(this):n.call(this)}},e.fn.modal=function(t){return this.each(function(){var n=e(this),r=n.data("modal"),i=e.extend({},e.fn.modal.defaults,n.data(),typeof t=="object"&&t);r||n.data("modal",r=new o(this,i)),typeof t=="string"?r[t]():i.show&&r.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=o,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({},i.data(),n.data());t.preventDefault(),i.modal(s)})})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger!="manual"&&(i=this.options.trigger=="hover"?"mouseenter":"focus",s=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(i,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(!n.options.delay||!n.options.delay.show)return n.show();clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.css(o).addClass(s).addClass("in")}},isHTML:function(e){return typeof e!="string"||e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(e)},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.isHTML(t)?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){r.off(e.support.transition.end).remove()},500);r.one(e.support.transition.end,function(){clearTimeout(t),r.remove()})}var n=this,r=this.tip();r.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():r.remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}},e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.isHTML(t)?"html":"text"](t),e.find(".popover-content > *")[this.isHTML(n)?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip}}),e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(e){function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}"use strict",t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var t=e(this),n=t.data("target")||t.attr("href"),r=/^#\w/.test(n)&&e(n);return r&&n.length&&[[r.position().top,n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu")&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}},e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e(function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function i(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var s=n.find("> .active"),o=r&&e.support.transition&&s.hasClass("fade");o?s.one(e.support.transition.end,i):i(),s.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n=this,r,i;return this.query=this.$element.val(),this.query?(r=e.grep(this.source,function(e){return n.matcher(e)}),r=this.sorter(r),r.length?this.render(r.slice(0,this.options.items)).show():this.shown?this.hide():this):this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keypress,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},keypress:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:if(e.type!="keydown")break;e.preventDefault(),this.prev();break;case 40:if(e.type!="keydown")break;e.preventDefault(),this.next()}e.stopPropagation()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>'},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery)
raptor.define("components.buttons.Button.ButtonWidget",function(e){var t=function(e){var t=this;this.toggled=!1,this.jqueryButton=this.$(),this._toggle=e.toggle,e.toggled&&this.toggle(),this.$().click(function(){t.publish("click",{button:this}),t._toggle&&t.toggle()})};return t.events=["click","toggle"],t.prototype={toggle:function(){this.toggled=!this.toggled,this.jqueryButton.button("toggle"),this.publish("toggle",{button:this})}},t})
raptor.define("components.nav.Nav.NavWidget",function(e){var t=function(e){var t=this;this.$("LI").click(function(){t.publish("navItemClick",{el:this,nav:t})})};return t.events=["navItemClick"],t.prototype={},t})
raptor.define("components.templates.Errors.ErrorsWidget",function(e){var t=function(e){this._hasErrors=!1};return t.prototype={setErrors:function(e){e&&e.length?(this.$("#ul").empty(),this.addErrors(e)):(this._hasErrors=!1,this.$("#ul").hide().empty())},clearErrors:function(){this.setErrors(null)},hasErrors:function(){return this._hasErrors},addErrors:function(t){if(t&&t.length){this._hasErrors=!0;var n=this.getEl("ul");e.forEach(t,function(t){var r=document.createElement("LI");r.innerHTML=e.require("templating").renderToString("components/templates/Errors-error",{message:t.message}),n.appendChild(r)},this),this.$("#ul").show()}}},t})
$rset("rhtml","components/templates/Errors-error",function(e){var t=e.e,n=e.ne,r=e.x;return function(e,t,n){var i=n.w,s=e.message;i('<span class="x">✘</span><pre class="message">')(r(s))("</pre>")}})
raptor.define("components.templates.TemplateTestbed.TemplateTestbedWidget",function(raptor){var stringify=raptor.require("json.stringify").stringify,TemplateTestbedWidget=function(e){this.samples=e.samples,this.autoRender=!0,this.compileRequired=!0,this.dataModified=!0,this.optionsModified=!0,this.renderRequired=!0,this.optionsVisible=!1,this.defaultOptionsJson=stringify(raptor.require("templating.compiler").defaultOptions),this.loadSample(0),this.renderButton.subscribe("click",function(e){this.update()},this),this.showCompiledToggleButton.subscribe("toggle",function(e){this.toggleCompiledOutput()},this),this.showOptionsToggleButton.subscribe("toggle",function(e){this.toggleCompilerOptions()},this),this.autoRenderToggleButton.subscribe("toggle",function(e){this.autoRender=!this.autoRender},this),this.templateEditor.subscribe("change",function(){this.compileRequired=!0,this.renderRequired=!0,this.autoRender&&this.update()},this),this.dataEditor.subscribe("change",function(){this.dataModified=!0,this.renderRequired=!0,this.autoRender&&this.update()},this),this.optionsEditor.subscribe("change",function(){this.optionsModified=!0,this.compileRequired=!0,this.renderRequired=!0,this.autoRender&&this.update()},this),this.samplesNav.subscribe("navItemClick",function(e){var t=$(e.el).data("sample");this.loadSample(t)},this)};return TemplateTestbedWidget.prototype={loadSample:function(e){var t=this.samples[e];t.templatesLoaded||(raptor.forEach(t.templates,function(e){raptor.require("templating.compiler").compileAndLoad(e.source,e.path)},this),t.templatesLoaded=!0),this.templateEditor.setValue(t.template),this.dataEditor.setValue(t.data),this.optionsEditor.setValue(t.options||this.defaultOptionsJson),this.update()},handleEditorException:function(e,t){var n=t.errors;n||(n=[{message:t.toString()}]),e.addErrors(n)},update:function(){this.updateJson("compilerOptions","optionsModified",this.optionsEditor,this.optionsErrors),this.compileTemplate(),this.updateJson("templateData","dataModified",this.dataEditor,this.dataErrors),this.renderTemplate()},compileTemplate:function(){if(!this.compilerOptions)return;if(!this.compileRequired)return;this.templateName=null;var templateSrc=this.templateEditor.getValue(),compiler=raptor.require("templating.compiler"),compiledSrc;this.templateErrors.clearErrors();var templateDom;try{templateDom=raptor.require("xml.dom").createParser().parse(templateSrc)}catch(e){this.handleEditorException(this.templateErrors,"Invalid XML")}if(templateDom)try{var compilerOptions=raptor.extend({defaultTemplateName:"test",nameCallback:function(e){templateName=e}},this.compilerOptions);compiledSrc=compiler.compile(templateDom,"test",compilerOptions)}catch(e){this.handleEditorException(this.templateErrors,e)}if(compiledSrc){this.compiledEditor.setValue(compiledSrc),raptor.require("templating").unload(templateName);try{eval(compiledSrc),this.templateName=templateName}catch(e){this.handleEditorException(this.templateErrors,e)}}else this.compiledEditor.setValue("");this.compileRequired=!1},updateJson:function(targetProp,modifiedProp,editor,errors){if(!this[modifiedProp])return;this[targetProp]=null,errors.clearErrors();var jsonData=editor.getValue(),data;try{data=eval("("+jsonData+")"),this[targetProp]=data}catch(e){this.handleEditorException(errors,e)}this[modifiedProp]=!1},renderTemplate:function(){if(!this.renderRequired)return;if(this.templateData&&this.templateName&&this.compilerOptions)try{var e=raptor.require("templating").renderToString(this.templateName,this.templateData);this.outputEditor.setValue(e),this.$("#htmlViewer").html(e)}catch(t){this.handleEditorException(this.templateErrors,t),this.outputEditor.setValue(""),this.$("#htmlViewer").html("")}else this.outputEditor.setValue(""),this.$("#htmlViewer").html("");this.renderRequired=!1},toggleCompiledOutput:function(){this.$("#compiledTemplateSection").toggle()},toggleCompilerOptions:function(){this.optionsVisible=!this.optionsVisible,this.optionsVisible?this.$("#compilerOptionsSection").removeClass("compiler-options-hidden"):this.$("#compilerOptionsSection").addClass("compiler-options-hidden")}},TemplateTestbedWidget})
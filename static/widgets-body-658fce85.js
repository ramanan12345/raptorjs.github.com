raptor.define("widgets",function(e){"use strict";var t=function(e,t,n,r,i,s){this.type=t,this.id=e,this.assignedId=n,this.config=r,this.scope=i,this.events=s,this.children=[]};return t.prototype={elId:function(e){return arguments.length===0?this.id:this.id+"-"+e}},{addWidget:function(n,r,i,s,o,u,a,f){r||(r=this._nextWidgetId(f));var l=new t(r,n,i,s,u,a);o&&o.children.push(l);if(i&&!u)throw e.createError(new Error("Widget with an assigned ID is not scoped within another widget."));if(!o){var c=f.getAttributes();c.widgets||(c.widgets=[]),c.widgets.push(l)}return l},hasWidgets:function(e){var t=e.getAttributes();return t.widgets&&t.widgets.length!==0},_nextDocId:function(e){var t=e.getAttributes();return t.nextDocId||(t.nextDocId=1),t.nextDocId++}}});
raptor.define("pubsub",function(e){"use strict";var t=e.listeners,n=function(e,n){t.Message.call(this,e,n),this.topic=e};n.prototype={getTopic:function(){return this.topic}},e.inherit(n,t.Message,!0);var r=e.defineClass(function(e){return{init:function(e){this.name=e,this.observable=t.createObservable()},publish:function(t,n){var r;return e.listeners.isMessage(t)?r=t:r=e.require("pubsub").createMessage(t,n),this.observable.publish(r),r},subscribe:function(e,t,n){return this.observable.subscribe(e,t,n)}}}),i={};return{channel:function(e){var t=i[e];return t||(t=new r(e),i[e]=t),t},global:function(){return this.channel("global")},publish:function(e,t){var n=this.global();n.publish.apply(n,arguments)},subscribe:function(e,t,n){var r=this.global();return r.subscribe.apply(r,arguments)},createMessage:function(e,t){return new n(e,t)}}});
raptor.extend("widgets",function(e,t){"use strict";var n="prototype",r={},i=e.listeners,s="events",o=e.require("widgets.Widget"),u=e.arrayFromArguments,a=0,f=function(e){this.widget=e,this.widgetsById={}};return f.prototype={addWidget:function(e,t){var n=this.widgetsById[t],r=this.widget,i;t.length>2&&t.substring(t.length-2)==="[]"&&(t=t.slice(0,-2),i=!0),n?n.push(e):this.widgetsById[t]=[e],i?(r[t]||(r[t]=[])).push(e):r[t]=e},getWidget:function(t){var n=this.widgetsById[t];if(!n||n.length===0)return undefined;if(n.length===1)return n[0];throw e.createError(new Error('getWidget: Multiple widgets found with ID "'+t+'"'))},getWidgets:function(e){return this.widgetsById[e]||[]}},{_initAll:function(i){var a=this.logger(),l={},c=function(e,t,n){try{e.initWidget?e.initWidget(t):e.init(t)}catch(r){a.error('Unable to initialize widget of type "'+n+"'. Exception: "+r,r)}},h=function(e,t,n){e.onReady(function(){c(e,t,n)})},p=function(e,t){return this.publish(e,u(arguments,1))},d=function(i,u){if(!i)return;var l=0,v=i.length,m;for(;l<v;l++){var g=i[l],y=g[0],b=g[1],w=g[2],E=g[3],S=g[4]||{},x=g[5]||{},T=g.slice(6);w===0&&(w=undefined),E===0&&(E=undefined),S===0&&(S=undefined),a.debug('Creating widget of type "'+y+'" ('+b+")");var N=e.find(y);if(!N)throw e.createError(new Error('Unable to initialize widget of type "'+y+'". The class for the widget was not found.'));if(x){var C={};e.forEach(x,function(e){C[e[0]]={target:e[1],props:e[2]}},this),x=C}if(N.initWidget)S.elId=b,S.events=x,m=N,m.onReady=t.onReady;else{var k=o._init,L;k[n]=L=N[n],L.init=N,L._isWidget||e.extend(L,o,!1),m=new k(x),L.notify||(L.notify=p,L.on=L.subscribe),m.registerMessages(["beforeDestroy","destroy"],!1);var A=L[s]||N[s];A&&m.registerMessages(A,!1),m._id=b,m._assignedId=E,r[b]=m,E&&w&&r[w]._doc.addWidget(m,E),m._doc=new f(m)}T&&T.length&&d(T,m),m.initBeforeOnDomReady===!0?c(m,S,y):h(m,S,y)}};d(i)},get:function(e){return r[e]},_nextWidgetId:function(){return"c"+a++}}}),raptor.global.$rwidgets=function(){"use strict";var e=raptor.require("widgets");e._initAll(raptor.arrayFromArguments(arguments))}
raptor.defineMixin("widgets.Widget",{singleton:!0},function(e){"use strict";var t=e.forEach,n=e.require("listeners"),r=function(e,i,s){var o={widget:e},u;e.publish("beforeDestroy",o),n.unsubscribeFromAll(e),e.__destroyed=!0,i&&(u=e.getRootEl(),u&&u.parentNode.removeChild(u)),s&&t(e.getChildren(),function(e){r(e,i&&!u,!0)}),e.publish("destroy",o)};return{_isWidget:!0,_init:function(e){this._children=[],this._childrenById={},this._events=e},getObservable:function(){return this._observable||(this._observable=n.createObservable())},registerMessages:function(e,t){this.getObservable().registerMessages.apply(this,arguments)},publish:function(t,n){var r=this.getObservable();r.publish.apply(r,arguments);var i;this._events&&(i=this._events[t])&&(i.props&&(n=e.extend(n||{},i.props)),e.require("pubsub").publish(i.target,n))},subscribe:function(e,t,n){var r=this.getObservable();return r.subscribe.apply(r,arguments)},getElId:function(e){return e?this._id+"-"+e:this._id},getRootElId:function(e){return this.getElId()},getEl:function(e){return document.getElementById(this.getElId(e))},getRootEl:function(){return this.getEl()},getWidget:function(e){var t=this._doc;return t?t.getWidget(e):null},getWidgets:function(e){var t=this._doc;return t?t.getWidgets(e):null},getChild:function(e){return this.getWidget(e)},getChildren:function(e){return this.getWidget(e)},getDoc:function(){return this._doc},getParent:function(){return this._parentWidget},getChildWidget:function(e){return this.getChild(e)},getChildWidgets:function(e){return this.getChildren.apply(this,arguments)},getParentWidget:function(){return this._parentWidget},destroy:function(e){r(this,!0,!0)},isDestroyed:function(){return this.__destroyed}}});
raptor.extend("widgets",function(e){"use strict";return{onReady:function(e,t){$(function(){e.call(t)})}}});
raptor.extend("widgets.Widget",function(e){"use strict";var t=/\#(\w+)( .*)?/g,n=e.global;return{$:function(e){var r=arguments;if(r.length===1){if(typeof e=="function"){var i=this;$(function(){e.apply(i,r)})}else if(typeof e=="string"){var s=t.exec(e);t.lastIndex=0;if(s!=null){var o=s[1];return s[2]==null?$(this.getEl(o)):$("#"+this.getElId(o)+s[2])}var u=this.getEl();if(!u)throw new Error("Root element is not defined for widget");if(u)return $(e,u)}}else if(r.length===2){if(typeof r[1]=="string")return $(e,this.getEl(r[1]))}else if(r.length===0)return $(this.getEl());return $.apply(n,arguments)},onReady:function(e){var t=this;$(function(){e.call(t,t)})}}});
define("raptor/widgets/WidgetDef",["raptor"],function(e,t,n,r){"use strict";var i=function(t){this.children=[],e.extend(this,t)};return i.prototype={addChild:function(e){this.children.push(e)},elId:function(e){return arguments.length===0?this.id:this.id+"-"+e}},i});
define("raptor/widgets/WidgetsContext",function(e,t,n){"use strict";var r=e("raptor/widgets/WidgetDef"),i=function(e){this.context=e,this.widgets=[],this.widgetStack=[]};return i.prototype={beginWidget:function(e,t){var n=this,i=n.widgetStack,s=i.length,o=s?i[s-1]:null;e.id||(e.id=n._nextWidgetId());if(e.assignedId&&!e.scope)throw raptor.createError(new Error('Widget with an assigned ID "'+e.assignedId+'" is not scoped within another widget.'));e.parent=o;var u=new r(e);o?o.addChild(u):n.widgets.push(u),i.push(u);try{t(u)}finally{i.splice(s,1)}},hasWidgets:function(){return this.widgets.length!==0},clearWidgets:function(){this.widgets=[],this.widgetStack=[]},_nextWidgetId:function(){return"w"+this.context.uniqueId()}},i});
define("raptor/widgets",function(e,t,n){"use strict";var r=e("raptor/widgets/WidgetsContext"),i="widgets";return{getWidgetsContext:function(e){var t=e.getAttributes();return t[i]||(t[i]=new r(e))}}});
define("raptor/pubsub",function(e,t,n){"use strict";var r=e("raptor/listeners"),i=define.Class({superclass:r.Message},function(){var e=function(e,t){r.Message.call(this,e,t),this.topic=e};return e.prototype={getTopic:function(){return this.topic}},e}),s=define.Class(function(){return{init:function(e){this.name=e,this.observable=r.createObservable()},publish:function(t,n){var i;return r.isMessage(t)?i=t:i=e("raptor/pubsub").createMessage(t,n),this.observable.publish(i),i},subscribe:function(e,t,n){return this.observable.subscribe(e,t,n)}}}),o={};return{channel:function(e){var t=o[e];return t||(t=new s(e),o[e]=t),t},global:function(){return this.channel("global")},publish:function(e,t){var n=this.global();n.publish.apply(n,arguments)},subscribe:function(e,t,n){var r=this.global();return r.subscribe.apply(r,arguments)},createMessage:function(e,t){return new i(e,t)}}});
define("raptor/dom",function(e){return{forEachChildEl:function(e,t,n){this.forEachChild(e,t,n,1)},forEachChild:function(e,t,n,r){if(!e)return;var i=0,s=e.childNodes,o=s.length;for(;i<o;i++){var u=s[i];u&&(r==null||r==u.nodeType)&&t.call(n,u)}}}});
define.extend("raptor/widgets/WidgetsContext",function(e,t){"use strict";return{initWidgets:function(){var t=this.widgets,n=e("raptor/widgets");t.forEach(function(e){n.initWidget(e)}),this.clearWidgets()}}});
define.extend("raptor/widgets",function(e,t){"use strict";var n=e("raptor/logging").logger("raptor/widgets"),r={},i=e("raptor"),s=e("raptor/widgets/Widget"),o=function(e){var t={};return i.forEach(e,function(e){t[e[0]]={target:e[1],props:e[2]}},this),t},u=function(e){this.widget=e,this.widgetsById={}};u.prototype={addWidget:function(e,t){var n=this.widgetsById[t],r=this.widget,i;t.endsWith("[]")&&(t=t.slice(0,-2),i=!0),n?n.push(e):this.widgetsById[t]=[e],i?(r[t]||(r[t]=[])).push(e):r[t]=e},getWidget:function(e){var t=this.widgetsById[e];if(!t||t.length===0)return undefined;if(t.length===1)return t[0];throw i.createError(new Error('getWidget: Multiple widgets found with ID "'+e+'"'))},getWidgets:function(e){return this.widgetsById[e]||[]}};var a=function(a,f,l,c,h,p){if(!e.exists(a))throw i.createError(new Error('Unable to initialize widget of type "'+a+'". The class for the widget was not found.'));var d,v=e(a);n.debug('Creating widget of type "'+a+'" ('+f+")");if(v.initWidget)c.elId=f,c.events=p,d=v,v.onReady||(v.onReady=t.onReady);else{var m=function(){},g;m.prototype=g=v.prototype,d=new m,s.makeWidget(d,g),d.registerMessages(["beforeDestroy","destroy"],!1);var y=g.events||v.events;y&&d.registerMessages(y,!1),d._id=f,d._assignedId=l,p&&(d._events=o(p)),r[f]=d;if(l&&h){var b=r[h];if(!b)throw i.createError(new Error("Parent scope not found: "+h));r[h]._doc.addWidget(d,l)}d._doc=new u(d)}return{widget:d,init:function(){var e=function(){try{d.initWidget?d.initWidget(c):v.call(d,c)}catch(e){n.error('Unable to initialize widget of type "'+a+"'. Exception: "+e,e)}};d.initBeforeOnDomReady===!0?e():d.onReady(e)}}};return{initWidget:function(e){var t=a(e.type,e.id,e.assignedId,e.config,e.scope?e.scope.id:null,e.events);e.widget=t.widget,e.children.length&&e.children.forEach(this.initWidget,this),t.init()},_serverInit:function(e){var t=function(e){if(!e)return;var n=0,r=e.length;for(;n<r;n++){var i=e[n],s=i[0],o=i[1],u=i[2]||{},f=i[3],l=i[4],c=i[5]||{},h=i.slice(6);f===0&&(f=undefined),l===0&&(l=undefined),u===0&&(u=undefined);var p=a(s,o,l,u,f,c);h&&h.length&&t(h),p.init()}};t(e)},get:function(e){return r[e]}}}),$rwidgets=function(){"use strict";require("raptor/widgets")._serverInit(require("raptor").arrayFromArguments(arguments))},require("raptor/pubsub").subscribe({"dom/beforeRemove":function(e){var t=e.el,n=require("raptor/widgets").get(t.id);n&&n.destroy({removeNode:!1,recursive:!0})},"raptor/component-renderer/renderedToDOM":function(e){var t=require("raptor/widgets"),n=e.context,r=t.getWidgetsContext(n);r.initWidgets()}});
define("raptor/widgets/Widget",["raptor"],function(e,t){"use strict";var n=e.forEach,r=t("raptor/listeners"),i=e.arrayFromArguments,s=function(e,i,o){var u={widget:e},a;e.publish("beforeDestroy",u),r.unsubscribeFromAll(e),e.__destroyed=!0,i&&(a=e.getRootEl(),a&&a.parentNode.removeChild(a)),o&&(t("raptor/dom"),n(e.getChildren(),function(e){s(e,i&&!a,!0)})),e.publish("destroy",u)},o,u=function(){};return u.makeWidget=function(e,t){if(!e._isWidget)for(var n in o)t.hasOwnProperty(n)||(t[n]=o[n])},u.prototype=o={_isWidget:!0,getObservable:function(){return this._observable||(this._observable=r.createObservable())},registerMessages:function(e,t){this.getObservable().registerMessages.apply(this,arguments)},publish:function(n,r){var i=this.getObservable();i.publish.apply(i,arguments);var s;this._events&&(s=this._events[n])&&(s.props&&(r=e.extend(r||{},s.props)),t("raptor/pubsub").publish(s.target,r))},subscribe:function(e,t,n){var r=this.getObservable();return r.subscribe.apply(r,arguments)},getElId:function(e){return e?this._id+"-"+e:this._id},getRootElId:function(){return this.getElId()},getEl:function(e){return document.getElementById(this.getElId(e))},getRootEl:function(){return this.getEl()},getWidget:function(e){var t=this._doc;return t?t.getWidget(e):null},getWidgets:function(e){var t=this._doc;return t?t.getWidgets(e):null},getChild:function(e){return this.getWidget(e)},getChildren:function(e){return this.getWidget(e)},getDoc:function(){return this._doc},getParent:function(){return this._parentWidget},getChildWidget:function(e){return this.getChild(e)},getChildWidgets:function(e){return this.getChildren.apply(this,arguments)},getParentWidget:function(){return this._parentWidget},destroy:function(e){e=e||{},s(this,e.removeNode!==!1,e.recursive!==!1)},isDestroyed:function(){return this.__destroyed},notify:function(e,t){return this.publish(e,i(arguments,1))}},o.on=o.subscribe,u});
define.extend("raptor/widgets",function(e){"use strict";return{onReady:function(e,t){$(function(){e.call(t)})}}});
define.extend("raptor/widgets/Widget",function(e){"use strict";var t=e("raptor"),n=/\#(\w+)( .*)?/g,r=t.global;return{$:function(e){var t=arguments;if(t.length===1){if(typeof e=="function"){var i=this;$(function(){e.apply(i,t)})}else if(typeof e=="string"){var s=n.exec(e);n.lastIndex=0;if(s!=null){var o=s[1];return s[2]==null?$(this.getEl(o)):$("#"+this.getElId(o)+s[2])}var u=this.getEl();if(!u)throw new Error("Root element is not defined for widget");if(u)return $(e,u)}}else if(t.length===2){if(typeof t[1]=="string")return $(e,this.getEl(t[1]))}else if(t.length===0)return $(this.getEl());return $.apply(r,arguments)},onReady:function(e){var t=this,n=function(){e.call(t,t)};if($.isReady)return n();$(n())}}});
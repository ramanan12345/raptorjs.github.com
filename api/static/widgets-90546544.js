define("raptor/widgets/WidgetDef",["raptor"],function(e,t,n,r){"use strict";var i=function(t){this.children=[],e.extend(this,t)};return i.prototype={a:function(){},addChild:function(e){this.children.push(e)},elId:function(e){return arguments.length===0?this.id:this.id+"-"+e}},i});
define("raptor/widgets/WidgetsContext",function(e,t,n){"use strict";var r=e("raptor/widgets/WidgetDef"),i=function(e){this.context=e,this.widgets=[],this.widgetStack=[]};return i.prototype={beginWidget:function(e,t){var n=this,i=n.widgetStack,s=i.length,o=s?i[s-1]:null;e.id||(e.id=n._nextWidgetId());if(e.assignedId&&!e.scope)throw raptor.createError(new Error('Widget with an assigned ID "'+e.assignedId+'" is not scoped within another widget.'));e.parent=o;var u=new r(e);o?o.addChild(u):n.widgets.push(u),i.push(u);try{t(u)}finally{i.splice(s,1)}},hasWidgets:function(){return this.widgets.length!==0},clearWidgets:function(){this.widgets=[],this.widgetStack=[]},_nextWidgetId:function(){return"w"+this.context.uniqueId()}},i});
define("raptor/widgets",function(e,t,n){"use strict";var r=e("raptor/widgets/WidgetsContext"),i="widgets";return{getWidgetsContext:function(e){var t=e.getAttributes();return t[i]||(t[i]=new r(e))}}});
define("raptor/pubsub",function(e,t,n){"use strict";var r=e("raptor/listeners"),i=define.Class({superclass:r.Message},function(){var e=function(e,t){r.Message.call(this,e,t),this.topic=e};return e.prototype={getTopic:function(){return this.topic}},e}),s=define.Class(function(){return{init:function(e){this.name=e,this.observable=r.createObservable()},publish:function(t,n){var i;return r.isMessage(t)?i=t:i=e("raptor/pubsub").createMessage(t,n),this.observable.publish(i),i},subscribe:function(e,t,n){return this.observable.subscribe(e,t,n)}}}),o={};return{channel:function(e){var t=o[e];return t||(t=new s(e),o[e]=t),t},global:function(){return this.channel("global")},publish:function(e,t){var n=this.global();n.publish.apply(n,arguments)},subscribe:function(e,t,n){var r=this.global();return r.subscribe.apply(r,arguments)},createMessage:function(e,t){return new i(e,t)}}});
define("raptor/dom",function(e){"use strict";return{forEachChildEl:function(e,t,n){this.forEachChild(e,t,n,1)},forEachChild:function(e,t,n,r){if(!e)return;var i=0,s=e.childNodes,o=s.length;for(;i<o;i++){var u=s[i];u&&(r==null||r==u.nodeType)&&t.call(n,u)}}}});
define.extend("raptor/widgets/WidgetsContext",function(e,t){"use strict";return{initWidgets:function(){var t=this.widgets,n=e("raptor/widgets");t.forEach(function(e){n.initWidget(e)}),this.clearWidgets()}}});
define.extend("raptor/widgets",function(e,t){"use strict";var n=e("raptor/logging").logger("raptor/widgets"),r={},i=e("raptor"),s=i.createError,o=e("raptor/widgets/Widget"),u=function(e){var t={};return i.forEach(e,function(e){t[e[0]]={target:e[1],props:e[2]}},this),t},a=function(e){this.widget=e,this.widgetsById={}};a.prototype={_remove:function(e,t){var n=this.widget,r=this.widgetsById[t];r&&(this.widgetsById[t]=r.filter(function(t){return t!==e})),n[t]===e&&delete n[t]},addWidget:function(e,t){var n=this.widgetsById[t],r=this.widget;n?n.push(e):this.widgetsById[t]=[e];var s=r[t];s?i.isArray(s)?s.push(e):r[t]=[s,e]:r[t]=e},getWidget:function(e){var t=this.widgetsById[e];if(!t||t.length===0)return undefined;if(t.length===1)return t[0];throw s(new Error('getWidget: Multiple widgets found with ID "'+e+'"'))},getWidgets:function(e){return this.widgetsById[e]||[]}};var f=function(i,f,l,c,h,p,d,v){if(!e.exists(i))throw s(new Error('Unable to initialize widget of type "'+i+'". The class for the widget was not found.'));var m,g=e(i);n.debug('Creating widget of type "'+i+'" ('+f+")");if(g.initWidget)c.elId=f,c.events=p,m=g,g.onReady||(g.onReady=t.onReady);else{var y=function(){},b;y.prototype=b=g.prototype,m=new y,o.makeWidget(m,b),m.registerMessages(["beforeDestroy","destroy"],!1);var w=b.events||g.events;w&&m.registerMessages(w,!1),m._id=f,g.getName||(g.getName=function(){return i}),m.constructor||(b.constructor=g),o.legacy&&(m._parentWidget=d),p&&(m._events=u(p)),r[f]=m;if(l&&h){m._assignedId=l,m._scope=h;var E=r[h];if(!E)throw s(new Error("Parent scope not found: "+h));r[h]._doc.addWidget(m,l)}m._doc=new a(m)}return{widget:m,init:function(){var e=function(){try{m.initWidget?m.initWidget(c):g.call(m,c)}catch(e){var t='Unable to initialize widget of type "'+i+"'. Exception: "+e;if(!v)throw e;n.error(t,e)}};m.initBeforeOnDomReady===!0?e():m.onReady(e)}}};return{initWidget:function(e){var t=f(e.type,e.id,e.assignedId,e.config,e.scope?e.scope.id:null,e.events);e.widget=t.widget,e.children.length&&e.children.forEach(this.initWidget,this),t.init()},_serverInit:function(e){var t=function(e,n){if(!e)return;var r=0,i=e.length;for(;r<i;r++){var s=e[r],o=s[0],u=s[1],a=s[2]||{},l=s[3],c=s[4],h=s[5]||{},p=s.slice(6);l===0&&(l=undefined),c===0&&(c=undefined),a===0&&(a=undefined);var d=f(o,u,c,a,l,h,n,1);p&&p.length&&t(p,d.widget),d.init()}};t(e)},get:function(e){return r[e]},_remove:function(e){delete r[e]}}}),$rwidgets=function(){require("raptor/widgets")._serverInit(require("raptor").arrayFromArguments(arguments))},require("raptor/pubsub").subscribe({"dom/beforeRemove":function(e){var t=e.el,n=require("raptor/widgets").get(t.id);n&&n.destroy({removeNode:!1,recursive:!0})},"raptor/component-renderer/renderedToDOM":function(e){var t=require("raptor/widgets"),n=e.context,r=t.getWidgetsContext(n);r.initWidgets()}});
define("raptor/widgets/Widget",["raptor"],function(e,t){"use strict";var n=t("raptor/listeners"),r=t("raptor/dom"),i=function(e,s,o){var u={widget:e},a=e.getEl(),f=t("raptor/widgets"),l=e._assignedId;e.publish("beforeDestroy",u),n.unsubscribeFromAll(e),e.__destroyed=!0;if(a){if(o){var c=function(e){r.forEachChildEl(e,function(e){if(e.id){var t=f.get(e.id);t&&i(t,!1,!1)}c(e)})};c(a)}s&&a.parentNode.removeChild(a)}f._remove(e._id);if(l){var h=f.get(e._scope);h&&h.getDoc()._remove(e,l)}e.publish("destroy",u)},s,o=function(){};return o.makeWidget=function(e,t){if(!e._isWidget)for(var n in s)t.hasOwnProperty(n)||(t[n]=s[n])},o.prototype=s={_isWidget:!0,getObservable:function(){return this._observable||(this._observable=n.createObservable())},registerMessages:function(e,t){this.getObservable().registerMessages.apply(this,arguments)},publish:function(n,r){var i=this.getObservable();i.publish.apply(i,arguments);var s;this._events&&(s=this._events[n])&&(s.props&&(r=e.extend(r||{},s.props)),t("raptor/pubsub").publish(s.target,r))},subscribe:function(e,t,n){var r=this.getObservable();return r.subscribe.apply(r,arguments)},getElId:function(e){return e?this._id+"-"+e:this._id},getEl:function(e){return document.getElementById(this.getElId(e))},getWidget:function(e){var t=this._doc;return t?t.getWidget(e):null},getWidgets:function(e){var t=this._doc;return t?t.getWidgets(e):null},getDoc:function(){return this._doc},destroy:function(e){e=e||{},i(this,e.removeNode!==!1,e.recursive!==!1)},isDestroyed:function(){return this.__destroyed},rerender:function(n,r){var i=this.renderer,s=this.constructor.getName(),o=t("raptor/component-renderer"),u=this.getEl();if(!u)throw e.createError(new Error("Root element missing for widget of type "+s));i||(this.constructor.render?i=this.constructor:s.endsWith("Widget")&&(i=t.find(s.slice(0,-6)+"Renderer")));if(!i)throw e.createError(new Error("Renderer not found for widget "+s));return o.render(i,n,r).replace(u)}},s.on=s.subscribe,o});
define.extend("raptor/widgets",function(e){"use strict";return{onReady:function(e,t){$(function(){e.call(t)})}}});
define.extend("raptor/widgets/Widget",function(e){"use strict";var t=e("raptor"),n=/\#(\w+)( .*)?/g,r=t.global;return{$:function(e){var t=arguments;if(t.length===1){if(typeof e=="function"){var i=this;$(function(){e.apply(i,t)})}else if(typeof e=="string"){var s=n.exec(e);n.lastIndex=0;if(s!=null){var o=s[1];return s[2]==null?$(this.getEl(o)):$("#"+this.getElId(o)+s[2])}var u=this.getEl();if(!u)throw new Error("Root element is not defined for widget");if(u)return $(e,u)}}else if(t.length===2){if(typeof t[1]=="string")return $(e,this.getEl(t[1]))}else if(t.length===0)return $(this.getEl());return $.apply(r,arguments)},onReady:function(e){var t=this,n=function(){e.call(t,t)};if($.isReady)return n();$(n())}}});